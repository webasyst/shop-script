{* Note: this template is also used in CRM applications. *}

<form id="wf-action-form" action="?module=workflow&action=perform" method="post">
    <input type="hidden" name="id" value="{$order_id}">
    <input type="hidden" name="action_id" value="{$action_id}">

    {* begin shipping plugin form*}
    {if !empty($shipping_controls)}
        <div class="form">
            {foreach $shipping_controls as $control}

                {$control}
            {/foreach}
        </div>
    {/if}
    {* end shipping plugin form *}

    {if !empty($plugins_html)}
    {foreach $plugins_html as $plugin_id => $html}
        <!-- {$plugin_id} -->
        {$html}
    {/foreach}
    {/if}

    {* ".js-form-footer-actions" and ".js-submit-button" classes are required for dialog in CRM app. *}
    <footer class="js-form-footer-actions">
        <input class="js-submit-button" type="submit" value="[`Save`]">
        [`or`]
        <a class="cancel inline-link js-cancel-button" href="#"><b><i>[`cancel`]</i></b></a>
    </footer>
</form>

<script type="text/javascript">
    ( function($) {
        var $form = $("#wf-action-form");

        // cancel link
        $('.js-cancel-button', $form).click(function(event) {
            event.preventDefault();
            $('.workflow-content').empty().hide();
            $('.workflow-actions').show();
            return false;
        });

        $form.submit(function (event) {
            event.preventDefault();
            $(':submit', $form).attr('disabled', true);
            $.post(
                $form.attr('action'), 
                $form.serialize(), 
                function () {
                    $form.trigger("formSend"); // this event is used in CRM app
                    if ("order" in $) {
                        $.order.reload();
                    } else {
                        $(':submit', $form).removeAttr('disabled');
                    }
                }, 
                "json"
            );
            return false;
        });
    })(jQuery);
</script>
