var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$.extend($.importexport=$.importexport||{},$.importexport={options:{loading:'<i class="icon16 loading"></i>',path:"#/",plugin_names:{},plugin_profiles:{},title_suffix:"",backend_url:"/webasyst/"},hash:null,path:{plugin:null,module:null,direction:null,profile:null,prefix:null,action:"default",tail:null,dispatch:null},plugins:{},ready:!1,$menu:null,$content:null,$header:null,$profile:null,init:function(a){this.options=$.extend(this.options,a||{});if(!this.ready){this.ready=!0;this.$menu=$("#s-importexport-menu");
this.$header=$("#s-importexport-header");this.$profile=$("#s-importexport-profile");$.ajaxSetup({cache:!1,converters:{"text json":function(c){return c?JSON.parse(c):null}}});"undefined"!=typeof $.History&&$.History.bind(function(){$.importexport.dispatch()});$.wa.errorHandler=function(c){if(403===c.status||404===c.status){c=$(c.responseText);var d=$('<div class="block double-padded"></div>');c.find(".dialog-content").length?d.append(c.find(".dialog-content *")):d.append(c.find(":not(style)"));$("#s-importexport-content").empty().append(d).append('<div class="clear-both"></div>');
return!1}return!0};var b=this;this.$profile.off("click.importexport").on("click.importexport","a.js-action",function(){return b.click($(this))});a=window.location.hash;"#/"!==a&&a?$.wa.setHash(a):this.dispatch()}},parsePath:function(a){a=(a||"").replace(/^.*#\//,"");a={plugin:a.replace(/\/.*$/,"")||"",module:"backend",prefix:null,direction:null,profile:null,action:a.replace(/^[^\/]+\//,"").replace(/\/.*$/,"")||"",tail:a.replace(/^([^\/]+\/){1,2}/,"").replace(/\/$/,""),raw:a};var b=a.plugin.split(":");
1<b.length&&(""+b[b.length-1]).match(/^-?\d*$/)&&(a.profile=parseInt(b.pop()));1<b.length?(a.plugin=null,a.module=b[0],a.prefix=b[1],a.direction=b[2]?b[2]:null):($.shop.trace("plugin",[b.length,b[0]]),a.plugin=b[0]);$.shop.trace("$.importexport.parsePath",a);return a},dispatch:function(a,b){void 0===a&&(a=window.location.hash);if(!a){var c=this.$menu.find("li:first > a:first");c.length&&(window.location.hash=a=c.attr("href"))}"function"!=typeof $("").fileupload||!this.hash||this.hash==a||"#/images:product/"!=
a&&"#/csv:product/"!=a||location.reload(!0);this.hash=a;b&&(window.location.hash=a);var d=this.parsePath(a.replace(/^[^#]*#\/*/,""));this.path.dispatch=d;d.plugin?b=b||d.plugin!=this.path.plugin||d.profile!=this.path.profile&&0<d.profile:d.module&&"backend"!=d.module&&(b=b||d.plugin+d.module!=this.path.plugin+this.path.module||d.direction!=this.path.direction||d.profile!=this.path.profile&&0<d.profile);if(b)if(a=(d.plugin?[d.plugin,d.prefix,d.direction]:[d.module,d.prefix,d.direction]).filter(function(g){return g&&
0<g.length}).join(":"),!d.profile&&this.options.plugin_profiles[a]&&"hash"==d.action&&d.tail)this.profileAdd(a,d.action+"/"+d.tail);else{var e=$("#s-importexport-content");if(d.plugin!=this.path.plugin||d.module!=this.path.module||d.direction!=this.path.direction)this.$header.hide(),this.$profile.hide();this.importexportBlur(this.path.plugin,a);$.shop&&$.shop.trace("$.importexport.dispatch (default) "+this.path.plugin+" -> "+d.plugin);this.path.tail=null;b||e.empty().html(this.options.loading);var f=
this;e.load(this.helper.buildUrl(d),function(g,h,k){e.find(">div.block.double-padded").length||e.wrapInner('<div class="block double-padded"></div>');f.importexportLoad(e,d)})}else d.plugin&&this.importexportAction(d.action,d.tail)},click:function(a){try{var b=a.attr("href").replace(/.*#\/?/,"").replace(/\/$/,"").split("/"),c=b.shift(),d,e=this;(d=c.match(/^(\w+(:\w+)?)(:\d+)?$/))&&this.plugins[d[1]]&&(e=this.plugins[d[1]],c=null);var f=$.shop.getMethod(b,e,c);f.name?($.shop.trace("$.importexport.click",
f),f.params.push(a),e[f.name].apply(e,f.params)):$.shop.error("Not found js handler for link",[f,b,a,e])}catch(g){$.shop.error("Exception "+g.message,g)}return!1},profileAdd:function(a,b){b=b||"";b="string"==typeof b&&b.match(/^hash\//)?b.replace(/^hash\//,""):null;$.ajax({url:"?module=importexport&action=add",type:"POST",dataType:"json",data:{plugin:a,hash:b},success:function(c){$.shop.trace("addAction",c.data);c&&"ok"==c.status&&(window.location.hash=window.location.hash.replace(new RegExp("\\/("+
a+"):?\\d*\\/","g"),"/$1:"+c.data+"/"))}})},profileUpdateName:function(a){var b=(""+this.profiles.key()+":"+this.path.profile).replace(/([:#])/g,"\\\\$1");$("#s-importexport-profile").find('a[href="#/'+b+'/"]:first').text(a)},profileDelete:function(a,b){function c(){var f=(""+a+":"+d).replace(/([:#])/g,"\\\\$1");$.shop.trace("profileDelete",[a,d,f]);var g=$("#s-importexport-profile").find('a[href^="#/'+f+'/"]:first').parents("li:first");$.ajax({url:"?module=importexport&action=delete",type:"POST",
dataType:"json",data:{plugin:a,profile:d},success:function(h){$.shop.trace("profileDelete",h.data);if(h&&"ok"==h.status&&(b.parents("li:first").hide(),g.remove(),$.shop.trace("profileDelete",[e.path,d]),e.profiles.list[a][d]&&(e.profiles.list[a][d]=null),e.path.profile==d)){h=null;for(d in e.profiles.list[a])if(e.profiles.list[a].hasOwnProperty(d)&&e.profiles.list[a][d]){h=d;break}h?window.location.hash=window.location.hash.replace(/:\d*\/$/,":"+h+"/"):e.profileAdd(a)}}})}var d=this.path.profile,
e=this;$.waDialog.confirm({title:b.data("confirm-text")||b.attr("title")||"Are you sure?",success_button_title:$.wa.locale.Delete,success_button_class:"danger js-dialog-delete",cancel_button_title:$.wa.locale.Cancel,cancel_button_class:"light-gray",onSuccess:function(f){f.$block.find(".js-dialog-delete").append('<i class="fas fa-spinner fa-spin custom-pl-4">');c()}})},importexportOptions:function(a){var b=this.path.dispatch.plugin||this.path.plugin;$.shop&&$.shop.trace("$.importexport.importexportOptions",
b);"undefined"==typeof this[b+"_options"]&&(this[b+"_options"]={});a&&(this[b+"_options"]=$.extend(this[b+"_options"],a))},importexportBlur:function(a,b){this.$menu.find("li.selected").removeClass("selected");$.shop&&$.shop.trace("$.importexport.importexportBlur",a);(this.path.plugin||this.path.module)&&this.call("Blur",[]);$("#s-importexport-content").html(this.options.loading)},importexportLoad:function(a,b){this.path.plugin=b.plugin;this.path.module=b.module;this.path.direction=b.direction;this.path.prefix=
b.prefix;this.path.profile=b.profile;this.path.tail=b.tail;$.shop.trace("$.importexport.importexportLoad",b);this.$menu.find("li.selected").removeClass("selected");var c=this.path.plugin?this.path.plugin:this.path.module+":"+this.path.prefix+(this.path.direction?":"+this.path.direction:""),d=c;this.path.direction&&this.path.plugin&&(d+=":"+this.path.direction);d=this.options.plugin_profiles[c]?d+":":d+"/";c=this.$menu.find('a[href^="#/'+d+'"]');c.parents("li").addClass("selected");c=a.find("h1:first").hide().text()||
this.options.plugin_names[this.path.plugin]||c.clone().children().remove().end().text()||"";window.document.title=c+this.options.title_suffix;this.$header.find("> h1:first").text(c);d=a.find("p:first").hide().html()||"";this.$header.find("> p:first").html(d);(c||d)&&this.$header.show();this.profiles.init();this.profiles.draw(b);this.$content=a;var e=this;this.products.init(this.$content.find("form"));this.$content.off("click.importexport").on("click.importexport","a.js-action",function(){try{return e.click($(this))}catch(f){return $.shop.error("Exception "+
f.message,f),!1}});this.importexportProfileInit();this.onPluginLoad(b,function(){e.call("onInit",[b]);e.importexportAction(b.action,b.tail)},200)},importexportProfileInit:function(){var a=this;this.$content.find("form").bind("submit.profile",function(){if(null!=a.path.profile)try{a.profiles.onSubmit();var b=$(this);a.profileUpdateName(b.find(':input[name="profile\\[name\\]"]:first').val());b.find(".js-profile-notice").hide()}catch(c){$.shop.error("Exception "+c.message,c)}return!0});this.$content.off("click.profile").on("click.profile",
"h2.js-profile-collapsible",function(){var b=$(this),c=b.parents("div.field-group:first");b.data("visible")?c.find("> div.field:visible").slideUp():c.find("> div.field:hidden").slideDown();b.data("visible",!b.data("visible"));return!1})},importexportAction:function(a,b){var c="";a&&(c+=a.substr(0,1).toUpperCase()+a.substr(1));c+="Action";$.shop&&$.shop.trace("$.importexport.importexportAction",[a,b]);this.call(c,[b]);this.path.tail=b},onPluginLoad:function(a,b,c){c=c?c+50:50;var d=!1;(d=a.plugin?
!!this.plugins[a.plugin]:!!this[a.module+"_"+a.prefix])?b():setTimeout(function(){$.importexport.onPluginLoad(a,b,c)},c)},call:function(a,b){var c=this.path.plugin?this.path.plugin:this.path.module+"_"+this.path.prefix;var d=c+a.substr(0,1).toUpperCase()+a.substr(1);d=d.replace(/^(\d)/,"a$1");var e="function"==typeof this[d],f=$.shop&&$.shop.trace("$.importexport.call "+d,[e,typeof this[d],b]),g=null;if(e){try{g=this[d].apply(this,b)}catch(h){($.shop&&$.shop.error||console.log)("Exception at $.importexport."+
d+": "+h.message,h)}$.shop&&$.shop.trace("$.settings.call complete "+d,[$.shop.time.interval(f)+"s",g,b])}else if(d=a.substr(0,1).toLowerCase()+a.substr(1),d=d.replace(/^(\d)/,"a$1"),e=this.plugins[c]&&"function"==typeof this.plugins[c][d],f=$.shop&&$.shop.trace("$.importexport.call "+c+"."+d,[e,b,c]),e){try{g=this.plugins[c][d].apply(this.plugins[c],b)}catch(h){($.shop&&$.shop.error||console.log)("Exception at $.importexport."+d+": "+h.message,h)}$.shop&&$.shop.trace("$.settings.call complete "+
c+"."+d,[$.shop.time.interval(f)+"s",g,b])}else $.shop.error("method not found at call",[a,d]);return g},profiles:{list:{},$profiles:null,$container:null,path:{},sortable:!1,counter:0,init:function(){this.$profiles=$("#s-importexport-profile");this.$container=$("#s-importexport-content");var a=this;this.sortable&&this.$profiles.sortable({distance:5,opacity:.75,items:"> li:not(.no-tab)",axis:"x",forceHelperSize:!0,containment:"parent",update:function(b,c){b=parseInt($(c.item).data("id"));c=$(c.item).prev().data("id");
c=void 0===c?0:parseInt(c);a.onSort(b,c,$(this))}})},onSubmit:function(){this.$profiles.find("> li.no-tab:last").hide()},onSort:function(a,b,c){$.shop.trace("$.importexport.profiles.onSort",[a,b,c])},set:function(a,b){this.list[a]=b||{}},onRun:function(){this.sortable&&this.$profiles.sortable("disable")},onComplete:function(){this.sortable&&this.$profiles.sortable("enable")},draw:function(a){this.path=a||this.path;var b,c=0;this.$profiles.find("> li:not(.no-tab)").remove();this.$profiles.find("> li.no-tab").show();
var d=this.key();$.shop.trace("profiles.draw",[d,$.importexport.options.plugin_profiles[d]]);if($.importexport.options.plugin_profiles[d]){var e=this.$profiles.find("> li.no-tab:first > a:first");e.attr("href",e.data("href").replace(/%plugin%/,d));e=null;if(this.list[d]){var f=this.$profiles.find("> li.no-tab:first");for(b in this.list[d])this.list[d].hasOwnProperty(b)&&(f.before(this.html(b,d)),b==a.profile&&(e=b),++c)}if(c){if(a=this.$profiles.find("> li.no-tab:last").show().find("> a:first"),a.attr("href",
a.data("href").replace(/%plugin%/,d)),a.find("i.icon16.loading").removeClass("loading").addClass("delete"),this.show(),!e&&b&&(window.location.hash=window.location.hash.replace(/:\d*\/$/,":"+b+"/")),this.sortable){var g=this;setTimeout(function(){g.$profiles.sortable("refresh");g.$profiles.sortable("enable")},50)}}else document.location.reload()}else this.hide()},key:function(){return this.path.plugin?this.path.plugin:[this.path.module,this.path.prefix,this.path.direction].filter(function(a){return a&&
0<a.length}).join(":")},show:function(){this.$profiles.show();this.$container.addClass("tab-content")},hide:function(){this.$profiles.hide();this.$container.removeClass("tab-content")},form:function(a){return'<div class="field"'+(a?' style="display:none;"':"")+'><div class="name">'+$_("Profile name")+'</div><div class="value"><input type="text" name="profile[name]"></div></div>'},html:function(a,b){var c;0<a&&(c=this.list[b][a]);b=$("<a></a>");c?(b.text(c.name),b.attr("title",c.description)):b.text($_("New profile"));
b.attr("href",["#",this.key()+":"+(a||--this.counter)].join("/")+"/");c=$("<li></li>");c.append(b);a&&a!=this.path.profile||c.addClass("selected");return c}},products:{$context:null,$inputs:null,init:function(a){this.$context=a;this.$inputs=this.$context.find(':input[name="hash"]');var b=this;this.$inputs.change(function(){b.handler($(this))});this.$context.find('select[name="export_mode"]').change(function(){var c=$(this).closest(".value");"0"===$(this).val()?(c.find("p.hint").removeClass("hidden"),
c.find("div.block-hint").addClass("hidden")):(c.find("p.hint").addClass("hidden"),c.find("div.block-hint").removeClass("hidden"))});this.$inputs.trigger("change")},action:function(a){var b=(a||"").split("/");a=this.$inputs.filter('[value="'+b[0]+'"]:first');if(a.length){var c=b[0]||"";a.parents("li").show();$.shop.trace("hash/action/test",[c,b]);switch(c){case "id":var d=b[1]||"0";this.$context.find(':input[name="product_ids"]:first').val(d);b=a.parents("li").find("span");c=b.data("text")||b.text();
b.text(c.replace(/%d/g,d.split(",").length));break;case "type":b=parseInt(b[1]);this.$context.find(':input[name="type_id"]').val([b]);break;case "set":b=b[1];this.$context.find(':input[name="set_id"]').val([b]);break;case "category":d=b[1]||"0",b=this.$context.find(':input[name="category_ids"]'),1==b.length?b.val(d):b.filter('[value="'+d+'"]').attr("checked",!0),b=a.parents("li").find("span"),d=d.split(","),c=b.data("text")||b.text(),b.text(c.replace(/%d/g,d.length))}a.attr("checked",!0).trigger("change")}},
handler:function(a){var b=a.parents("div.field");if(a.is(":checked")){var c=a.val(),d=b.find(".js-hash-values.js-hash-"+c);b.find(".js-hash-values:visible").hide();d.show();switch(c){case "category":b=d.find(':input[name="category_ids"]'),1<b.length&&!b.filter(":checked").length&&(b.filter('[data-selected="selected"]').attr("checked",!0),b.filter(":checked").length||b.filter(":first").attr("checked",!0),a=a.parents("li:first").find("span:first"),$.shop.trace("label",a),a.data("text")||a.text(),(c=
a.data("text"))&&a.text(c.replace(/%d/g,b.filter(":checked").length)))}}}},helper:{buildUrl:function(a){var b=[];if(a.plugin){if("plugins"==a.plugin)return $.importexport.options.backend_url+"installer/?module=plugins&action=view&slug=shop&filter[tag]=importexport";b.push("plugin="+a.plugin)}a.module&&"backend"!=a.module&&b.push("module="+a.module);b.push("action="+(a.prefix||"")+"setup");a.direction&&b.push("direction="+a.direction);a.profile&&b.push("profile="+a.profile);return"?"+b.join("&")}},
getPlugin:function(){}});
//# sourceMappingURL=importexport.min.js.map