(function(a){var b=function(a,e,d){var f=/[^\w\-\.:]/.test(a)?new Function(b.arg+",tmpl","var _e=tmpl.encode"+b.helper+",_s='"+a.replace(b.regexp,b.func)+"';return _s;"):d?b.cache[a]=b(b.load(a)):b.cache[a]=b.cache[a]||b(b.load(a));return e?f(e,b):function(a){return f(a,b)}};b.cache={};b.load=function(a){var b=document.getElementById(a),d=/<\\\/(\w+)/g;if(!b&&console)throw{message:"template with id="+a+" not found"};return b?("textarea"==b.tagName.toLowerCase()?b.value:document.getElementById(a).innerHTML).replace(d,
"</$1"):null};b.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;b.func=function(a,b,d,f,g,h){if(b)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[a]||"\\"+a;if(d)return"="===d?"'+_e("+f+")+'":"'+("+f+"||'')+'";if(g)return"';";if(h)return"_s+='"};b.encReg=/[<>&"'\x00]/g;b.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};b.encode=function(a){return String(a||"").replace(b.encReg,function(a){return b.encMap[a]||""})};b.arg="o";b.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return b}):a.tmpl=b})(this);(function(a){a.fn.lazyLoad=function(b,c){function e(){if(f.stopped)this.onscroll=null;else if(!f.stopped&&!f.loading&&k(h,g)<=f.distance){if(null!==f.hash){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===f.hash.indexOf(a)){this.onscroll=null;return}}f.load()}}function d(){var a=setTimeout(function(){if(f.stopped)clearTimeout(a);else{if(null!==f.hash){var b=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===f.hash.indexOf(b)){clearTimeout(a);return}}f.loading?a=setTimeout(arguments.callee,
350):(k(h,g),k(h,g)<=f.distance?(f.load(),a=setTimeout(arguments.callee,350)):(g.get(0).onscroll=e,clearTimeout(a)))}},350)}if("stop"==b){var f=this.data("lazyLoadSettings");f&&(f.stopped=!0)}else if("reload"==b){if(f=this.data("lazyLoadSettings"))f.stopped=!1,f.loading=!1,this.get(0).onscroll=null,this.lazyLoad(f)}else if("sleep"==b){if(f=this.data("lazyLoadSettings"))f.loading=!0}else if("wake"==b){if(f=this.data("lazyLoadSettings"))f.loading=!1}else if("force"==b)(f=this.data("lazyLoadSettings"))&&
(f.loading||f.load());else{this.data("lazyLoadSettings",a.extend({distance:50,load:function(){},container:h,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},b||{}));f=this.data("lazyLoadSettings");f.loading=!1;f.stopped=!1;var g=this,h=f.container;null===f.hash||a.isArray(f.hash)||(f.hash=[f.hash]);a.fn.lazyLoad.call(g,f.state);d();var k="function"===typeof f.distanceBetweenBottoms?f.distanceBetweenBottoms:function(b,d,c){b="string"===typeof b?
a(b):b;c=c||0;return b.position().top+b.outerHeight()-c-(d.scrollTop()+d.height())}}}})(jQuery);$.fn.liveDraggable=function(a){this.each(function(a,c){var e=$(this);e.data("init_draggable")&&e.die("mouseover",e.data("init_draggable"))});this.die("mouseover").live("mouseover",function(){var b=$(this);b.data("init_draggable")||b.data("init_draggable",arguments.callee).draggable(a)})};
$.fn.liveDroppable=function(a){this.each(function(a,b){var d=$(this);d.data("init_droppable")&&d.die("mouseover",d.data("init_droppable"))});var b=function(){var b=$(this);b.data("init_droppable")||(b.data("init_droppable",arguments.callee).droppable(a),b.mouseover())};b.call(this);this.die("mouseover",b).live("mouseover",b)};(function(a){a.fn.inlineEditable=function(b,c){function e(){if(!this.data("inited")){l.truncate&&"boolean"==typeof l.truncate&&(l.truncate=255);if(l.truncate){var b=l.placeholder&&l.placeholder===this.text()?"":this.text();this.data("real_text",b);this.text(b.length<l.truncate-3?b:b.substr(0,l.truncate-3)+"...")}l.placeholder&&d.call(this);l.editLink&&a(l.editLink).unbind("click.inlineEditable").bind("click.inlineEditable",function(){l.hold.call(r)||"edit"!=v&&h.call(r.get(0))});l.editOnItself&&this.unbind("click.inlineEditable").bind("click.inlineEditable",
function(){l.hold.call(r)||"edit"!=v&&h.call(this)});this.unbind("editable.inlineEditable").bind("editable.inlineEditable",function(){l.hold.call(r)||"edit"!=v&&h.call(this)});this.unbind("placeholder.inlineEditable").bind("placeholder.inlineEditable",function(b,c){c&&l.placeholder&&d.call(this);c||a(this).removeClass(l.placeholderClass)});this.data("inited",!0)}}function d(){q(a(this))||a(this).addClass(l.placeholderClass).text(l.placeholder)}function f(){q(a(this))==l.placeholder&&a(this).text("").removeClass(l.placeholderClass)}
function g(b){return a(b).val()?!1:(a(this).text(l.placeholder).addClass(l.placeholderClass),!0)}function h(){v="edit";this.id=this.id||(""+Math.random()).slice(2);var b=this.id+"-input",d=a("#"+b);d.length||(r.after(m(b)),d=a("#"+b));d.addClass(l.inputClass);n(d,r);l.placeholder&&q(a(this))==l.placeholder&&f.call(r);l.beforeMakeEditable.call(this,d);w=l.truncate?r.data("real_text"):q(r);d.val(w).show().focus();r.hide();a(l.editLink).hide();if(!u){for(var b=[],c=[],e=0,g=l.makeReadableBy.length;e<
g;++e){var h=l.makeReadableBy[e];"blur"==h&&d.blur(function(){"read"!=v&&k.call(this)});"enter"==h&&b.push(13);"esc"==h&&b.push(27)}e=0;for(g=l.updateBy.length;e<g;++e)h=l.updateBy[e],"alt+enter"==h&&c.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==h&&c.push({ctrl:!0,alt:!1,shift:!1,key:13}),"ctrl+s"==h&&c.push({ctrl:!0,alt:!1,shift:!1,key:17});b.length&&function(a){d.keydown(function(b){!~a.indexOf(b.keyCode)||b.ctrlKey||b.altKey||b.shiftKey||"read"!=v&&k.call(this,27==b.keyCode?w:null);if(c.length)for(var d in c){var e=
c[d];if(b.keyCode==e.key&&b.ctrlKey==e.ctrl&&b.altKey==e.alt&&b.shiftKey==e.shift){r.trigger("readable");break}}})}(b);r.unbind("readable.inlineEditable").bind("readable.inlineEditable",function(b,d){if("read"!=v){var c=a("#"+(this.id+"-input"));k.call(c,c.val(),d)}});u=!0}l.afterMakeEditable.call(this,d)}function k(b,c){c="undefined"===typeof c?!1:!0;void 0!=b&&null!=b?a(this).val(b):b=a(this).val();if(!1!==c||!1!==l.beforeBackReadable.call(r.get(0),this,{changed:b!=w,old_text:w,new_text:b})){v=
"read";if(!l.placeholder||!g.call(r,this))if(l.allowEmpty||b){if(l.truncate)r.data("real_text",b),r.text(b.length<l.truncate-3?b:b.substr(0,l.truncate-3)+"...");else{var e=r,f=b;l.html?e.html(f):e.text(f)}b||d.call(this)}r.show();a(this).hide();a(l.editLink).show();!1===c&&l.afterBackReadable.call(r.get(0),this,{changed:b!=w,old_text:w})}}function m(a){switch(l.inputType){case "textarea":return'<textarea id="'+a+'" style="display:none;"></textarea>';default:return'<input type="text" id="'+a+'" style="display:none;">'}}
function n(a,b){var d=l.size.height||b.height(),c=l.size.width||1.5*b.width(),d=l.minSize.height&&d<l.minSize.height?l.minSize.height:d,c=l.minSize.width&&c<l.minSize.width?l.minSize.width:c,d=l.maxSize.height&&d>l.maxSize.height?l.maxSize.height:d,c=l.maxSize.width&&c>l.maxSize.width?l.maxSize.width:c;a.height(d);a.width(c)}function p(a){return function(){return a}}function q(a){return l.html?a.html():a.text()}if(this.length){var u=!1;if("string"==typeof b){if("setOption"==b){var l=this.data("inlineEditableSettings")||
{};a.extend(!0,l,c);"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(l.hold=p(l.hold));this.data("inlineEditableSettings",l)}return this}var t=this.data("inlineEditableSettings");this.data("inlineEditableSettings",a.extend({inputType:"text",inputClass:"",size:{height:null,width:null},minSize:{height:null,width:null},maxSize:{height:null,width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur","enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},
afterBackReadable:function(){},beforeMakeEditable:function(){},afterMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},t,b||{}));var l=this.data("inlineEditableSettings")||{},r=this,v="read",w="";"function"!==typeof l.hold&&(l.hold=p(l.hold));e.call(this);return this}}})(jQuery);(function(a){a.fn.photoStreamSlider=function(b){function c(){function b(c){function k(){b.execution=!1;var a="on"+p.charAt(0).toUpperCase()+p.slice(1),a=e[a];"function"==typeof a&&a.call(d);a=c.fn;"function"==typeof a&&a.call(d)}"string"==typeof c&&(c={direction:c,animate:!0});var p=c.direction||"forward",l=c.steps||h.length;if(!b.execution){b.execution=!0;var q=h.filter(":first").outerWidth()*l,t=h.length;if("forward"==p){var x=h.filter(":last").nextAll(":lt("+l+")"),l=x.length,x=x.filter(":last");
l&&(h.removeClass("visible"),x.prevAll(":lt("+(t-1)+")").addClass("visible"),x.addClass("visible"))}else x=h.filter(":first").prevAll(":lt("+l+")"),l=x.length,x=x.filter(":last"),l&&(h.removeClass("visible"),x.nextAll(":lt("+(t-1)+")").addClass("visible").show(),x.addClass("visible"));h=a("li.visible",g);t=g.position().left;"forward"==p?(l=n-m-u,t-=q,t=t>-l?t:-l):(t+=q,t=t<u?t:u);c.animate?g.animate({left:t},e.duration,k):(g.css({left:t}),k())}}var g=d.find(e.photoStream),h=a("li.visible",g),k=a("li",
g),m=h.filter(":first").outerWidth()*h.length,n=k.filter(":first").outerWidth()*k.length,p=e.height||k.filter(":first").outerHeight();g.parent().css({overflow:"hidden",height:p,position:"relative",padding:"4px 0",margin:0,width:m});for(var p=g.find("li:first"),q=h.filter(":first"),u=(q.outerWidth()-q.width())/2,l=0,t=p.outerWidth(),q=q.get(0);p.length&&p.get(0)!=q;)l+=t,p=p.next();g.css({position:"absolute",left:-(l-u),width:n});a(e.forwardLink).unbind("click").bind("click",function(){b("forward");
return!1});a(e.backwardLink).unbind("click").bind("click",function(){b("backward");return!1});d.unbind("append prepend").bind("append prepend",function(b,c){if("append"==b.type){for(var e=g.find("li:last"),f=a();e.hasClass("dummy");)f=f.add(e),e=e.prev("li");f.remove();g.append(c)}else{var e=a("<div></div>").html(c),f=e.find("li"),h=f.length*t;e.remove();for(var e=g.find("li:first"),m=a();e.hasClass("dummy");)m=m.add(e),e=e.next("li");m.remove();g.prepend(f)}k=g.find("li");n=k.filter(":first").outerWidth()*
k.length;g.css("width",n);"prepend"==b.type&&(g.is(":animated")&&g.stop(!1,!0),g.css("left",parseInt(g.css("left"))-h));g.find("li.selected").hasClass("visible")&&d.trigger("home",[null,!1])});d.unbind("forward backward").bind("forward backward",function(a,c){b({direction:a.type,steps:c.steps,animate:"undefined"!==typeof c.animate?c.animate:!0,fn:c.fn});var d=g.find("li.selected"),e="forward"==a.type?d.next("li:not(.dummy)"):d.prev("li:not(.dummy)");e.length&&(d.removeClass("selected"),e.addClass("selected"))});
d.unbind("home").bind("home",function(c,d,e){c=parseInt(h.length/2);c=h.filter(":eq("+c+")");var g=c.nextAll(".selected:first"),k=c.prevAll(".selected:first"),m=0,n="";"function"!==typeof d&&(e=d);e="undefined"!==typeof e?e:!0;g.length?(n="forward",c.nextAll().each(function(){++m;if(a(this).hasClass("selected"))return!1})):k.length&&(n="backward",c.prevAll().each(function(){++m;if(a(this).hasClass("selected"))return!1}));n&&m?b({direction:n,steps:m,fn:d,animate:e}):"function"==typeof d&&d();return!1});
d.unbind("refresh").bind("refresh",function(){c()})}var e=a.extend({duration:200,height:48},b||{}),d=this;c()}})(jQuery);(function(a){function b(){a("#hint-menu-block").hide().children().hide()}a.product_dragndrop={handlers:{},options:{},init:function(a){this.options=a;a.collections&&(this.initDragCollections(),this.initDropCollections());a.products&&(this.initDragProducts(),this.initDropProducts());return this},bind:function(a,b){this.handlers[a]=b;return this},trigger:function(a){if("function"===typeof this.handlers[a])return this.handlers[a].apply(this,Array.prototype.slice.call(arguments,1))},initDragProducts:function(){var c=
a("#product-list"),e=c.find(".product:not(.s-alien)");e.find(".drag-handle").live("selectstart",function(){document.onselectstart=function(){return!1};return!1});e.liveDraggable({opacity:.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,containment:[0,0,a(window).width(),{toString:function(){return a(document).height()}}],start:function(b,c){document.ondragstart=function(){return!1};c.helper.data("scrollTop",a(document).scrollTop());a(document).bind("scroll",a.product_dragndrop._scrolHelper);
a(".block.drop-target").addClass("drag-active")},handle:".drag-handle",stop:function(c,e){document.ondragstart=null;document.onselectstart=null;var g=a(this);g.find("input:checked").length||g.removeClass("selected");b();a(document).unbind("scroll",a.product_dragndrop._scrolHelper);a(".block.drop-target").removeClass("drag-active");b()},helper:function(b,e){var g=1,h=c.find(".s-select-all");h.is(":checked")?g=h.attr("data-count"):(h=c.find(".product.selected"),h.length?-1!==h.index(this)?g=h.length:
(a(this).trigger("select",!0),g=h.length+1):a(this).addClass("selected"));return'<div id="products-helper"><span class="indicator red">'+g+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},drag:function(a,b){var c=a.originalEvent;b.position.left=c.pageX-20;b.position.top=c.pageY}})},initDropProducts:function(){a("#product-list .product").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(c,e){if(a(this).hasClass("s-alien")||!e.draggable.hasClass("product"))return!1;
if(a.product_dragndrop.trigger("is_product_sortable"))b();else{var d=a.product_dragndrop.options.sort;if(d){var f=a("#hint-menu-block").show();f.children().hide();f.find("."+d).show()}}a.product_dragndrop._activatePhotoListItem.call(this)},out:function(b,e){a.product_dragndrop._unactivatePhotoListItem.call(this)},drop:function(b,e){if(!e.draggable.hasClass("product"))return!1;var d=a(this);if(d.hasClass("selected"))return a.product_dragndrop._unactivatePhotoListItem.call(this),!1;var f=a("#product-list").find(".product.selected");
if(!a.product_dragndrop.trigger("is_product_sortable"))return a.product_dragndrop._unactivatePhotoListItem.call(this),a.product_dragndrop._unactivatePhotoListItem.call(e.draggable),!1;var g=null;if(d.hasClass("s-alien")){var h=d.nextAll(":not(.s-alien):first");if(h.length)g=h.attr("data-product-id"),h.before(f);else{h=d.prevAll(":not(.s-alien):first");if(!h.length||h.hasClass("selected"))return!1;g=null;h.after(f)}h.hasClass("last")&&(h.removeClass("last"),f.filter(":last").addClass("last"))}else d.hasClass("drag-active-last")||
(g=d.attr("data-product-id")),d.hasClass("last")&&d.hasClass("drag-active-last")?(d.after(f).removeClass("drag-active drag-active-last last"),f.filter(":last").addClass("last")):d.before(f).removeClass("drag-active"),d.removeClass("drag-active drag-active-last");a.product_dragndrop._unactivatePhotoListItem.call(this);a.product_dragndrop._unactivatePhotoListItem.call(e.draggable);f.trigger("select",!1);d=f.map(function(){return a(this).attr("data-product-id")}).toArray();a.product_dragndrop.trigger("move_product",
{product_ids:d,before_id:g,error:function(a){a&&console&&console.log("undefined"!==typeof a.errors?a.errors:a)}})}})},initDragCollections:function(){var b=a("#wa-app .sidebar:first"),e=b.position(),d=b.width(),b=b.height();a(".s-collection-list li.dr").liveDraggable({containment:[e.left,e.top,e.left+1.25*d,e.top+1.25*b],refreshPositions:!0,revert:"invalid",helper:function(){var b=a(this),c=b.parents(".s-collection-list:first").find("ul:first"),b=b.clone().addClass("ui-draggable dr-helper").css({position:"absolute"}).prependTo(c);
b.find("a:first").append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display:none;"></i>');return b},cursor:"move",cursorAt:{left:5},opacity:.75,zIndex:9999,distance:5,start:function(a,b){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},initDropCollections:function(){this.initDropBetweenCollections();this.initDropInsideCollections()},initDropBetweenCollections:function(){a(".s-collection-list li.drag-newposition").liveDroppable({greedy:!0,
tolerance:"pointer",over:function(b,e){var d=a(this);if(e.draggable.attr("data-type")!=d.attr("data-type"))return!1;d.addClass("active").parent().parent().addClass("drag-active")},out:function(b,e){var d=a(this);if(e.draggable.attr("data-type")!=d.attr("data-type"))return!1;d.removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(b,e){var d=a(this);if(e.draggable.attr("data-type")!=d.attr("data-type"))return!1;(d.is(":animated")||d.hasClass("dragging"))&&d.stop().animate({height:"2px"},
300,null,function(){d.removeClass("dragging")});d.removeClass("active").parent().parent().removeClass("drag-active")},drop:function(b,e){var d=a(this),f=e.draggable,g=f.attr("data-type");if(g!=d.attr("data-type"))return!1;var h=function(a){a=a.split("-");a.shift();return a.join("-")},k=h(f.attr("id")),m=d.prev("li"),n=f.next(),p=f.prev();if(m.length&&m.attr("id")=="category-"+k&&!m.hasClass("dr-helper")||this==f.next().get(0))return!1;var q=f.parent("ul"),u=q.children("li.dr[id!=category-"+k+"]").length,
l=parseInt(h(q.parent().attr("id")),10)||0;d.after(n).after(f);d=f.parent().parent();if(d.is("li.dr")||d.is(".s-collection-list")){var t=0;d.is(".s-collection-list")||(t=parseInt(h(d.attr("id")),10)||0);d=f.nextAll("li.dr:first");m=null;d.length&&(m=h(d.attr("id"))||null);u||l===t||(q.parent("li").children("i").hide(),q.hide());a.product_dragndrop.trigger("move_list",{id:k,type:g,before_id:m,parent_id:t,success:function(b){u||l===t||(q.parent("li").children("i").remove(),q.remove(),a.categories_tree.setCollapsed(l))},
error:function(a){a&&console&&console.log("undefined"!==typeof a.errors?a.errors:a);p.after(f.next()).after(f);u||(q.parent("li").children("i").show(),q.show())}})}}})},initDropInsideCollections:function(){a(".s-collection-list li.dr a").liveDroppable({tolerance:"pointer",greedy:!0,out:function(b,e){var d=e.draggable,f=a(this).parent();if(!d.hasClass("product")&&f.attr("data-type")!=d.attr("data-type"))return!1;d.hasClass("product")&&e.helper.find("span").show().end().find("i").hide();f.removeClass("drag-newparent")},
over:function(b,e){var d=e.draggable,f=a(this).parent(),g=d.attr("data-type");if(!d.hasClass("product")&&g!=f.attr("data-type"))return!1;"set"!=g&&f.addClass("drag-newparent");if(d.hasClass("product"))return f.hasClass("dynamic")?e.helper.find("span").hide().end().find("i").show():e.helper.find("span").show().end().find("i").hide(),!1;if(!d.hasClass("dynamic")&&f.hasClass("dynamic"))return e.helper.find("i.no-bw").show(),!1;e.helper.find("i.no-bw").hide();var h='.dr[id!="'+d.attr("id")+'"]',k=a(),
d=function(a,b){if(!b.length)return a;a=a.add(b.nextUntil(h).filter("li.drag-newposition"));return 0<b.nextAll(h).length?a:arguments.callee(a,b.parent().closest("li"))},g=f.prevAll(h+":first");if(0<g.length)var m=g.find(h),k=0<m.length?d(k,m.last()):d(k,g);else k=k.add(f.prevUntil(h).filter("li.drag-newposition"));var k=0<f.children("ul").children(h).length?k.add(f.children("ul").children("li.drag-newposition:first")):d(k,f),n=a(".drag-newposition:animated, .drag-newposition.dragging").not(k);n.stop().animate({height:"2px"},
300,null,function(){n.removeClass("dragging")});k.stop().animate({height:"10px"},300,null,function(){k.addClass("dragging")})},drop:function(b,e){var d=e.draggable,f=a(this).parent(),g=d.attr("data-type");if(!d.hasClass("product")&&("set"==g||f.attr("id")==d.attr("id")||g!=f.attr("data-type")))return!1;f.removeClass("drag-newparent");if(d.hasClass("product")){if(f.hasClass("dynamic"))return!1;var h=a("#product-list"),k={};if(h.find(".s-select-all").is(":checked"))k.whole_list=!0;else{var m=h.find(".product.selected");
k.product_ids=m.map(function(){return a(this).attr("data-product-id")}).toArray()}a.product_dragndrop.trigger("add_to_list",a.extend(k,{collection_param:f.attr("id").replace("-","_id="),success:function(a){k.whole_list?h.find(".s-select-all").trigger("select",!1):k.product_ids&&k.product_ids.length&&m.trigger("select",!1);a.data&&(f.find(">.counters .count:not(.subtree)").text(a.data.count),f.find(">.counters .subtree").text(a.data.total_count))}}));return!1}if(!d.hasClass("dynamic")&&f.hasClass("dynamic"))return!1;
var n=d.attr("id").split("-")[1];if(f.attr("id")=="category-"+n)return!1;if(d.hasClass("product"))return a("#product-list").find(".product.selected").trigger("select",!1),!1;var p=parseInt(f.attr("id").split("-")[1],10)||0,q=null,u=d.next(),l=d.prev(),t=!1;f.hasClass("drag-newposition")?q=f.parent("ul"):f.children("ul").length?q=f.children("ul"):f.find(">i.collapse-handler-ajax").length||(q=a('<ul class="menu-v with-icons dr unapproved"><li class="drag-newposition unapproved" data-type="'+g+'"></li></ul>').appendTo(f),
q.find(".drag-newposition").mouseover(),a('<i class="icon16 darr overhanging collapse-handler-ajax unapproved" id="'+g+"-"+p+'-handler"></i>').insertBefore(f.children("a")),t=!0);var r=d.parent("ul"),v=r.children("li.dr[id!=category-"+n+"]").length,w=parseInt(r.parent().attr("id").split("-")[1],10)||0;q&&q.append(d).append(u);v||w===p||(r.parent("li").children("i").hide(),r.hide());f.is("li.dr")&&a.product_dragndrop.trigger("move_list",{id:n,type:g,parent_id:p,success:function(b){v||w===p||(r.parent("li").children("i").remove(),
r.remove(),a.categories_tree.setCollapsed(w));q?(a(".s-collection-list .unapproved").removeClass("unapproved"),t?a.categories_tree.setExpanded(p):f.trigger("count_subtree")):(d.remove(),u.remove(),f.trigger("update_counters",b.data.count||{}))},error:function(b){b&&console&&console.log("undefined"!==typeof b.errors?b.errors:b);l.after(d).after(u);v||(r.parent("li").children("i").show(),r.show());a(".s-collection-list .unapproved").remove()}})}})},_scrolHelper:function(b){b=a("#products-helper");var e=
b.data("scrollTop"),d=a(document).scrollTop(),e=e?d-e:50;b.css("top",b.position().top+e+"px");b.data("scrollTop",d)},_extDragActivate:function(b,e,d){var f=d+"-last";if(e.hasClass("last")){var g=b.pageX;b=b.pageY;var h=e.width(),k=e.height(),m=e.offset();"thumbs"==a.product_dragndrop.options.view?g>m.left+.5*h&&g<=m.left+h?(e.removeClass(d).addClass(f),a.product_dragndrop._shiftToLeft(e)):g>m.left&&g<=m.left+.5*h?(e.removeClass(f).addClass(d),a.product_dragndrop._shiftToRight(e)):a.product_dragndrop._shiftAtPlace(e):
"table"==a.product_dragndrop.options.view&&(b>m.top+.5*k?e.removeClass(d).addClass(f):b>m.top&&e.removeClass(f).addClass(d));(b<m.top||b>m.top+k||g<m.left||g>m.left+h)&&e.removeClass(d).removeClass(f)}else e.addClass("drag-active")},_bindExtDragActivate:function(b,e){a(document).bind("mousemove.ext_drag_activate",function(d){a.product_dragndrop._extDragActivate(d,b,e)})},_unbindExtDragActivate:function(){a(document).unbind("mousemove.ext_drag_activate")},_activatePhotoListItem:function(){var b=a(this),
e=a.product_dragndrop.trigger("is_product_sortable"),d=e?"drag-active":"drag-active-disabled";e&&"thumbs"==a.product_dragndrop.options.view&&a.product_dragndrop._shiftToRight(b);b.hasClass("last")?a.product_dragndrop._bindExtDragActivate(b,d):b.addClass(d)},_unactivatePhotoListItem:function(){var b=a(this),e=a.product_dragndrop.trigger("is_product_sortable"),d=e?"drag-active":"drag-active-disabled",f=d+"-last";b.hasClass("last")&&a.product_dragndrop._unbindExtDragActivate();b.removeClass(d+" "+f);
e&&"thumbs"==a.product_dragndrop.options.view&&a.product_dragndrop._shiftAtPlace(b)},_shiftToLeft:function(b){if("left"!==b.data("shifted")){var e=b.find(".p-wrapper");if(!e.length){var d=b.children(),e=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(b);e.append(d)}e.stop().animate({left:-15},200);b.data("shifted","left")}},_shiftToRight:function(b){if("right"!==b.data("shifted")){var e=b.find(".p-wrapper");if(!e.length){var d=b.children(),e=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(b);
e.append(d)}e.stop().animate({left:15},200);b.data("shifted","right")}},_shiftAtPlace:function(a){if(a.data("shifted")){var b=a.find(".p-wrapper");if(b.length){var d=b.children();b.stop().css({left:0});a.append(d);b.remove()}a.data("shifted","")}}}})(jQuery);(function(a){var b=function(a){var b=/^category-(.*?)-handler$/;return b.test(a.attr("id"))?a.attr("id").replace(b,function(a,b){return parseInt(b,10)||0}):0},c=function(a){if(b(a))a=a.parents("li:not(.drag-newposition):first"),c=d=a.find("ul:first");else{a=a.parent();var d=a.next(),c=d.find("ul:first")}return{parent:a,target:d,ul:c}},e=function(a,b){var d=c(a);"category"==d.parent.attr("data-type")&&d.parent.trigger("count_subtree",!1);a.removeClass("rarr").addClass("darr");d.target.show();"function"===
typeof b&&b(a)},d=function(a,b){var d=a.parent.find(".loading:first"),c=a.parent.find(".counters");b?(d.show(),c.hide()):(d.hide(),c.show())},f=function(d,e){var f=c(d);"category"!=f.parent.attr("data-type")||f.parent.hasClass("dynamic")||f.parent.trigger("count_subtree",!0);d.removeClass("darr").addClass("rarr");f.target.hide();"function"===typeof e&&e(d);a.get("?action=categoryExpand&id="+b(d)+"&collapsed=1")},g=function(f,g,m){if(!f.data("loading_content")){var n=c(f);n.ul.length?e(f,g):d(n,!0);
var p=!n.ul.length;f.data("loading_content",p);a.get("?action=categoryExpand&id="+b(f)+(p?"&tree=1":""),function(a){p&&(n.target.length?n.target.append(a):n.parent.append(a),d(n,!1),e(f,g),f.data("loading_content",!1));"function"===typeof m&&m()})}};a.categories_tree={init:function(){a("#s-category-list-block").off("click",".collapse-handler-ajax").on("click",".collapse-handler-ajax",function(){var b=a(this);b.hasClass("darr")?f(b):g(b)});a("#s-category-list-block .heading").off("click").click(function(b){var d=
a(this).find(".collapse-handler-ajax");d.is(b.target)||d.click()})},collapse:function(b,d){b=a(b);b.hasClass("darr")?f(b,d):"function"===typeof d&&d(b)},expand:function(b,d,c){b=a(b);b.hasClass("rarr")?g(b,d,c):("function"===typeof d&&d(b),"function"===typeof c&&c(b))},isCollapsed:function(b){return a(b).hasClass("rarr")},setExpanded:function(b){a.get("?action=categoryExpand&id="+b)},setCollapsed:function(b){a.get("?action=categoryExpand&id="+b+"&collapsed=1")},getHandlerByCategoryId:function(b){var d=
a();return d=(b=parseInt(b,10)||0)?a("#category-"+b+"-handler"):a("#s-category-list-handler")}}})(jQuery);(function(a){a.product_sidebar={options:{},init:function(){var b=a("#s-sidebar");a.product_dragndrop.init({collections:!0}).bind("move_list",function(b){if(b.type){var d={id:b.id,type:b.type,parent_id:b.parent_id||0};b.before_id&&(d.before_id=b.before_id);a.products.jsonPost("?module=products&action=moveList",d,b.success,b.error)}else"function"===typeof b.error&&b.error("Unknown list type")});b.off("add",".s-collection-list ul").on("add",".s-collection-list ul",function(b,d,c,g){b=a(this);var h=b.parents(".s-collection-list:first"),
k=a("<ul></ul>");k.append(tmpl("template-sidebar-list-item",{type:c,item:d}));d=k.children(":not(.drag-newposition):first");c=d.attr("id");c=b.find("#"+c);var m=k.children();c.length?g&&c.replaceWith(d):b.prepend(m).show();m.each(function(){var b=a(this);b.hasClass("dr")?b.find("a").mouseover():b.mouseover()});b.find(".drag-newposition").css({height:"2px"}).removeClass("dragging");h.find(".s-empty-list").hide();k.remove();return!1});b.unbind("update").bind("update",function(b,d){for(var c in d)if("all"==
c)a("#s-all-products").find(".count:first").text(d[c].count);else{var g="#"+c+"-",h;for(h in d[c])a(g+h).find(".count:first").text(d[c][h].count)}return!1});a("#s-tag-cloud").unbind("update").bind("update",function(b,d){var c='<ul class="tags"><li class="block align-center">',g;for(g in d)var h=d[g],c=c+('<a href="#/products/tag='+h.uri_name+'/" style="font-size: '+h.size+"%; opacity: "+h.opacity+'"  data-id="'+h.id+'"  class="s-product-list">'+h.name+"</a>");c+="</li></ul>";a("#s-tag-cloud").html(c).parents(".block:first").show();
return!1});b.off("count_subtree",".s-collection-list li").on("count_subtree",".s-collection-list li",function(b,d){var c=a(this);"undefined"===typeof d&&(d=c.find("i.collapse-handler-ajax").hasClass("rarr"));var g=c.find(">.counters .count:not(.subtree)"),c=c.find(">.counters .subtree");c.length||(c=g.clone().addClass("subtree").hide(),g.after(c));d?(g.hide(),c.show()):(c.hide(),g.show());return!1});b.off("update_counters",".s-collection-list li").on("update_counters",".s-collection-list li",function(b,
d){var c=a(this),g=c.find(">.count:not(.subtree)"),c=c.find(">.subtree");c.length||(c=g.clone().addClass("subtree").hide(),g.after(c));"undefined"!==typeof d.item&&g.text(parseInt(d.item,10)||0);"undefined"!==typeof d.subtree&&c.text(parseInt(d.subtree,10)||0);return!1});var c=b.find("#s-category-list-widen-arrows");c.find("a.arrow").unbind("click").bind("click",function(){var e=b.attr("class"),d=0,f=e.match(/left([\d]{2,3})px/);if(f&&f[1]&&(d=parseInt(f[1]))&&(f=d+(a(this).is(".right")?50:-50),f=
Math.max(Math.min(f,400),200),f!=d)){c.css({width:f.toString()+"px"});d=["left"+d+"px","left"+f+"px"];b.attr("class",e.replace(d[0],d[1]));b.css("width","");var g=a("#s-content"),e=g.attr("class");g.attr("class",e.replace(d[0],d[1]));g.css("margin-left","");a.product&&a.product.setOptions({sidebar_width:f});a.shop.jsonPost("?action=sidebarSaveWidth",{width:f});b.trigger("change_width",[f])}return!1});b.off("click","#s-forcesort-by-name").on("click","#s-forcesort-by-name",function(){a.product_sidebar.sortCategoryDialog();
return!1});b.off("click",".s-new-list").on("click",".s-new-list",function(){var b=a(this),d=b.attr("id"),c=0;d?b=d.replace("s-new-",""):(c=b.parents("li.dr:first").attr("id").split("-"),b=c[0],c=c[1]);a.product_sidebar.createListDialog(b,c,function(b,d){var c=a("#s-"+d+"-list"),e=c.find("ul:first");e.length||(c.prepend('<ul class="menu-v with-icons"><li class="drag-newposition" data-type="'+d+'"></li></ul>'),c.find(".drag-newposition").mouseover(),e=c.find("ul:first"));var f=parseInt(b.parent_id,
10)||0,c=a.categories_tree.getHandlerByCategoryId(f),p=function(){if(f){var c=e.find("#"+d+"-"+b.parent_id);c.find(">.collapse-handler-ajax").length||(c.append('<ul class="menu-v with-icons dr"><li class="drag-newposition" data-type="'+d+'"></li></ul>'),c.find(".drag-newposition").mouseover(),c.find(">a").before('<i class="icon16 darr overhanging collapse-handler-ajax" id="'+d+"-"+f+'-handler"></i>'),a.categories_tree.setExpanded(f));e=c.find("ul:first")}e.trigger("add",[b,d])};"category"==d?a.categories_tree.expand(c,
function(){p()}):p()});return!1})},sortCategoryDialog:function(){a("#s-products-sort-categories").waDialog({disableButtonsOnSubmit:!0,onSubmit:function(b){a(this)}})},createListDialog:function(b,c,e){var d=a("#s-product-list-create-dialog");(d.length?d.parent():a("<div></div>").appendTo("body")).load("?module=dialog&action=productListCreate&type="+b+"&parent_id="+c,function(){var d=a("#s-product-list-settings-dialog");d.length&&(d.parent().remove(),d.remove());a("#s-product-list-create-dialog").waDialog({esc:!1,
disableButtonsOnSubmit:!0,onLoad:function(b){a("#s-category-description-content").length&&a.product_sidebar.initCategoryDescriptionWysiwyg(a(this));setTimeout(function(){a("#s-c-product-list-name").focus()},50)},onSubmit:function(d){var c=a(this),f=function(a){"function"===typeof e&&e(a.data,b);location.href="#/products/"+b+"_id="+a.data.id;d.trigger("close")},m=function(a){if(a&&a.errors){a=a.errors;for(var b in a)d.find("input[name="+b+"]").addClass("error").parent().find(".errormsg").text(a[b]);
return!1}};a("#s-category-description-content").length&&a("#s-category-description-content").waEditor("sync");if(c.find("input:file").length)a.products._iframePost(c,f,m);else return a.shop.jsonPost(c.attr("action"),c.serialize(),f,m),!1}})})},initCategoryDescriptionWysiwyg:function(b){var c=b.find(".field.description");c.find("i").hide();c.find(".s-editor-core-wrapper").show();c=.8*b.find(".dialog-window").height()||350;a("#s-category-description-content").waEditor({lang:wa_lang,toolbarFixed:!1,
maxHeight:c,minHeight:c,uploadFields:b.data("uploadFields")})}}})(jQuery);(function(a){Array.prototype.filter||(Array.prototype.filter=function(a,c){var e=this.length;if("function"!=typeof a)throw new TypeError;for(var d=[],f=0;f<e;f++)if(f in this){var g=this[f];a.call(c,g,f,this)&&d.push(g)}return d});a(function(){a("#s-content").on("click",".s-alert-close",function(){var b=a.storage.get("shop/alerts");b||(b=[]);b.push(a(this).parent().data("alert"));a.storage.set("shop/alerts",b);a(this).parent().remove();return!1})});a.storage=new a.store;a.products={hash:"",list_hash:"",
list_params:{},random:"",init:function(b){a.extend(this.options,b);this.initRouting();this.initSearch();a.product_sidebar.init();a.categories_tree.init();this.initCollapsible()},data:{prev_action:null},initRouting:function(){"undefined"!=typeof a.History&&a.History.bind(function(){a.products.dispatch()});a.wa.errorHandler=function(b){return 403===b.status||404===b.status?(b=a(b.responseText),console.log(b),b=b.find(".dialog-content").length?a('<div class="block double-padded"></div>').append(b.find(".dialog-content *")):
a('<div class="block double-padded"></div>').append(b.find(":not(style)")),a("#s-content").empty().append(b),!1):!0};var b=window.location.hash;"#/"!==b&&b?a.wa.setHash(b):this.dispatch()},skip_dispatch:0,forceHash:function(b){b!=location.hash&&(a.products.skip_dispatch++,a.wa.setHash(b))},dispatch:function(b){if(0<a.products.skip_dispatch)a.products.skip_dispatch--;else{void 0===b&&(b=window.location.hash);this.hash=b=b.replace(/(^[^#]*#\/*|\/$)/g,"");try{if(b)if(b=b.split("/"),b[0]){for(var c="",
e=b.length,d=0;d<b.length;d++){var f=b[d];if(2>d)if(0===d)c=f;else if("product"==c||"tag"==c||"search"==c||"plugins"==c||"pages"==c||"stocks"==c){e=d;break}else if(parseInt(f,10)!=f&&-1==f.indexOf("="))c+=f.substr(0,1).toUpperCase()+f.substr(1);else{e=d;break}else{e=d;break}}var g=b.slice(e);this.preExecute(c,g);"function"==typeof this[c+"Action"]?(a.shop.trace("$.products.dispatch",[c+"Action",g]),this[c+"Action"].apply(this,g)):a.shop.error("Invalid action name:",c+"Action")}else this.preExecute(),
this.defaultAction();else this.preExecute(),this.defaultAction()}catch(h){a.shop.error(h.message,h)}}},load:function(b,c){var e=Math.random();this.random=e;var d=this;a.get(b,function(b){if(d.random==e&&(a("#s-content").removeClass("bordered-left").html(b),a("html, body").animate({scrollTop:0},200),c))try{c.call(this)}catch(g){a.shop.error("$.products.load callback error: "+g.message,g)}})},addOptions:function(b){this.options=a.extend(this.options,b||{})},preExecute:function(b,c){try{if(this.data.prev_action&&
this.data.prev_action!=b){var e=this.data.prev_action+"Termination";a.shop.trace("$.products.preExecute",[e,b]);"function"==typeof this[e]&&this[e].apply(this,[])}this.data.prev_action=b;var d=a("#wa"),f=d.data("style");f?d.attr("style",f):d.removeAttr("style");a(window).resize();a("body > .dialog").trigger("close").remove()}catch(g){a.shop.error("preExecute error: "+g.message,g)}},defaultAction:function(){this.productsAction()},welcomeAction:function(){this.load("?module=products&action=welcome")},
paramsFromSession:function(b){if(!(window.sessionStorage&&window.JSON&&window.JSON.stringify&&window.JSON.parse))return b;if(b.category_id){storage=sessionStorage.getItem("shop/list_categories")||"{}";try{storage=JSON.parse(storage)}catch(c){storage={}}var e=storage[b.category_id]=storage[b.category_id]||{};a.each(["sort","order"],function(a,c){void 0===b[c]?b[c]=e[c]:e[c]=b[c]});try{sessionStorage.setItem("shop/list_categories",JSON.stringify(storage))}catch(c){}}return b},buildProductsUrlComponent:function(a){a=
this.paramsFromSession(a);return((a.view?"&view="+a.view:"")+(a.category_id?"&category_id="+a.category_id:"")+(a.set_id?"&set_id="+a.set_id:"")+(a.tag?"&tag="+a.tag:"")+(a.sort?"&sort="+a.sort:"")+(a.order?"&order="+a.order:"")+(a.text?"&text="+a.text:"")+(a.edit?"&edit="+a.edit:"")+(a.hash?"&hash="+a.hash:"")+(a.type_id?"&type_id="+a.type_id:"")).slice(1)},productsAction:function(){var b=Array.prototype.join.call(arguments,"/"),b=a.shop.helper.parseParams(b||"");this.list_hash=this.hash;this.list_params=
b;void 0!==a.product_list&&void 0!==a.product_list.fixed_blocks&&(a.product_list.fixed_blocks.set&&a.product_list.fixed_blocks.set.unsetFixed(),a.product_list.fixed_blocks.category&&a.product_list.fixed_blocks.category.unsetFixed());this.load("?module=products&"+this.buildProductsUrlComponent(b),this.checkAlerts)},checkAlerts:function(){var b=a.storage.get("shop/alerts");a(".s-alert").each(function(){-1==a.inArray(a(this).data("alert"),b)&&a(this).show()})},productAction:function(b,c,e){var d=Array.prototype.slice.call(arguments).filter(function(a){return a.length}).join("/");
a.shop.trace("$.products.productAction",[d,arguments]);var f="?module=product";b&&(f+="&id="+b);"undefined"!=typeof a.product?a.product.dispatch(d):this.load(f,function(b){a.product.dispatch(d)})},productTermination:function(){"undefined"!=typeof a.product&&a.product.termination()},reviewsAction:function(){this.load("?module=reviews")},stocksAction:function(a){this.load("?module=stocks"+(a?"&order="+a:""))},stockslogAction:function(a){this.load("?module=stocksLog"+(a?"&"+a:""))},promosAction:function(a){this.load("?module=promos"+
(a?"&"+Array.prototype.join.call(arguments,"/"):""))},servicesAction:function(b){this.load("?module=services"+(b?"&id="+b:""),function(){a("#s-content").addClass("bordered-left");"function"===typeof a.products.afterServicesAction&&a.products.afterServicesAction()})},initCollapsible:function(){var b=function(b,c){a(b).removeClass("darr").addClass("rarr");e(b).hide();if(!c&&(a.storage.set("shop/products/"+b.id+"/collapse",1),!1!==c)){var g=b.id.replace(/\-handler$/,""),g=a(b).parents("div.block:first").find("#"+
g+":first");g.length&&(g=g.data("on-collapse-url"))&&a.get(g)}},c=function(b){e(b).show();var c=a(b);c.removeClass("rarr").addClass("darr");a.storage.del("shop/products/"+b.id+"/collapse");var g=b.id.replace(/\-handler$/,""),h=c.parents("div.block:first").find("#"+g+"-placeholder:first");if(h.length){var k=a(b).parents("div.block:first").find(".count:first");k.find("i.icon16.loading").remove();k.find("i.icon16").hide();k.prepend('<i class="icon16 loading"></i>');a.get(h.data("url"),function(b){h.replaceWith(a(b));
k.find("i.icon16.loading").remove();k.find("i.icon16").show();h.remove()})}else b=a(b).parents("div.block:first").find("#"+g+":first"),b.length&&(b=b.data("on-expand-url"))&&a.get(b)},e=function(b){b=a(b).parent();return b.is("li")?b.find("ul:first"):b.next()};a(".collapse-handler").die("click").live("click",function(){a(this).hasClass("darr")?b(this):c(this)}).each(function(){var c="shop/products/"+this.id+"/collapse",e=a(this).hasClass("rarr");(a.storage.get(c)||e)&&b(this,!e)});a(".collapse-handler").closest(".heading").off("click").on("click",
function(b){$collapse_handler=a(this).find(".collapse-handler");$collapse_handler.is(b.target)||$collapse_handler.click()})},initSearch:function(){var b=function(){a.wa.setHash("#/products/"+(a.products.list_params&&a.products.list_params.view?"view="+a.products.list_params.view+"&":"")+"text="+encodeURIComponent(this.value))},c=a("#s-products-search");c.unbind("keydown").bind("keydown",function(c){if(13==c.keyCode){b.call(this);var d=a(this);d.autocomplete("close");setTimeout(function(){d.autocomplete("close")},
300);return!1}});c.unbind("search").bind("search",function(){b.call(this);return!1});c.autocomplete({source:"?action=autocomplete",minLength:3,delay:300,select:function(b,d){c.val("");a.wa.setHash("#/product/"+d.item.id);return!1}})},jsonPost:function(b,c,e,d){a.shop.jsonPost(b,c,e,d)},_iframePost:function(b,c,e){var d=b.attr("id")+"-iframe";a("#"+d).length||b.after("<iframe id="+d+" name="+d+" style='display:none;'></iframe>");var f=a("#"+d);b.attr("target",d);f.one("load",function(){var b;try{var d=
a(this).contents().find("body").html();b=a.parseJSON(d)}catch(f){e(d);return}"ok"==b.status?c(b):e(b)})}}})(jQuery);(function(a){a.product={options:{duration:200,container_selector:"#shop-productprofile",message_selector:"#product-save-message",form_selector:"#s-product-save",update_delay:100},message:{submit:'<i class="icon16 loading"></i>',success:'<i class="icon16 yes"></i>',error:'<i class="icon16 no"></i>'},path:{id:null,mode:null,tab:null,tail:null,raw:null,params:{}},ajax:{random:null,target:null,link:null,save:!1,cached:{}},data:{main:{}},getData:function(a,c){return(this.data[a]||{})[c]},setData:function(a,
c,e){this.data[a]=this.data[a]||{};this.data[a][c]=e},standalone_tabs:["images","services","pages","reviews"],init:function(a,c){this.setOptions(a,c)},setOptions:function(b,c){c?this[c+"_options"]=a.extend(this[c+"_options"]||{},b||{}):this.options=a.extend(this.options,b||{});this.options.sidebar_width=this.options.sidebar_width||250},get:function(b){if(this.options[b+"_selector"])return a(this.options[b+"_selector"]);throw new exception("");},parsePath:function(b){b=b.replace(/^.*#\//,"").replace(/(^\/|\/$)/,
"");var c=b.split("/"),e=c.pop(),d={};e.match(/^[\w_\-]+=/)?d=a.shop.helper.parseParams(e):c.push(e);return{id:c[0]||"new",mode:c[1]||"profile",tab:c[1]?c[2]||"main":!1,tail:c.slice(3).join("/")||"",raw:b,params:d}},dispatch:function(b){"string"==typeof b&&(b=this.parsePath(b));var c=[];a.shop.trace("$.product.dispatch",[this.path,b,b.raw]);if(!this.path.id){var e=this.get("container");e.length&&(this.path.id=e.data("product-id"),c.push("load"))}if(this.path.id!=b.id)this.path.id&&c.push("blur"),
c.push("load");else{e="undefined";this.path.mode!=b.mode?(a.shop.trace("$.product.dispatch mode",this.path.mode+"->"+b.mode),this.path.mode&&this.path.tab?(a.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+b.tab),e=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(this.path.mode+"Tab"+e+"Blur"),c.push(this.path.mode+"TabBlur"),c.push(this.path.mode+"Blur")):c.push("focus"),c.push(b.mode+"Init"),c.push(b.mode+"Focus")):this.path.tab&&b.tab!=this.path.tab&&(a.shop.trace("$.product.dispatch tabBlur",
this.path.tab+"->"+b.tab),e=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(b.mode+"Tab"+e+"Blur"),c.push(b.mode+"TabBlur"));c.push(b.mode+"Action");var d=this.tabIsLoaded(b);b.tab&&(e=b.tab.substr(0,1).toUpperCase()+b.tab.substr(1));if(b.tab&&b.tab!=this.path.tab)if(a.shop.trace("$.product.dispatch tabFocus",this.path.tab+"->"+b.tab),d)c.push(b.mode+"TabShow"),c.push(b.mode+"TabInit"),c.push(b.mode+"Tab"+e+"Init"),c.push(b.mode+"TabFocus"),c.push(b.mode+"Tab"+e+"Focus");else{c.push(b.mode+
"TabFocus");var f=b.mode+"Tab"+e+"Load";this.isCallable(f)?c.push(f):c.push(b.mode+"TabLoad")}b.tab&&d&&c.push(b.mode+"Tab"+e+"Action")}for(e=0;e<c.length;e++)if(!1===this.call(c[e],[b]))return!1},termination:function(){var a=[];if(this.path.mode&&this.path.tab){var c=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1);a.push(this.path.mode+"Tab"+c+"Blur");a.push(this.path.mode+"TabBlur");a.push(this.path.mode+"Blur")}a.push("blur");for(c=0;c<a.length;c++)this.call(a[c],[])},isCallable:function(a){return"function"==
typeof this[a]},tabIsLoaded:function(b){return a("#s-product-edit-forms").find(".s-product-form."+b.tab).length?!0:!1},call:function(b,c,e){e=null;var d=this.isCallable(b);c=c||[];a.shop.trace("$.product.call",[b,c,d]);if(d)try{e=this[b].apply(this,c)}catch(f){a.shop.error("Error at method $.product."+b+". Original message: "+f.message,f)}return e},load:function(b){var c=this.get("container");if(!c.length||c.data("product-id")!=b.id){var e=this,c="?module=product&id="+b.id;a.shop.trace("$.product.load product",
c);a.products.load(c,function(){e.dispatch(b)})}this.editTabMainData.sku_id="new"==b.id?-1:0;this.editTabMainData.stocks={}},focus:function(){a("*").off(".product");this.helper.init()},blur:function(){this.path.id=null;this.path.mode=null;this.path.tab=null;this.path.tail=null;a("*").off(".product");a("#mainmenu").find(".s-level2").show();a("#s-product-edit-menu, #s-product-edit-save-panel").hide();a("#s-sidebar").show().animate({width:a.product.options.sidebar_width},"fast").queue(function(){a(this).dequeue()});
a("#s-toolbar").show().animate({width:"200px"});a("#maincontent").animate({"margin-top":"84px"},"fast");a("#s-content").animate({"margin-left":a.product.options.sidebar_width},"fast")},saveData:function(b,c,e){var d=this,f=d.get("form"),g,h="radio",k=f.find('input[name="product[sku_type]"]:first');k.is(":radio")?(g=f.find('input[name="product[sku_type]"]:checked').val(),k=f.find('input[name="product[sku_type]"]')):(h="hidden",g=f.find('input[name="product[sku_type]"]:not(:disabled)').val());if("1"==
g&&!a("#s-product-feature-superposition").find("input:checked:first").length)return"radio"==h&&(k.filter("[value=0]").attr("checked",!0),a.product.onSkuTypeChange(0)),!1;if(d.ajax.save)return setTimeout(function(){d.saveData(b,c,e)},100),!1;if(this.path.tab&&(g="editTab"+this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1)+"Save",!1===this.call(g)))return!1;d.ajax.save=!0;a("#s-product-description-content").length&&a("#s-product-description-content").waEditor("sync");f.find(".s-price").find("input").each(function(){this.value=
this.value.replace(/\s+/g,"")});a.shop.trace("$.product.saveData("+b+","+c+")");g=a("#product-tags_tag");g.length&&(h=jQuery.Event("keypress",{which:13}),g.trigger(h));a(f).find(':input[name^="product\\["]:not(:disabled)').each(function(){var b=a(this).attr("type");if("text"!=b&&"textarea"!=b)return!0;this.defaultValue==this.value?a(this).attr("disabled",!0).addClass("js-ajax-disabled"):a(this).hasClass("js-ajax-disabled")&&a(this).removeAttr("disabled").removeClass("js-ajax-disabled")});this.refresh("submit");
a.ajax({url:a(f).attr("action"),data:a(f).serializeArray(),dataType:"json",type:"post",success:function(f){if("fail"==f.status)d.refresh("error",f.errors);else if(f.data.redirect)a.shop.trace("$.product.saveData redirect",f.data.redirect),window.location.href=f.data.redirect;else if(d.refresh("success",f.data.message||""),a.shop.trace("$.product.saveData updateData",[b,c]),d.updateData(f.data,b,c),e&&"function"==typeof e&&e(),d.path.tab&&(f="editTab"+d.path.tab.substr(0,1).toUpperCase()+d.path.tab.substr(1)+
"Saved",!1===d.call(f)))return!1;d.ajax.save=!1},error:function(a,b,c){d.ajax.save=!1;d.refresh("error",b)}});return!1},updateData:function(b,c,e){a.shop.trace("$.product.updateData("+c+","+e+")",b);var d=a("#s-product-edit-forms .s-product-form.main"),f=this.path.id;if(this.path.id&&"new"!=this.path.id)this.path.id!=b.id&&a.shop.error("Abnormal product ID change",[this.path.id,b]);else{this.path.id=b.id;a(this.options.container_selector).data("product-id",this.path.id);var g="/product/"+this.path.id+
"/";null!==c&&(c=c||this.path.mode||"profile")&&("profile"!=c&&(g+=c+"/"),null!==e&&(e=e||this.path.tab||"")&&"main"!=e.toLowerCase()&&(g+=e+"/"));a.shop.trace("update location.hash="+g);var h=/#\/product\/new\//,k="#/product/"+this.path.id+"/";a("#shop-productprofile, #s-product-edit-menu, #s-product-edit-forms, #s-product-profile-page").find('[href*="#/product/new/"]').each(function(){a(this).attr("href",a(this).attr("href").replace(h,k))});a("#s-product-edit-forms").find(':input[name="product\\[id\\]"]').val(this.path.id);
window.location.hash=g}c=a("#shop-productprofile h1");c.find(".s-product-name:first").text(b.name);c.find(".s-product-id").show().text("id: "+b.id);document.title=b.name+a.product.options.title_suffix;a("#product-stock-stat").html(tmpl("template-product-stock-stat",b.raw));d.find(':input[name="product\\[type_id\\]"]').parents(".value").data("type",b.type_id);if(a.isEmptyObject(b.frontend_urls))a(".s-product-frontend-url-not-empty").hide(),a(".s-product-frontend-url-empty").show();else{c=a("#s-product-frontend-url");
c.text(b.url);a("#s-product-frontend-url-input").val(b.url);c.trigger("readable");e=c.parent();e.attr("href",b.frontend_urls[0].url);e.find("span:first").text(b.frontend_urls[0].base);c.closest("div.value").find(".s-product-frontend-url").each(function(c){b.frontend_urls[c+1]&&a(this).attr("href",b.frontend_urls[c+1].url).text(b.frontend_urls[c+1].url)});a(".s-product-frontend-url-not-empty").show();a(".s-product-frontend-url-empty").hide();c="";e=0;for(g=b.frontend_urls.length;e<g;e+=1)c+=' <span class="s-product-frontend-url-not-empty"><a href="'+
b.frontend_urls[e].url+'" target="_blank">'+b.frontend_urls[e].url+'</a><i class="icon10 new-window"></i></span> ';c&&a("#s-product-frontend-links").find(".s-product-frontend-url-not-empty").wrapAll("<div></div>").closest("div").replaceWith(c)}this.editTabMainUpdate(b.raw||{},b.features_selectable_strings,f);d.find("select.s-product-categories").each(function(){var c=a(this),d=c.parent(),e=c.val();if("select"==e||"---"==e){var f=a("#s-product-edit-forms .s-product-form.main select.s-product-categories");
1<f.length?d.remove():d.find(".s-product-delete-from-category").hide()}else if("create"==e){var g=d.find("input.val").val();"0"==g?(f=a("#s-product-edit-forms .s-product-form.main select.s-product-categories"),1<f.length?d.remove():(c.val(g),c.show().attr("disabled",!1),d.find("input.val").attr("disabled",!0),d.find(".s-new-category").hide(),d.find(".s-product-delete-from-category").hide())):(c.val(g),c.show().attr("disabled",!1),d.find("input.val").attr("disabled",!0),d.find(".s-new-category").hide(),
d.find(".s-product-delete-from-category").show())}e=parseInt(e,10);if(!a.isEmptyObject(b.storefront_map[e])){c="";e=b.storefront_map[e];for(f=0;f<e.length;f+=1)c+='<a class="hint" href="'+e[f]+'" target="_blank">'+e[f]+"</a> ";d.find(".s-storefront-map").html(c)}});a("#s-product-categories").html(tmpl("template-product-categories",{categories:b.categories||[]}));a("#s-product-tags").html(tmpl("template-product-tags",{tags:b.tags||[]}));a("#s-product-save table.s-product-skus > tbody > tr").each(function(){var c=
a(this).data("id");a(this).find("td.s-stock .s-product-stock-icon").each(function(){var d=a(this).data("stock");b.raw&&b.raw.skus&&b.raw.skus[c]&&b.raw.skus[c].stock_icon[d]&&a(this).html(b.raw.skus[c].stock_icon[d])})});d.find("tr.js-sku-settings").each(function(){var c=a(this),d=c.attr("data-id");(d=b.raw.skus[d])&&void 0!==d.file_name&&!d.file_name&&(c.find(".s-sku-attachment").hide(),c.find(".fileupload").show())});this.helper.checkChanges(this.get("form"),!0);a("#s-product-edit-menu li a i.icon10.status-yellow-tiny").remove();
a("#s-product-edit-save-panel :submit").removeClass("yellow").addClass("green");"0"==b.raw.sku_type&&(d=a("#s-product-feature-superposition"),d.find("input[type=checkbox]").attr("checked",!1),f=d.find("ul.features li"),f.find(".count").text(""),f.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass("status-gray-tiny"),d=d.find(".superposition-count"),d.find(".options").text(""),d.find(".skus").text(""));a("#s-product-meta-title").attr("placeholder",b.default_meta_title);a("#s-product-meta-keywords").attr("placeholder",
b.default_meta_keywords);a("#s-product-meta-description").attr("placeholder",b.default_meta_description);a('#s-product-profile-tabs .s-tab-block[data-tab="stock-logs"]').trigger("refresh");this.setData("main","category_name",b.category_name)},refresh:function(b,c){a(this.options.form_selector).find(':input[name^="product\\["]:disabled.js-ajax-disabled').each(function(){a(this).removeAttr("disabled").removeClass("js-ajax-disabled")});var e=a(this.options.message_selector);e.removeClass("errormsg successmsg status").empty().show();
this.timer&&clearTimeout(this.timer);var d=null;e.append(this.message[b]||"");switch(b){case "submit":e.addClass("status");break;case "error":e.addClass("errormsg");for(d=0;d<c.length;d++)e.append(c[d][0]);d=2E4;break;case "success":c&&e.addClass("successmsg").append(c),d=3E3,a("#s-product-edit-save-panel :submit").removeClass("yellow").addClass("green")}d&&(this.timer=setTimeout(function(){e.removeClass("errormsg successmsg status").empty().show()},d))},editTabLoad:function(b,c){var e=this,d=a("#s-product-edit-forms .s-product-form."+
b.tab);c||!d.length&&"new"==b.id?(a.shop.trace("product.profileTabHandler: create",[b.tab+" \u2014 create",b]),this.saveData(this.path.mode,b.tab,function(){b.tab&&e.call(b)})):this.editTabLoadContent(b)},editTabLoadContent:function(b,c){var e=this;b=b||this.path;var d="?module=product&action="+b.tab+"&id="+b.id;b.tail&&(d+="&param[]="+b.tail.split("/").join("&param[]="));var f=Math.random();this.ajax.random=f;var g=a("#s-product-edit-forms .s-product-form."+b.tab);g.length&&g.remove();a("#s-product-edit-forms > form").append(tmpl("template-productprofile-tab",
{id:b.tab}));g=a("#s-product-edit-forms .s-product-form."+b.tab);this.ajax.target=g;this.ajax.link=a("#s-product-edit-menu li."+b.tab);a.shop.trace("$.product.editTabLoadContent",[b,d,b.params]);if(b.params&&c){var h=typeof b.params;switch(h){case "String":d+=b.params;break;case "Array":d+=b.params.serialize();break;default:a.shop.error("unexpected type "+h,b.params)}}a.ajax({url:d,type:c?"POST":"GET",data:c?c||{}:b.params||{},success:function(c,d){a.shop.trace("$.product.loadTab status="+d);if(e.ajax.random==
f){g.empty().append(c);e.ajax.target=null;e.ajax.link=null;var h="#/product/"+b.id+"/edit/";b.tab&&(h+=b.tab+"/");b.tail&&(h+=b.tail+"/");if(b.params&&!a.isEmptyObject(b.params)){var p=[],q;for(q in b.params)b.params.hasOwnProperty(q)&&p.push(q+"="+b.params[q]);h+=p.join("&")}window.location.hash=h;e.dispatch(b)}}})},editTabInit:function(b){a("html, body").animate({scrollTop:0},200);a("#shop-productprofile").find(".s-product-name").removeClass("editable")},editTabFocus:function(b){a("#s-product-edit-menu li."+
b.tab).addClass("selected");this.refresh()},editTabBlur:function(b){if(b){var c=this,e=b.tab;-1!==this.standalone_tabs.indexOf(e)&&this.helper.checkChanges(this.get("form"),!0,function(){c.saveData(c.path.mode,e,function(){e&&c.call(b)})});a("#s-product-edit-forms .s-product-form").hide();a("#s-product-edit-menu li.selected").removeClass("selected");this.path.tab=null;this.path.tail=null}},editTabShow:function(b){var c=a("#s-product-edit-forms .s-product-form."+b.tab);c.length?(c.show(),a.shop.trace("$.product.showTab",
b),this.path.tab=b.tab):a.shop.error("$.product.showTab",b)},editClick:function(b){var c=b.attr("href").replace(/.*#\/product\/(\d+|new)\/edit\//,"").replace(/\/$/,"").split("/"),e=[],d;if(c.length){a.shop.trace("$.product.editClick",c);for(var f,g="editTab";f=c.shift();)g+=f.substr(0,1).toUpperCase()+f.substr(1),f="function"==typeof this[g],a.shop.trace("$.settings.featuresClick try",[g,f,c]),!0===f&&(d=g,e=c.slice(0))}if(d){if(a.shop.trace("$.product.editClick",[d,e]),!b.hasClass("js-confirm")||
confirm(b.attr("title")||"Are you sure?")){e.push(b);try{this[d].apply(this,e)}catch(h){a.shop.error("Error: "+h.message,h)}}}else a.shop.error("Not found js handler for link",[d,b]);return!1},switchSubMenu:function(b){b=b||"default";a("#mainmenu .s-submenu > *").hide();a("#mainmenu .s-submenu .s-submenu-"+b).show()},profileFocus:function(){var b=this.options.duration,c=this;a("#s-product-edit-menu, #s-product-edit-save-panel").hide();c.switchSubMenu();a("#s-sidebar").show().animate({width:a.product.options.sidebar_width});
a("#s-toolbar").show().animate({width:"200px"},b).queue(function(){a(this).dequeue();a("#s-product-edit-forms").hide();a("#s-product-profile-page, h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").show();c.get("container").find(".back").attr("href","#/"+a.products.list_hash)});a("#maincontent").animate({"margin-top":"84px"},b);a("#s-content").animate({"margin-left":a.product.options.sidebar_width},b);a("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product",
"a.js-action",function(){return c.editClick(a(this))})},profileAction:function(){this.path.mode="profile"},disableSkus:function(b,c){var e=a(this.options.form_selector).find(".s-sku-list");b?c?e.find(".s-sku-virtual").hide().find(":input").attr("disabled",!0):e.find(".s-sku-virtual").show().find(":input").attr("disabled",!1):(c?e.hide():e.show(),e.find(":input").attr("disabled",c))},skuTypeFeaturesSelectableLoad:function(b,c){var e=this,d="?module=product&action=featuresSelectable&id="+this.path.id,
f={type_id:b,sku_type:1};a("#s-product-feature-superposition-field-group").load(d,f,function(){var a=e.featureSelectableInit();c&&(c.base_price_selectable&&a.find(':input[name="product[base_price_selectable]"]').val(c.base_price_selectable),c.currency&&a.find("select.s-product-currency").val(c.currency));e.onSkuTypeEnabled(b)})},onSkuTypeEnabled:function(b){var c=a("#s-product-feature-superposition-field-group");b&&c.data("type",b);c.show();c.find("input").attr("disabled",!1);"new"==a.product.path.id?
a.product.disableSkus(!1,!0):a.product.disableSkus(!0,!1);a(this.options.form_selector).find(".s-product-skus").closest(".field").find(".name").hide()},onSkuTypeChange:function(b){var c=a("#s-product-feature-superposition-field-group");a.shop.trace("onSkuTypeChange",{sku_type:b});if("1"==b)if(b=a(this.options.form_selector+' :input[name="product[type_id]"]').val(),c.data("type")!=b)c={base_price_selectable:c.find(':input[name="product[base_price_selectable]"]').val(),currency:c.find("select.s-product-currency").val()},
a.product.skuTypeFeaturesSelectableLoad(b,c);else a.product.onSkuTypeEnabled();else c.hide(),c.find("input").attr("disabled",!0),c=a(this.options.form_selector).find(".s-product-skus"),"new"==a.product.path.id?a.product.disableSkus(!1,!1):(b=c.find("tbody"),a.product.disableSkus(!0,!0),b.find(">tr:not(.s-sku-virtual)").length||(a.product.editTabMainSkuAdd(),b.find(">tr:not(.s-sku-virtual):first").find('input[name="product[sku_id]"]').attr("checked",!0))),c.closest(".field").find(".name").show()},
featureSelectableInit:function(){var b=a(this.options.form_selector),c=a("#s-product-feature-superposition"),e=b.find(".s-product-skus"),b=b.find(':input[name="product[base_price_selectable]"]');c.on("click","ul.features>li",function(){var b=a(this);b.parent().find("li.selected").removeClass("selected");b.addClass("selected");b=b.attr("data-feature-id");b=c.find(".feature-values[data-feature-id="+b+"]");c.find(".feature-values").hide();b.show();return!1});c.on("change","ul.values>li input",function(){var b=
a(this).parents("li:first").parent().find(">li input:checked").length,e=c.find("ul.features li.selected");e.find(".count").text(b||"");b=b?"status-blue-tiny":"status-gray-tiny";e.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass(b);d()});a.shop.changeListener(b,function(){e.find(".s-sku-virtual .s-price input").val(a(this).val())});a.shop.changeListener(e,function(){var b=a(this);if("product[sku_id]"!=b.attr("name")&&(b=b.parents("tr:first"),b.length)){var c=parseInt(b.attr("data-id"),
10);if(c){if(b.hasClass("js-sku-settings")&&(b=e.find("tr[data-id="+c+"]:first"),!b.length))return;b.find("input.s-input-virtual").val(0);b.removeClass("s-sku-virtual");a("#s-product-view").find("tr[data-id="+c+"]").removeClass("s-sku-virtual")}}},"input, textarea");var d=function(){var b=[];c.find("ul.features>li").each(function(){var c=a(this);(c=parseInt(c.find(".count").text(),10))&&b.push(c)});var d=c.find(".superposition-count");if(b.length){d.find(".options").text(b.join(" x ")+" "+$_("options"));
for(var e=1,k=0,m=b.length;k<m;k+=1)e*=b[k];d.find(".skus").html('<span class="highlighted">'+$_("%d SKUs in total").replace("%d",e)+"</span>")}else d.find(".options").text(""),d.find(".skus").html("")};c.find("i.status-blue-tiny:first").parents("li").trigger("click");return c},editInit:function(){a("#s-product-edit-forms").unbind("keydown.product").bind("keydown.product",function(b){if(a(b.target).is(":input")&&b.ctrlKey&&83==b.keyCode)return a("#s-product-save-button").click(),!1});a.shop.makeFlexibleInput("s-product-meta-title");
if(!this.options.edit_rights)return window.location.hash="#/product/"+this.path.id+"/",!1;var b=a(this.options.form_selector);b.bind("submit.product",function(b){return a.product.saveData("profile",null)});b.on("change.product, keyup.product","div.s-product-form:not(.ajax) :input",function(b){a.product.helper.onChange(a(this).parents("div.s-product-form"))});b.on("change.product, keyup.product, keypress.product",':input[name="product[name]"]',function(b){a.product.helper.onNameChange(a(this),!1,a.product.options.update_delay||
500)});var c=a("#product-tags");c.data("tags_input_init")||(c.tagsInput({autocomplete_url:"?module=product&action=tagsAutocomplete",height:120,onChange:function(){a.product.updateMetaFields()},defaultText:""}).data("tags_input_init",!0),a("#s-product-popular-tags").off("click.product","a").on("click.product","a",function(){var b=a(this).text();c.removeTag(b);c.addTag(b)}));b.on("change.product",".s-product-currency",function(){var c=a(this).val();b.find(".s-product-currency").val(c);b.find(".s-product-currency-readonly").text(c);
a("#s-product-currency-code").val(c)});b.on("change.product",':input[name="product[type_id]"]',function(){return a.product.editTabMainTypeChange(a(this))});b.on("change",'select[name="product[status]"]',function(){"1"==a(this).val()?(a(this).prev().removeClass("no-bw").addClass("yes"),a(".s-product-status-text").hide()):(a(this).prev().removeClass("yes").addClass("no-bw"),a(".s-product-status-text").show())});b.on("change",'input[name="product[sku_type]"]',function(){a.product.onSkuTypeChange(this.value)}).change();
a.product.featureSelectableInit()},editFocus:function(){var b=this.options.duration,c=this;a("h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").hide();a("#s-sidebar, #s-toolbar").animate({width:0},b).queue(function(){a(this).hide();a(this).dequeue();a("#s-product-edit-menu, #s-product-edit-forms, #s-product-edit-save-panel").show();"new"!=c.path.id?c.get("container").find(".back").attr("href","#/product/"+c.path.id+"/"):c.get("container").find(".back").attr("href","#/"+a.products.list_hash);
a("#s-product-profile-page").hide();c.switchSubMenu("productprofile")});a("#maincontent").animate({"margin-top":"40px"},b);a("#s-content").animate({"margin-left":0},b);a("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return c.editClick(a(this))})},editBlur:function(){this.path.tab=!1;this.path.mode=!1;a(a.product.options.form_selector).off("submit.product");a(this.options.form_selector).off("change.product, keyup.product");a("#s-product-edit-forms").off("click.edit-product")},
editAction:function(a){this.path.mode=a.mode},editTabMainData:{sku_id:-1,stocks:{}},editTabMainInit:function(b){a("#s-product-type").each(function(){a(this).parent().get(0)!=document.body&&(a("body > #s-product-type").remove(),a(document.body).append(a(this)))});var c=a("#s-product-edit-forms .s-product-form.main"),e=this,d=c.find("table.s-product-skus:last > tbody");d.sortable({distance:5,helper:"original",items:"> tr",handle:"i.sort",opacity:.75,tolerance:"pointer",update:function(b,c){var f=parseInt(a(c.item).data("id"),
10),m=a(c.item).prev().data("id"),m=void 0===m?0:parseInt(m,10);e.editTabMainSkuSort(f,m,a(this));m=d.find('> tr.js-sku-settings[data-id="'+f+'"]');m.length&&(m=m.detach(),a.shop.trace("detach",m),m&&(a.shop.trace("detach",d.find('> tr[data-id="'+f+'"]').length),d.find('> tr[data-id="'+f+'"]:first').after(m)))},start:function(a,b){d.find("> tr.js-sku-settings").hide()},stop:function(a,b){d.find("> tr.js-sku-settings").show()}});var f=a("#s-product-frontend-url");f.inlineEditable({editLink:"#s-product-frontend-url-edit-link",
editOnItself:!1,minSize:{height:15,width:100},makeReadableBy:[],beforeMakeEditable:function(b){var c=a(this).closest("span.s-product-frontend-url-not-empty"),d=c.find("span.slash"),e=c.find("i.new-window");a(b).after(d);e.hide();c.find("a.s-frontend-base-url").hide();c.find("span.s-frontend-base-url").show()},beforeBackReadable:function(b,c){var d=a(this).closest("span.s-product-frontend-url-not-empty"),e=d.find("span.slash");d.find("i.new-window").show();d.find("span.s-frontend-base-url").hide();
d.find("a.s-frontend-base-url").show().append(e)}});parseInt(b.id,10)||f.trigger("editable");"new"==b.id&&a.product_list&&a.isArray(a.product_list.collection_hash)&&("category"==a.product_list.collection_hash[0]?c.find("select.s-product-categories").val(a.product_list.collection_hash[1]):"set"==a.product_list.collection_hash[0]&&c.find(".add-set-button").click().closest(".field").find("select:first").val(a.product_list.collection_hash[1]));c.off("change.product","select.s-product-categories").on("change.product",
"select.s-product-categories",function(b){b=a(this);var c=b.val(),d=b.parent(),e=d.find(".s-product-delete-from-category"),f=parseInt(c,10)||0;f?e.show():e.hide();"create"==c?(d.find(".s-new-category").show(),d.find("input.val").attr("disabled",!1),b.hide().attr("disabled",!0).addClass("js-ignore-change")):d.find("input.val").val(f)});c.off("keydown.product","input.new-category").on("keydown.product","input.new-category",function(b){if(13==b.keyCode)return a(this).parent().find("input[type=button]").click(),
!1});c.off("click.product",".s-new-category input[type=button]").on("click.product",".s-new-category input[type=button]",function(b){var c=a(this).parent(),d=c.parent(),e=c.find("input[name=new_category]");b=e.val();a.shop.jsonPost("?module=products&action=saveListSettings&category_id=0&parent_id=0",{name:b},function(b){var f=d.find("select"),g=f.find("option.separator:first").show();a.when(g.after('<option class="category" value="'+b.data.id+'">'+b.data.name+"</option>")).then(function(){f.find("option:first").text($_("Please select a category"));
f.val(b.data.id).attr("disabled",!1).show().removeClass("js-ignore-change");c.find("input.val").val(b.data.id).attr("disabled",!0);c.hide();d.find(".s-product-delete-from-category").show();e.val("");a.product.helper.onTabChanged("main",!0);a("#s-product-save-button").removeClass("green").addClass("yellow");a("#s-category-list>ul").trigger("add",[b.data,"category"])})})});c.off("click.product",".s-product-delete-from-category").on("click.product",".s-product-delete-from-category",function(){var b=
a(this),c=b.parent("div"),d=c.find("select");if(d.length)if(2<a("#s-product-edit-forms .s-product-form.main select.s-product-categories").length){d.attr("disabled",!0);var e=c.parents("div.field:first").find('input[name="product[categories.deleted]"]');if(0<parseInt(d.val())){var f=e.val().split(",");f.push(d.val());f.sort();e.val(f.join(","));a.product.helper.onChange(a.product.get("form").find("div.main:first"))}c.remove()}else d.val("selected").attr("disabled",!1),c.find("input.val").val(0).attr("disabled",
!0).parent().hide(),c.find(".s-storefront-map").html(""),c.find(".s-product-delete-from-category").hide();else e=c.parents("div.field:first").find('input[name="product[categories.deleted]"]'),d=b.parents(".value:first").find(":input:first"),0<parseInt(d.val())&&(f=e.val().split(","),f.push(d.val()),f.sort(),e.val(f.join(",")),a.product.helper.onChange(a.product.get("form").find("div.main:first"))),b.parents(".value:first").remove();return!1})},editTabMainAction:function(b){var c=!1,e=null;b&&b.params&&
b.params.focus?(e=b.params.name||"",!e.length&&b.params.sku&&(e="product[skus]["+parseInt(b.params.sku,10)+"]",b.params.focus&&(e+="["+b.params.focus+"]"),"stock"==b.params.focus&&(e+="["+(parseInt(b.params.stock,10)||0)+"]")),c=':input[name$="'+e.replace(/(\[|\]|\|\-)/g,"\\$1")+'"]:first'):b&&"new"==b.id&&(c=':input[name$="[name]"]:first');c&&(a.shop.trace("$.product.editTabMainFocus",[e,a(c).length]),setTimeout(function(){a(c).focus();window.location.hash="#/product/"+b.raw.replace(/\/focus=.*$/,
"/")},100))},editTabMainBlur:function(){},editTabMainSave:function(){if(!1===this.call("editTabMainSkuEproductSave"))return!1},helper:{options:{tab_changed:'<i class="icon10 status-yellow-tiny"></i>',defaultChangedStatus:!1},data:{url_helper:{url:"",name:"",timer:null}},init:function(){this.data.url_helper={url:"",name:"",timer:null}},onTabChanged:function(b,c){a.shop.trace("$.product.onTabChanged id="+b+" changed="+c);a("#s-product-edit-menu li."+b+" .s-product-edit-tab-status").html(c?this.options.tab_changed:
"")},type:function(b){return parseInt(b,10)||parseInt(a('#s-product-edit-forms .s-product-form.main :input[name="product\\[type_id\\]"]').val(),10)||0},onNameChange:function(b,c,e){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var d=a(a.product.options.form_selector).find(':input[name="product\\[url\\]"]'),f=d.parent();if(a.product.path.id&&"new"!=a.product.path.id||d.val()!=this.data.url_helper.url)a.shop.trace("$.product.onNameChange stop "+this.data.url_helper.url+" != "+
d.val()),a(a.product.options.form_selector).off(".product",':input[name="product\\[name\\]"]'),f.find(".js-url-helper").hide();else{c&&(f.find(".js-url-helper").length?f.find(".js-url-helper").show():f.append('<i class="icon16 loading js-url-helper"></i>'));var g=this;this.data.url_helper.timer=setTimeout(function(){g.urlHelper(b,d,e)},e||500)}},onChange:function(b){var c=this.getContainerId(b),e=this;this.checkChanges(b.parents("form"),!1,function(d){a("#s-product-edit-save-panel :submit").removeClass(d?
"green":"yellow").addClass(d?"yellow":"green");if(d)e.checkChanges(b,!1,function(a){e.onTabChanged(c,a)});else e.onTabChanged(c,d)})},urlHelper:function(b,c){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var e={str:a(b).val()};a.shop.trace("$.product.urlHelper ",e);if(e.url!=this.data.url_helper.name){var d=this;this.data.url_helper.url=e.url;a.ajax({url:"?action=transliterate",dataType:"html",data:e}).done(function(b){(b=a.parseJSON(b))&&"ok"==b.status&&(d.data.url_helper.url=
b.data,c.val(b.data),c.parent().find(".js-url-helper").hide())})}else c.parent().find(".js-url-helper").hide()},getValueByName:function(b,c){for(var e=b,d=c.replace(/\]/,"").split("[");d.shift();)if(void 0!==e[c])e=e[c];else{e="";break}a.shop.trace("$.product.helper.getValueByName",[e,c,b]);return e},checkChangesStack:{},checkChanges:function(b,c,e){var d=b.attr("id");this.checkChangesStack[d]&&(clearTimeout(this.checkChangesStack[d]),this.checkChangesStack[d]=null);a.shop.trace("$.product.helper.checkChanges",
[b,c]);var f=this;this.checkChangesStack[d]=setTimeout(function(){var a=f.checkChangesDelayed(b,c);e&&e(a)},c?50:500)},checkChangesDelayed:function(b,c){var e=this.options.defaultChangedStatus,d=this,f=":input:not(.js-ignore-change)";if(b.hasClass("s-product-form")){if(b.hasClass("ajax"))return!1}else f=".s-product-form:not(.ajax) "+f;b.find(f).each(function(){var b=(a(this).attr("type")||this.tagName).toLowerCase();switch(b){case "input":case "text":case "textarea":if(a(this).hasClass("ace_text-input"))break;
this.defaultValue!=this.value&&(e=!0,c&&(this.defaultValue=this.value,d.updateInput(this.name,this.value,"textarea"==b)));break;case "radio":case "checkbox":this.defaultChecked!=this.checked&&(e=!0,c&&(this.defaultChecked=this.checked));break;case "select":this.length&&a(this).find("option").each(function(){this.defaultSelected!=this.selected&&(e=!0,c&&(this.defaultSelected=this.selected));return c||!e});break;case "file":this.value&&(e=!0,c&&(this.value=null));break;case "reset":case "button":case "submit":break;
case "hidden":break;default:a.shop.error("$.product.checkChangesDelayed unsupported type "+b,[b,this])}!c&&e&&a.shop.trace("$.product.helper.checkChangesDelayed",[this,e,this.defaultValue,this.value]);return c||!e});return e},getContainerId:function(b){b=(a(b).attr("class")||"").split(" ");var c=!1,e;for(e in b)if("s-product-form"!=b[e]){c=b[e];break}return c},updateInput:function(b,c,e,d){if(b){var f=".s-"+b.replace(/\[(.+?)\]/g,"-$1")+"-input";a.shop.trace("update field: "+b+" "+f,c);var g=a(f);
g.is("input,textarea")?g.val(c):e?"product[summary]"===b?g.text(c):g.html(c):g.text(c);d&&(b=a(f).attr("name"),b=b.replaceAll(/\[-[\d]+\]/,"["+d+"]"),a.shop.trace("$.product.helper.updateInput name",[b]))}},count:function(a){var c=0,e;for(e in a)a.hasOwnProperty(e)&&c++;return c}},multiSkus:function(b){var c=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first");1<b?(c.find("thead tr").show(),c.find(".s-name,.s-sku-sort").show("slow"),c.find(".delete").parent("a").show(),2==b?
c.find("> tbody:first > tr:first .s-name :input").focus():c.find("> tbody:first > tr:last .s-name :input").focus()):(c.find("thead tr").hide(),c.find(".s-name,.s-sku-sort").hide(),c.find(".delete").parent("a").hide())},editTabMainSkuAdd:function(){try{var b=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),c=0,e="0";b.find(':input[name$="[price]"]').each(function(){var b=a(this),d=b.val()?b.val().replace(",","."):0,d=parseFloat(d);d>c&&(c=d,e=b.val()||
"0")});var d=0;b.find(':input[name$="[purchase_price]"]').each(function(){d=Math.max(d,parseFloat(a(this).val())||0)});a.product.multiSkus(b.find("tr:not(.js-sku-settings)").length+1);var f={id:--a.product.editTabMainData.sku_id,product_id:a('input:hidden[name="product[id]"]').val()||"new",sku:"",available:1,name:"",price:""+c,price_loc:e,purchase_price:""+d,stock_icon:{0:"<i class='icon10 status-green' ></i>"},stock:{},count:null};a.shop.trace("$.product.editTabMainSkuAdd",[a.product.editTabMainData.sku_id,
f]);b.append(tmpl("template-sku-edit",{sku_id:a.product.editTabMainData.sku_id,sku:f,stocks:this.getData("main","stocks"),stock_ids:this.getData("main","stock_ids")},!0));b.find(".s-product-currency").trigger("change")}catch(g){a.shop.error(g.message,g)}return!1},editTabMainSkuSort:function(b,c,e){try{a.post("?module=product&action=skuSort",{product_id:this.path.id,sku_id:b,after_id:c},function(b){a.shop.trace("$.product.editTabMainSkuSort result",b);b.error&&(a.shop.error("Error occurred while sorting product SKUs",
"error"),e.sortable("cancel"))},function(b){a.shop.trace("$.product.editTabMainSkuSort cancel",{data:b});e.sortable("cancel");a.shop.error("Error occurred while sorting product SKUs","error")})}catch(d){a.shop.error(d.message,d)}return!1},editTabMainProductDelete:function(b){b=a("#s-product-list-delete-products-dialog");var c=b.parent();b.length||(c=a("<div></div>").appendTo("body"));c.load("?module=dialog&action=productsDelete&count=1",function(){a("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(b){a(this).find(".dialog-buttons i.loading").show();a.shop.jsonPost("?module=products&action=deleteList",{product_id:[a.product.path.id],get_lists:1},function(c){a.product_list&&a("#s-sidebar").trigger("update",c.data.lists);b.trigger("close");window.location.hash="#/products/"});return!1}})});return!1},editTabMainSkuDelete:function(b,c){var e=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),
d=c.parents("tbody").find('> tr[data-id="'+b+'"]'),f=this;0<b?1<c.parents("tbody").find('tr[data-id]:not(.js-sku-settings):not([data-id^="-"])').length?a.ajax({url:"?module=product&action=skuDelete",data:{sku_id:b,product_id:this.path.id},dataType:"json",type:"post",success:function(c){"fail"==c.status?f.refresh("error",c.errors):c.data.redirect?window.location.href=c.data.redirect:(f.refresh("success",c.data.message||"Success"),d.hide("normal",function(){d.remove();a('#s-product-view table.s-product-skus > tbody > tr[data-id="'+
b+'"]').remove();a.product.multiSkus(e.find("tr:not(.js-sku-settings)").length)}),a("#s-product-edit-forms .s-product-form.main").find("input[name=product\\[sku_id\\]][value="+c.data.sku_id+"]").attr("checked",!0))},error:function(a,b,c){f.refresh("error",b)}}):f.refresh("error",$_("A product must have at least one SKU.")):d.hide("normal",function(){d.remove();a('#s-product-view table.s-product-skus > tbody >tr[data-id="'+b+'"]').remove();a.product.multiSkus(e.find("tr:not(.js-sku-settings)").length)})},
editTabMainCategoriesAdd:function(){var b=a("#s-product-edit-forms .s-product-form.main select.s-product-categories:last").parent("div"),c=b.clone(!1);c.find("select").val("select").attr("disabled",!1).show();c.find("input.val").val(0).attr("disabled",!0).parent().hide();c.find(".s-product-delete-from-category").hide();c.find(".s-storefront-map").html("");c.show();b.after(c)},editTabMainSkuStock:function(b,c){var e=a("#s-product-sku-"+b);e.hide().find(":input:enabled").attr("disabled",!0);var d=a("#s-product-sku-stock-"+
b);d.show().find(":input:disabled").removeAttr("disabled");d.find(":input:first").val(e.find(":input:first").val())},editTabMainSkuSettings:function(b,c){c.hide();var e=c.parents("tr"),d=e.data(),f=this;a.when(e.after(tmpl("template-sku-settings",{sku_id:b,sku:d}))).done(function(){var c;c="?module=product&action=skuSettings&product_id="+f.path.id;c+="&sku_id="+b;var d=a('#s-product-edit-forms .s-product-form.main tr.js-sku-settings[data-id="'+b+'"] > td:first');d.load(c,function(){e.find(':input[name$="[available]"]').remove();
a.product_images&&a.product_images.options&&a.product_images.options.enable_2x&&a.fn.retina&&d.find(".s-product-image-crops img").retina();if(0<b){a.shop.trace("fileupload",[d.find(".fileupload").length,typeof d.find(".fileupload").fileupload]);try{var c=document.cookie.match(/(?:^|; )_csrf=([^;]*)/),f=c?decodeURIComponent(c[1]):"";d.find(".fileupload:first").fileupload({dropZone:null,url:"?module=product&action=skuEproductUpload",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,start:function(){d.find(".fileupload:first").hide()},
progress:function(b,c){a.shop.trace("fileupload progress",c);var e=d.find(".js-progressbar-container");e.show();e.find(".progressbar-inner:first").css("width",Math.round(100*c.loaded/c.total,0)+"%")},done:function(b,c){a.shop.trace("fileupload done",[c.result,typeof c.result]);var f=(c.result.files||[]).shift();d.find(".js-progressbar-container").hide();if(!f||f.error)d.find(".error-message").text(f.error).show(),d.find(".fileupload:first").addClass("error").show();else{var g=d.find(".s-sku-attachment");
g.find("input.s-input-file-name").val(f.name);g.find(".s-file-name").text(f.name);g.find(".s-file-size").text(f.size);g.find(".s-file-description").val("");g.find("input[type=checkbox]").attr("checked",!0);g.show();e.find("input.s-input-virtual").val(0)}},fail:function(b,c){a.shop.trace("fileupload fail",[c.textStatus,c.errorThrown]);d.find(".error-message").text("error").show().text(c.errorThrown||"error");d.find(".js-progressbar-container").hide();d.find(".fileupload:first").addClass("error").show()},
formData:{product_id:a.product.path.id,sku_id:b,_csrf:f}})}catch(g){a.shop.error("Exception "+g.message,g)}}})})},editTabMainSkuImageSelect:function(b,c,e){b=e.parents("li:first");var d=b.hasClass("selected"),f=e.parents("div.value:first");f.find("ul.s-product-image-crops li.selected").removeClass("selected");d?f.find('input[name$="[image_id]"]').val(0):(b.addClass("selected"),f.find('input[name$="[image_id]"]').val(c));a.shop.trace("$.product.editTabMainSkuImageSelect",[f,f.find(':input[name$="[image_id]"]')]);
a.product.helper.onChange(e.parents("div.s-product-form"))},editTabMainSkuEproductSave:function(b){b=a("#s-product-edit-forms .s-product-form.main tr.js-sku-settings"+(b&&0<b?'[data-id="'+b+'"]':"")+" > td:first .fileupload");a.shop.trace("$.product.editTabMainSkuEproductSave",b.length);b.length&&b.fileupload("start")},editTabMainSkuEproductDelete:function(a){},editTabMainLinkEdit:function(a){return!1},editTabMainTypeSelect:function(a){var c=a.parents("form").find(':input[name="product[type_id]"]').parents(".value");
"main"==this.path.tab?a.hide():(c.find(".js-action").hide(),window.location.hash="/product/"+this.path.id+"/"+this.path.mode+"/");c.find(".js-type-name").hide();c.find(":input").show().focus();setTimeout(function(){c.find(":input").focus()},100)},editTabMainTypeChange:function(b){var c=b.parents(".value"),e=b.find(":selected:first"),d=e.val();b=parseInt(e.data("sku-type"));c.find(".js-type-icon").html(e.data("icon"));c.find(".js-type-name").html(e.text());d!=c.data("type")?a("#s-product-edit-forms .s-product-form.features").length&&
"undefined"!=typeof this.editTabFeaturesReload?this.editTabFeaturesReload(d):(c=a("#s-product-edit-menu > li.features > a"),d="/features/"+d+"/",c.attr("href",c.attr("href").replace(/\/features\/.*$/,d))):(c=a("#s-product-edit-menu > li.features > a"),d="/features/",c.attr("href",c.attr("href").replace(/\/features\/.*$/,d)));c=a(this.options.form_selector+' :input[name="product[sku_type]"]');a.shop.trace("sku_type",[b,c]);c.filter('[value="1"]').trigger("disabled",[b?null:!0]);d=c.parents("ul");b?
(c.filter(":checked").change(),d.find('[data-sku-type="1"]').hide()):(c.filter('[value="0"]').trigger("checked",!0).change(),d.find('[data-sku-type="1"]').show())},editTabMainUpdate:function(b,c,e){var d=a("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody"),f=a("#s-product-view table.s-product-skus tbody");d.find('tr[data-id^="-"]').remove();f.find('tr[data-id^="-"]').remove();d.parents("table").find("tr:hidden").show();var g=[],h;for(h in b.skus||{})g.push(a.extend({id:h},b.skus[h]));
g=g.sort(function(a,b){return a.sort-b.sort});h=this.getData("main","stocks");var k=this.getData("main","stock_ids"),m="";tmpl.cache["template-sku-edit"]=tmpl(tmpl.load("template-sku-edit"));for(var n=0,p=g.length;n<p;n+=1)m+=tmpl("template-sku-edit",{sku_id:g[n].id,sku:g[n],stocks:h,stock_ids:k,checked:g[n].id==b.sku_id});d.html(m);d.find("select.s-product-currency").val(b.currency);d.parent().show();d.closest(".s-sku-list").show();this.multiSkus(d.find("tr:not(.js-sku-settings)").length);m="";n=
0;for(p=g.length;n<p;n+=1)m+=tmpl("template-sku",{sku_id:g[n].id,sku:g[n],stocks:h,stock_ids:k,runout:b.runout||{}});f.html(m);e&&"new"!=e||d.parents("div.field-group:first").after(a("#s-sku-type-field-group"));c&&(e=a("#s-product-feature-superposition .superposition-count"),e.find(".options").text(c.options),e.find(".skus").html('<span class="highlighted">'+c.skus+"</span>"));var q=/#\/product\/new\//,u="#/product/"+b.id+"/";a("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody, #s-product-view table.s-product-skus tbody").find('[href*="#/product/new/"]').each(function(){a(this).attr("href",
a(this).attr("href").replace(q,u))})},editTabDescriptionsBlur:function(){var b=a("#s-product-description-content");b.length&&b.data("redactor")&&b.waEditor("sync")},editTabDescriptionsAction:function(){var b=a("#s-product-description-content");if(b.length&&!b.data("redactor")){var c=b.parents("div.s-product-form");b.waEditor({lang:wa_lang,toolbarFixedTopOffset:a("#mainmenu").length?a("#mainmenu").height():0,uploadFields:b.data("uploadFields"),changeCallback:function(){b.length&&(b.waEditor("sync"),
a.product.helper.onChange(c))}})}},profileInit:function(){void 0!==a.product_list&&void 0!==a.product_list.fixed_blocks&&(a.product_list.fixed_blocks.set&&a.product_list.fixed_blocks.set.unsetFixed(),a.product_list.fixed_blocks.category&&a.product_list.fixed_blocks.category.unsetFixed());if(this.options.edit_rights){var b=a("#shop-productprofile").find(".s-product-name");parseInt(this.path.id,10)?b.addClass("editable"):b.removeClass("editable");var c=this.get("form");b.inlineEditable({minSize:{width:150},
maxSize:{width:550},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){a("#s-edit-product").hide()},afterBackReadable:function(b,d){a("#s-edit-product").show();if(!d.changed)return!1;a.shop.jsonPost("?module=product&action=save&id="+a.product.path.id,{update:{name:a(b).val()}},function(d){var g=a(b).val();document.title=g+a.product.options.title_suffix;"ok"===d.status&&d.data&&a("#s-product-meta-title").attr("placeholder",d.data.default_meta_title);c.find('input[name="product[name]"]').val(g)})},
hold:function(){return!a(this).hasClass("editable")}})}this.call("profileLazyInit",[])},profileLazyInit:function(){var b=a("#product-sales-plot");if(window.sales_data&&sales_data.length){if(!b.data("graph_rendered")){var c=function(){b.length&&0<b.width()?(showSalesGraph(sales_data,"undefined"==typeof cash_type?null:cash_type),b.data("graph_rendered",1)):setTimeout(c,1E3)};c()}}else b.remove();if(sku_plot_data&&sku_plot_data.length&&sku_plot_data[0]&&sku_plot_data[0].length){if(!a("#product-sku-plot").data("graph_rendered")){var e=
[];a.each(sku_plot_data[0],function(a,b){e.push({label:b[0],value:b[1]})});showPieGraph(e,{color_type:"products"});a("#product-sku-plot").data("graph_rendered",1)}}else a("#product-sku-plot").remove()},updateMetaFields:function(){var b=a(".s-product-name-input").val();a("#s-product-meta-title").attr("placeholder",b);var c=[b],e=5;a(".s-sku-name-input").each(function(){if(0>=e)return!1;var b=a.trim(a(this).val());b&&c.push(b);--e});b=this.getData("main","category_name");null!==b&&c.push(b);for(var b=
a("#product-tags").val().split(","),e=5,d=0;d<b.length&&!(0>=e);d+=1){var f=a.trim(b[d]);f&&c.push(f);--e}a("#s-product-meta-keywords").attr("placeholder",c.join(", "));a("#s-product-meta-description").attr("placeholder",a("#s-product-summary").val())},getId:function(){return this.path.id}}})(jQuery);(function(a){a.fn.rateWidget=function(b,c,e){function d(){k.attr("id")||k.attr("id",(""+Math.random()).substr(2));null!==h.rate&&k.attr("data-rate",h.rate);k.find("i:lt("+k.attr("data-rate")+")").removeClass("star-empty").addClass("star");k.mouseover(function(b){h.hold.call(k)||(b=b.target,"I"==b.tagName&&(b=a(b),b.prevAll().removeClass("star star-empty").addClass("star-hover").end().removeClass("star star-empty").addClass("star-hover"),b.nextAll().removeClass("star star-hover").addClass("star-empty")))}).mouseleave(function(){h.hold.call(k)||
f.call(k,k.attr("data-rate"))});k.click(function(b){if(!h.hold.call(k)){for(var c=b.target;"I"!=c.tagName;)if(c==this)return;var d=k.attr("data-rate"),e=0;k.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){e++;a(this).removeClass("star-empty").addClass("star");if(this==c)return d!=e&&(k.attr("data-rate",e),h.onUpdate(e)),!1});return!1}});if(h.withClearAction){var b="clear-"+a(this).attr("id"),c=a("#"+b);c.length||(k.after('<a href="javascript:void(0);" class="inline-link rate-clear" id="'+
b+'" style="display:none;"><b><i>'+$_("clear")+"</b></i></a>"),c=a("#"+b));c.click(function(){if(!h.hold.call(k)){var a=k.attr("data-rate");f.call(k,0);if(0!==a)h.onUpdate(0)}});var d;k.parent().mousemove(function(){h.hold.call(k)||(d&&clearTimeout(d),c.show(0))}).mouseleave(function(){d=setTimeout(function(){h.hold.call(k)||c.hide(0)},150)})}this.unbind("clear").bind("clear",function(){f.call(k,0)});this.data("inited",!0)}function f(b){var c=0;this.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){if(c==
b)return!1;c++;a(this).removeClass("star-empty").addClass("star")});this.attr("data-rate",b)}function g(a){return function(){return a}}var h,k=this;if(this&&this.length){if("string"==typeof b){if("getOption"==b&&"rate"==c)return parseInt(this.attr("data-rate"),10);"setOption"==b&&("rate"==c&&(f.call(this,parseInt(e,10)),c={rate:e}),"object"===typeof c&&c&&(h=this.data("rateWidgetSettings")||{},a.extend(h,c),"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(h.hold=g(h.hold))));return this}this.data("rateWidgetSettings",
a.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0},b||{}));if(!this.data("inited"))return h=this.data("rateWidgetSettings"),"function"!==typeof h.hold&&(h.hold=g(h.hold)),d.call(this),this}}})(jQuery);(function(a){a.product_reviews={container:null,sidebar_counter:null,statuses:{},form:null,hotkeys:{"alt+enter":{ctrl:!1,alt:!0,shift:!1,key:13},"ctrl+enter":{ctrl:!0,alt:!1,shift:!1,key:13},"ctrl+s":{ctrl:!0,alt:!1,shift:!1,key:17}},options:{},init:function(b){this.options=b;this.statuses=b.statuses;b.product_id&&(this.product_id=b.product_id);this.form=a("#s-review-add-form");this.sidebar_counter=a("#s-all-reviews").find(".count");b.container&&(this.container="object"===typeof b.container?b.container:
a(b.container),this.container.find(".s-reviews").off("click",".s-review-reply, .s-review-delete, .s-review-restore").on("click",".s-review-reply, .s-review-delete, .s-review-restore",function(){var c=a(this),d=c.parents("li:first"),d=parseInt(d.attr("data-id"),10)||0;if(c.hasClass("s-review-reply")){if("ignore"==a.product_reviews.options.reply)return;a.product_reviews.prepareAddingForm.call(c,a.product_reviews.form,d)}else c.hasClass("s-review-delete")?a.product_reviews.deleteReview(d,b.afterDelete):
c.hasClass("s-review-restore")&&a.product_reviews.restoreReview(d,b.afterRestore);return!1}));this.product_id&&this.container.addClass("ajax");var c=function(){a.product_reviews.addReview("backend",b.afterAdd)};this.addHotkeyHandler("textarea","ctrl+enter",c);this.form.find("input.save").unbind("click").bind("click",c);this.initView();this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);a.product&&(a.product.editTabReviewsAction=function(b){b.tail&&setTimeout(function(){a.product_reviews.activeReplyToForm(b.tail)},
200)})},activeReplyToForm:function(b){var c=this.container.find(".s-reviews li[data-id="+b+"]");if(c.length){var e=c.find(".s-review-reply:first");this.prepareAddingForm.call(e,this.form,b);a(document).scrollTop(c.offset().top)}},initView:function(){if("reviews"==a.products.hash.substr(0,7)){var b=a("#s-sidebar");b.find("li.selected").removeClass("selected");b.find("#s-all-reviews").addClass("selected")}},initLazyLoad:function(b){var c=b.count,e=b.total_count,d=b.url||"?module=reviews",f=a(b.target||
".s-reviews:first ul:first");a(window).lazyLoad("stop");c<e&&(a(window).lazyLoad({container:f,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();a.get(d+"&lazy=1&offset="+c+"&total_count="+e,function(b){b=a("<div></div>").html(b);var d=b.find(".s-reviews").children();c+=d.length;f.append(d);a(".lazyloading-progress-string").replaceWith(b.find(".lazyloading-progress-string"));a(".lazyloading-progress").replaceWith(b.find(".lazyloading-progress"));
c>=e?(a(window).lazyLoad("stop"),a(".lazyloading-link").hide()):(a(".lazyloading-link").show(),a(window).lazyLoad("wake"));b.remove()},"html")}}),a(".lazyloading-link").unbind("click").bind("click",function(){a(window).lazyLoad("force");return!1}))},prepareAddingForm:function(b,c){if(c)this.after(b),b.find(".rate a:first").hide();else{var e=a("#s-review-add li:first");e.find("form").length||e.append(b);b.find(".rate a:first").show()}a.product_reviews.clear(!1);a("input[name=parent_id]",b).val(c)},
addHotkeyHandler:function(a,c,e){var d=this.hotkeys[c];this.form.off("keydown",a).on("keydown",a,function(a){if(a.keyCode==d.key&&a.altKey==d.alt&&a.ctrlKey==d.ctrl&&a.shiftKey==d.shift)return e()})},addReview:function(b,c){var e=this.sidebar_counter;a.post("backend"!=b&&b?"#":"?module=reviews&action=add",a.product_reviews.form.serialize(),function(b){if("fail"==b.status)a.product_reviews.clear(!1),a.product_reviews.showErrors(b.errors);else if("ok"==b.status&&b.data.html){var f=a("input[name=parent_id]",
a.product_reviews.form),g=a.product_reviews.form.parents(".s-review:first").parent("li"),h=b.data.html,k=a("ul:first",g),m=a.product_reviews.container;g.length||(m.show(),k=a("ul:first",m).show());k.length||(k=a('<ul class="menu-v with-icon"></ul>'),g.append(k));k.append(a('<li data-id="'+b.data.id+'" data-parent-id="'+b.data.parent_id+'"></li>').append(h));a("textarea",a.product_reviews.form).val("");g=a("#s-review-add");g.find("form").length||(g.append(a.product_reviews.form),f.val(0));e.length&&
e.text(parseInt(e.text(),10)+1);"function"===typeof c&&c(b);a.product_reviews.clear()}else console&&console.log("Error occured.")},"json").error(function(a){console&&console.log(a.responseText?"Error occured: "+a.responseText:"Error occured.")})},deleteReview:function(b,c){var e=this.container,d=this.sidebar_counter;a.post("?module=reviews&action=changeStatus",{review_id:b,status:this.statuses.deleted},function(a){if("ok"==a.status){var g=e.find("li[data-id="+b+"]").find("div:first");g.addClass("s-deleted");
g.find(".s-review-delete").hide();g.find(".s-review-restore").show();d.length&&d.text(parseInt(d.text(),10)-1);"function"===typeof c&&c(a)}},"json")},restoreReview:function(b){var c=this.container,e=this.sidebar_counter;a.post("?module=reviews&action=changeStatus",{review_id:b,status:this.statuses.published},function(a){"ok"==a.status&&(a=c.find("li[data-id="+b+"]").find("div:first"),a.removeClass("s-deleted"),a.find(".s-review-delete").show(),a.find(".s-review-restore").hide(),e.length&&e.text(parseInt(e.text(),
10)+1),"function"===typeof success&&success())},"json")},clear:function(b){b="undefined"===typeof b?!0:b;a(".errormsg",this.form).remove();a(".error",this.form).removeClass("error");a(".wa-captcha-refresh",this.form).click();b&&(a("input[name=captcha], textarea",this.form).val(""),a("input[name=rate]",this.form).val(0),a(".rate a:first",this.form).trigger("clear"))},showErrors:function(b){for(var c=0,e=b.length,d=b[c];c<e;d=b[++c])for(var f in d)a("[name="+f+"]",this.form).after(a('<em class="errormsg"></em>').text(d[f])).addClass("error")}}})(jQuery);(function(a){a.product_images={product_id:0,image:null,product_image:null,image_list:null,photo_stream:null,tail:null,options:{},init:function(b){this.options=b;this.product_id=b.product_id||0;this.image=b.image||null;this.options.placeholder=this.options.placeholder||null;var c=a("#s-product-edit-menu .images");this.image?setTimeout(function(){a.product_images.initImage()},200):this.initImageList(b);c.find(".hint").text(b.count||b.images&&b.images.length||0);a("#s-product-edit-forms .s-product-form.images").addClass("ajax");
a.product.editTabImagesAction=function(b){if(null!==a.product_images.tail){var c="?module=product&action=images&id="+b.id;if(b.tail&&(c+="&param[]="+b.tail,a.product_images.photo_stream&&a.product_images.photo_stream.length))var e=a.product_images.photo_stream.find(".s-stream-wrapper>ul"),c=c+("&ps[left]="+parseInt(e.css("left"),10)),c=c+("&ps[width]="+parseInt(e.css("width"),10));a.get(c,function(b){a("#s-product-edit-forms .s-product-form.images").html(b)})}a.product_images.tail=b.tail};a.product.editTabImagesBlur=
function(b){a("#fileupload").fileupload("destroy")};var e=a("#s-product-set-custom-badge");a(".s-product-images-actions").off("click","li").on("click","li",function(){var b=a(this),c=b.attr("data-action");switch(c){case "set-badge":a.product_images.setBadge(b.attr("data-type"));break;case "set-custom-badge":e.data("type",b.attr("data-type"));e.show();break;case "delete-badge":a.product_images.deleteBadge()}"set-custom-badge"!=c&&e.hide();return!1});e.find("input[type=button]").unbind("click").bind("click",
function(){var b=a(this).parent();e.show();a.product_images.setBadge(e.data("type"),b.find("textarea[name=code]").val());return!1})},initImageList:function(b){this.image_list=a(b.image_list||"#s-product-image-list");this.image_list.html(tmpl("template-product-image-list",{images:b.images,placeholder:b.placeholder,type:b.type,product_id:this.product_id}));this.initListSortable();b.type&&"thumbs"!=b.type||this.initListEditable();b.enable_2x&&a.fn.retina&&this.image_list.find("img").retina()},initImage:function(){a("#s-product-one-image").parent().width();
this.photo_stream=a("#s-product-image-toolbar ul.s-photostream:first");var b=this.setImageDimensions();a(window).unbind("resize.product_images").bind("resize.product_images",function(b){a("#s-product-image").length?a.product_images.image?(b=a.product_images.setImageDimensions(),a.product_images.loupe.resize(b)):a(this).unbind("resize.product_images"):a(this).unbind("resize.product_images")});a("#s-product-image-description").inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],
placeholderClass:"gray",placeholder:a.product_images.options.placeholder,minSize:{height:50,widht:600},size:{width:b.width},editLink:"#s-product-image-description-edit-link",allowEmpty:!0,beforeMakeEditable:function(b){var c=a(this),d=this.id+"-button",e=a("#"+d);e.length||(b.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),a("#"+d).click(function(){c.trigger("readable")}));a("#"+this.id+"-hint").show();e.show().prev("br").hide()},
afterBackReadable:function(b,c){var d=a(b).val(),e="#"+this.id+"-";a(e+"button").hide().prev("br").hide();a(e+"hint").hide();c.changed&&a.products.jsonPost("?module=product&action=imageSave",{id:a.product_images.image.id,data:{description:d}})}});var c=this.photo_stream,e=c.find("li.selected");c.photoStreamSlider({backwardLink:"#s-product-image-toolbar .rewind",forwardLink:"#s-product-image-toolbar .ff",photoStream:"ul",duration:400});c.off("click","li.visible a").on("click","li.visible a",function(){var b=
a(this).attr("href"),d=a(this).parent();e.removeClass("selected");e=d.addClass("selected");c.trigger("home",[function(){location.href=b}]);return!1});this.photo_stream=c;this.product_image=a("#s-product-image");var d=a("#s-product-set-custom-badge");a(".s-product-image-actions").off("click","li").on("click","li",function(){var b=a(this),c=b.attr("data-action");switch(c){case "delete":a.product_images.deleteImage();break;case "rotate-right":a.product_images.rotateImage("right");break;case "rotate-left":a.product_images.rotateImage("left");
break;case "set-badge":a.product_images.setBadge(b.attr("data-type"));break;case "set-custom-badge":d.data("type",b.attr("data-type"));d.show();break;case "delete-badge":a.product_images.deleteBadge()}"set-custom-badge"!=c&&d.hide();return!1});d.find("input[type=button]").unbind("click").bind("click",function(){var b=a(this).parent();d.show();a.product_images.setBadge(d.data("type"),b.find("textarea[name=code]").val());return!1});b=this.image;a("#s-product-image-loupe").length&&a.product_images.loupe.init({original:{width:b.width,
height:b.height,src:"?module=product&action=ImageDownload&id="+b.id},image:{width:this.product_image.width(),height:this.product_image.height(),src:b.url_big,dom:this.product_image},animate:!(!b.dimensions.width||!b.dimensions.height)});var f=this;a("#s-restore-image-original").unbind("click").bind("click",function(){confirm($_("This will reset all changes you applied to the image after upload, and will restore the image to its original. Are you sure?"))&&(f.coverToggle(),a.products.jsonPost("?module=product&action=imageRestore",
{id:f.image.id},function(b){a("#s-product-view").find("li[data-image-id="+f.image.id+"] img").attr("src",b.data.url_crop);a("<img>").attr("src",b.data.url_big).load(function(){a(this).remove();a.products.dispatch("#/product/"+f.product_id+"/edit/images/"+f.image.id+"/");f.coverToggle()})},"json"))});this.options.enable_2x&&a.fn.retina&&a("#s-product-image").retina();var g=!1;a(document).unbind("keydown.product_images").bind("keydown.product_images",function(b){var d=a(b.target).prop("nodeName").toLowerCase();
b=b.keyCode;if(!(g||"text"==d||"textarea"==d||37!=b&&39!=b)){if(39==b)return d=c.find("li.selected").next(),d.length&&!d.hasClass("dummy")&&(g=!0,location.href=d.find("a").attr("href")),!1;if(37==b)return d=c.find("li.selected").prev(),d.length&&!d.hasClass("dummy")&&(g=!0,location.href=d.find("a").attr("href")),!1}})},setImageDimensions:function(){var b=a("#s-product-image"),c=a("#s-product-one-image").parent().width(),e=this.image.dimensions;e.width=parseInt(e.width,10);e.height=parseInt(e.height,
10);var d={width:"",height:""};!isNaN(e.width)&&e.width<c?(d.width=e.width,isNaN(e.height)||(d.height=e.height)):d.width=c;b.css(d);return d},deleteImage:function(){var b=this,c=a("#s-product-image-delete-dialog");c.waDialog({onSubmit:function(){c.trigger("close");b.coverToggle();var e=c.find("form");a.shop.jsonPost(e.attr("action"),e.serialize(),function(c){var e="#/product/"+b.product_id+"/edit/images/",g=b.photo_stream.find("li.selected"),h=g.next("li:not(.dummy)");h.length?e=h.find("a").attr("href"):
(h=g.prev("li:not(.dummy)"),h.length&&(e=h.find("a").attr("href")));a(".s-product-image-crops").find("li[data-image-id="+c.data.id+"]").remove();b.coverToggle();location.href=e});return!1}})},rotateImage:function(b){var c=this;c.coverToggle();a.products.jsonPost("?module=product&action=imageRotate&id="+c.image.id,{direction:b},function(b){a("#s-product-view").find("li[data-image-id="+c.image.id+"] img").attr("src",b.data.url_crop);a("<img>").attr("src",b.data.url_big).load(function(){a(this).remove();
a.products.dispatch("#/product/"+c.product_id+"/edit/images/"+c.image.id+"/");c.coverToggle()})})},setBadge:function(b,c,e){c=c||b;var d=a("#photo-organize-menu"),f=d.find("li[data-type="+b+"]");f.find("a").append('<span class="count"><i class="icon16 loading"></i></span>');a.shop.jsonPost("?module=product&action=badgeSet&id="+this.product_id,{code:c},function(c){var h=a("#s-product-one-image");h.find(".top.right").html(c.data);d.find("li.selected").removeClass("selected").find(".small").text("");
f.addClass("selected");f.find("span.count").remove();h.length||(f.find("a").append('<span class="count"><i class="icon10 yes"></i></span>'),setTimeout(function(){f.find("span.count").remove()},1E3));"custom"!=b?(a("#s-product-set-custom-badge").hide(),f.find(".small").text(c.data)):a("#s-product-set-custom-badge").show();"function"===typeof e&&e(c)})},deleteBadge:function(){a.getJSON("?module=product&action=badgeDelete&id="+this.product_id,function(b){a("#s-product-one-image").find(".top.right").html("");
a("#photo-organize-menu").find("li.selected").removeClass("selected").find(".small").text("")})},initListSortable:function(){this.image_list.sortable({distance:5,helper:"clone",items:"li",opacity:.75,tolerance:"pointer",start:function(){document.ondragstart=function(){return!1}},update:function(b,c){document.ondragstart=null;var e=a(this),d=a(c.item),f=parseInt(d.attr("data-image-id"),10),d=d.next(),g=null;d.length&&(g=parseInt(d.attr("data-image-id"),10));a.products.jsonPost("?module=product&action=imageMove",
{id:f,before_id:g},function(b){if("function"===typeof a.product_images.options.onSort)a.product_images.options.onSort(f,g)},function(){e.sortable("cancel")})}})},coverToggle:function(){var b=a("#s-product-image-cover");if(b.is(":hidden")){var c=b.find(".loading");c.css({position:"absolute",left:parseInt((b.width()-c.width())/2,10)+"px",top:parseInt((b.height()-c.height())/2,10)+"px"});b.show()}else b.hide()},initListEditable:function(){this.image_list.off("click",".editable").on("click",".editable",
function(){a(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",placeholder:a.product_images.options.placeholder,minSize:{height:40},allowEmpty:!0,beforeMakeEditable:function(b){var c=a(this);b.css({"font-size":c.css("font-size"),"line-height":c.css("line-height")}).width(c.parents("li:first").find("img").width());var e=this.id+"-button",d=a("#"+e);d.length||(b.after('<br><input type="button" id="'+e+'" value="'+$_("Save")+'"> <em class="hint" id="'+
this.id+'-hint">Ctrl+Enter</em>'),a("#"+e).click(function(){c.trigger("readable")}));a("#"+this.id+"-hint").show();d.show()},afterBackReadable:function(b,c){var e=a(this),e=parseInt(e.parents("li:first").attr("data-image-id"),10),d=a(b).val(),f="#"+this.id+"-";a(f+"button").hide();a(f+"hint").hide();c.changed&&a.products.jsonPost("?module=product&action=imageSave",{id:e,data:{description:d}})}}).trigger("editable")})}}})(jQuery);(function(a){a.product_stocks_log={product_id:null,container:null,options:{},init:function(b){this.options=b;this.container=b.container?a(b.container):a("body");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(b){var c=b.count,e=this.options.total_count,d=b.url;a(window).lazyLoad("stop");if(c<e){var f=this;a(window).lazyLoad({container:f.container,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){if(f.container.is(":visible"))a(window).lazyLoad("sleep"),
a(".lazyloading-link").hide(),a(".lazyloading-progress").show(),a.get(d+"&lazy=1&offset="+c+"&total_count="+e,function(b){b=a("<div></div>").html(b);var d=b.find("table tr");d.length?(c+=d.length,a("table",f.container).append(d),c>=e?(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide()):(a(window).lazyLoad("wake"),a(".lazyloading-link").show())):(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide());a(".lazyloading-progress-string",f.container).replaceWith(a(".lazyloading-progress-string",
b));a(".lazyloading-chunk",f.container).replaceWith(a(".lazyloading-chunk",b));b.remove()});else{a(window).lazyLoad("sleep");var b=setInterval(function(){f.container.is(":visible")&&(a(window).lazyLoad("wake"),clearInterval(b))},500)}}});a(".lazyloading-link").die("click").live("click",function(){a(window).lazyLoad("force");return!1})}}}})(jQuery);(function(a){a.product_orders={product_id:null,container:null,options:{},init:function(b){this.options=b;this.container=b.container?a(b.container):a("body");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(b){var c=b.count,e=this.options.total_count,d=b.url;a(window).lazyLoad("stop");if(c<e){var f=this;a(window).lazyLoad({container:f.container,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();
a(".lazyloading-progress").show();a.get(d+"&lazy=1&offset="+c+"&total_count="+e,function(b){b=a("<div></div>").html(b);var d=b.find("table tr");d.length?(c+=d.length,a("table",f.container).append(d),c>=e?(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide()):(a(window).lazyLoad("wake"),a(".lazyloading-link").show())):(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide());a(".lazyloading-progress-string",f.container).replaceWith(a(".lazyloading-progress-string",b));a(".lazyloading-chunk",
f.container).replaceWith(a(".lazyloading-chunk",b));b.remove()})}});a(".lazyloading-link").die("click").live("click",function(){a(window).lazyLoad("force");return!1})}}}})(jQuery);(function(a){var b=[],c=[];a.fn.doAutosize=function(b){var c=a(this).data("minwidth"),f=a(this).data("maxwidth"),g="",h=a(this),k=a("#"+a(this).data("tester_id"));g!==(g=h.val())&&(g=g.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),k.html(g),k=k.width(),b=k+b.comfortZone>=c?k+b.comfortZone:c,k=h.width(),(b<k&&b>=c||b>c&&b<f)&&h.width(b))};a.fn.resetAutosize=function(b){var c=a(this).data("minwidth")||b.minInputWidth||a(this).width();b=a(this).data("maxwidth")||b.maxInputWidth||
a(this).closest(".tagsinput").width()-b.inputPadding;var f=a(this),g=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),letterSpacing:f.css("letterSpacing"),whiteSpace:"nowrap"}),h=a(this).attr("id")+"_autosize_tester";0< !a("#"+h).length&&(g.attr("id",h),g.appendTo("body"));f.data("minwidth",c);f.data("maxwidth",b);f.data("tester_id",h);f.css("width",c)};a.fn.addTag=function(e,d){d=jQuery.extend({focus:!1,
callback:!0},d);this.each(function(){var f=a(this).attr("id"),g=a(this).val().split(b[f]);""==g[0]&&(g=[]);e=jQuery.trim(e);var h;d.unique?(h=a(g).tagExist(e),1==h&&a("#"+f+"_tag").addClass("not_valid")):h=!1;if(""!=e&&1!=h&&(a("<span>").addClass("tag").append(a("<span>").text(e).append("\u00a0\u00a0"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+f).removeTag(escape(e))})).insertBefore("#"+f+"_addTag"),g.push(e),a("#"+f+"_tag").val(""),d.focus?a("#"+f+"_tag").focus():
a("#"+f+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,g),d.callback&&c[f]&&c[f].onAddTag&&(h=c[f].onAddTag,h.call(this,e)),c[f]&&c[f].onChange)){var k=g.length;h=c[f].onChange;h.call(this,a(this),g[k-1])}});return!1};a.fn.removeTag=function(e){e=unescape(e);this.each(function(){var d=a(this).attr("id"),f=a(this).val().split(b[d]);a("#"+d+"_tagsinput .tag").remove();str="";for(var g=0;g<f.length;g++)f[g]!=e&&(str=str+b[d]+f[g]);a.fn.tagsInput.importTags(this,str);c[d]&&c[d].onRemoveTag&&c[d].onRemoveTag.call(this,
e)});return!1};a.fn.tagExist=function(b){return 0<=jQuery.inArray(b,a(this))};a.fn.importTags=function(b){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,b)};a.fn.tagsInput=function(e){var d=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},e);this.each(function(){d.hide&&
a(this).hide();var e=a(this).attr("id"),g=jQuery.extend({pid:e,real_input:"#"+e,holder:"#"+e+"_tagsinput",input_wrapper:"#"+e+"_addTag",fake_input:"#"+e+"_tag"},d);b[e]=g.delimiter;if(d.onAddTag||d.onRemoveTag||d.onChange)c[e]=[],c[e].onAddTag=d.onAddTag,c[e].onRemoveTag=d.onRemoveTag,c[e].onChange=d.onChange;var h='<div id="'+e+'_tagsinput" class="tagsinput"><div id="'+e+'_addTag">';d.interactive&&(h=h+'<input id="'+e+'_tag" value="" data-default="'+d.defaultText+'" />');a(h+'</div><div class="tags_clear"></div></div>').insertAfter(this);
a(g.holder).css("width",d.width);a(g.holder).css("height",d.height);""!=a(g.real_input).val()&&a.fn.tagsInput.importTags(a(g.real_input),a(g.real_input).val());if(d.interactive){a(g.fake_input).val(a(g.fake_input).attr("data-default"));a(g.fake_input).css("color",d.placeholderColor);a(g.fake_input).resetAutosize(d);a(g.holder).bind("click",g,function(b){a(b.data.fake_input).focus()});a(g.fake_input).bind("focus",g,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&
a(b.data.fake_input).val("");a(b.data.fake_input).css("color","#000000")});if(void 0!=d.autocomplete_url){autocomplete_options={source:d.autocomplete_url};for(attrname in d.autocomplete)autocomplete_options[attrname]=d.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(g.fake_input).autocomplete(d.autocomplete_url,d.autocomplete),a(g.fake_input).bind("result",g,function(b,c,g){c&&a("#"+e).addTag(c[0]+"",{focus:!0,unique:d.unique})})):void 0!==jQuery.ui.autocomplete&&(a(g.fake_input).autocomplete(autocomplete_options),
a(g.fake_input).bind("autocompleteselect",g,function(b,c){a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:d.unique});return!1}))}else a(g.fake_input).bind("blur",g,function(b){var c=a(this).attr("data-default");""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=c?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:d.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),
a(b.data.fake_input).css("color",d.placeholderColor));return!1});a(g.fake_input).bind("keypress",g,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||13==b.which)return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:d.unique}),a(b.data.fake_input).resetAutosize(d),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(d)});g.removeWithBackspace&&
a(g.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();b=a(this).closest(".tagsinput").find(".tag:last").text();var c=a(this).attr("id").replace(/_tag$/,"");b=b.replace(/[\s]+x$/,"");a("#"+c).removeTag(escape(b));a(this).trigger("focus")}});a(g.fake_input).blur();g.unique&&a(g.fake_input).keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,\/]+/))&&a(this).removeClass("not_valid")})}return!1});
return this};a.fn.tagsInput.updateTagsField=function(c,d){var f=a(c).attr("id");a(c).val(d.join(b[f]))};a.fn.tagsInput.importTags=function(e,d){a(e).val("");for(var f=a(e).attr("id"),g=d.split(b[f]),h=0;h<g.length;h++)a(e).addTag(g[h],{focus:!1,callback:!1});c[f]&&c[f].onChange&&c[f].onChange.call(e,e,g[h])}})(jQuery);(function(a){a.product_list={options:{},collection_hash:[],collection_param:"",total_count:0,category_count:0,sort:null,order:null,container:null,toolbar:null,sortable:!0,cached:{},fixed_blocks:{},init:function(b){var c=[];b.collection_param&&c.push(b.collection_param);c.push("view="+b.view);b.sort&&c.push("sort="+b.sort);b.order&&c.push("order="+b.order);c="#/products/"+c.join("&");a.products.forceHash(c);try{this.options=b;this.container=a("#product-list");this.toolbar=a("#s-product-list-toolbar");
this.sidebar=a("#s-sidebar");var e=this.options.products;delete this.options.products;this.total_count=this.options.total_count||0;this.category_count=parseInt(this.options.category_count,10);isNaN(this.category_count)&&(this.category_count=this.total_count);this.sortable="undefined"===typeof b.sortable?this.sortable:b.sortable;this.sort=b.sort||null;if(b.enable_2x)this.container.on("append_product_list",function(){a.fn.retina&&a.product_list.container.find("img").retina()});if(e&&b.view){try{this.container.append(tmpl("template-product-list-"+
this.options.view,{products:e,sort:this.sort},"table"==this.options.view)),this.container.trigger("append_product_list",[e])}catch(d){return console.log("Error: "+d.message),this}delete b.products}a.isArray(this.options.collection_hash)&&this.options.collection_hash.length?this.collection_hash=this.options.collection_hash:this.collection_hash=[];this.collection_param=this.options.collection_param?this.options.collection_param:"";b.order&&(this.order=b.order);this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);
this.initSelecting();this.initView(this.options.view);this.initDragndrop();this.initSortingNotice();this.rubberTable();"table"==this.options.view&&this.initInlineEditor()}catch(d){a.shop.error("$.product_list.init error: "+d.message,d)}return this},initSortingNotice:function(){if(!a.storage.get("shop/list-sorting-notice-closed")){var b=a("#custom-backend-order-notice");if(b.length)b.show().on("click",".close",function(){a.storage.set("shop/list-sorting-notice-closed","1");b.remove()})}},initLazyLoad:function(b){var c=
b.count,e=this.total_count;a(window).lazyLoad("stop");if(c<e){var d=this,f=d.container.find("tr.header th[data-additional-column]").map(function(){return a(this).data("additional-column")}).get().join(",");a(window).lazyLoad({container:d.container,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",hash:["","products"],load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();a.get("?module=products&action=loadList&offset="+c+("&total_count="+
e)+(d.collection_param?"&"+d.collection_param:"")+(d.sort?"&sort="+d.sort:"")+(d.order?"&order="+d.order:"")+("&enabled_columns="+(f||"")),function(b){if("ok"==b.status&&b.data.count){c+=b.data.count;var f=d.container;try{d.container.append(tmpl("template-product-list-"+d.options.view,{products:b.data.products,check_all:"table"==d.options.view?f.find(".s-select-all:first").attr("checked"):!1,sort:a.product_list.sort})),d.container.trigger("append_product_list",[b.data.products])}catch(k){console.log("Error: "+
k.message);a(window).lazyLoad("stop");return}f.find(".last").removeClass("last");f.find(".product:last").addClass("last");a(".lazyloading-progress-string").text(b.data.progress.loaded+" "+b.data.progress.of);a(".lazyloading-progress").hide();a(".lazyloading-chunk").text(b.data.progress.chunk);c>=e?(a(window).lazyLoad("stop"),a(".lazyloading-link").hide()):(a(".lazyloading-link").show(),a(window).lazyLoad("wake"))}else b.data&&!b.data.count?console&&(console.log("Count of again loaded products is 0"),
a(".lazyloading-progress").hide()):(b.errors&&console&&console.log("Error when loading products: "+b.errors),a(window).lazyLoad("stop"))},"json")}});a(".lazyloading-link").die("click").live("click",function(){a(window).lazyLoad("force");return!1})}},initSelecting:function(){var b=this.container,c=this.toolbar.find(".count"),e=b.find(".s-select-all:first"),d=function(){var a=parseInt(b.find("> .product.selected").length,10);a?c.text(a).show():c.text("").hide()};a(document).keydown(function(a){16==
a.keyCode&&(document.body.onselectstart=function(){return!1})}).keyup(function(a){16==a.keyCode&&(document.body.onselectstart=null)});b.off("select",".product").on("select",".product",function(b,c,h){h=void 0!==h?h:!0;(void 0!==c?c:1)?a(this).addClass("selected").find("input:first").attr("checked",!0):(a(this).removeClass("selected").find("input:first").attr("checked",!1),e.is(":checked")&&e.attr("checked",!1));h&&d();return!1});e.unbind("select").bind("select",function(d,e){e=void 0!==e?e:!0;var h=
a(this);e?(h.attr("checked",!0),b.find("> .product").trigger("select",!0,!1),c.text(h.attr("data-count")).show()):(h.attr("checked",!1),b.find("> .product").trigger("select",!1,!1),c.text("").hide())});b.off("click",".product input").on("click",".product input",function(c,g){var h=c.shiftKey,k=this.checked;g&&(h=g.shiftKey,k=g.checked);var m=a(this).parents(".product:first");k?m.addClass("selected"):(e.is(":checked")&&e.attr("checked",!1),m.removeClass("selected"));if(h&&k){(h=b.data("last_checked"))||
(h=b.find("> .product:first").trigger("select",!0));var n=m.prevAll(".selected[data-product-id="+h.attr("data-product-id")+"]"),p;if(n.length)for(p=m.prev(),h=h.get(0);p.length&&h!=p.get(0);)p.addClass("selected").find("input").attr("checked",!0),p=p.prev();else if(n=m.nextAll(".selected[data-product-id="+h.attr("data-product-id")+"]"),n.length)for(p=m.next(),h=h.get(0);p.length&&h!=p.get(0);)p.addClass("selected").find("input").attr("checked",!0),p=p.next();b.data("last_checked")||n.length||h.trigger("selected",
!1)}k&&b.data("last_checked",m);d()});if(a.browser.mozilla)b.off("click",".product label").on("click",".product label",function(b){if(b.shiftKey){var c=a(b.target);a(c).is("label")||(c=a(c).parents("label:first"));c=a("#"+c.attr("for"));c.trigger("click",{shiftKey:b.shiftKey,checked:!c.attr("checked")})}})},initView:function(b){try{var c=this.container,e=this.sidebar;"table"==b&&(c.find(".s-select-all:first").click(function(){a(this).trigger("select",this.checked)}),a("#s-content .list-view-mode-table").click(function(){c.toggleClass("single-lined");
a.storage.set("shop/product_list/multi-lined",!c.hasClass("single-lined"));return!1}),a.storage.get("shop/product_list/multi-lined")&&c.removeClass("single-lined"));var d="view="+b;e.find(".s-collection-list li.dr").each(function(){var b=a(this);b.find("a:first").attr("href","#/products/"+b.attr("id").replace("-","_id=")+"&"+d)});a("#s-products-search").autocomplete("disable").val(this.options.text||"").autocomplete("enable");var f="s-all-products";a.product_list.collection_hash.length&&"search"!==
a.product_list.collection_hash[0]&&"tag"!==a.product_list.collection_hash[0]&&(f=a.product_list.collection_hash.join("-"));a.shop.trace("$.product_list.initView",[b,f]);e.find("li.selected").removeClass("selected");var g=e.find("#"+f);0>=g.length&&window.location.hash&&(g=e.find('a[href="'+window.location.hash+'"]').parent());0>=g.length&&(g=e.find("#s-all-products"));g.addClass("selected");a.product_list.collection_hash.length&&"search"!==a.product_list.collection_hash[0]&&"tag"!==a.product_list.collection_hash[0]&&
g.find(".count:first").text(this.category_count);a("#s-content").find(".sort").unbind("click").bind("click",function(){location.href=a(this).find("a").attr("href");return!1});a.product_list.fixed_blocks=a.product_list.initFixedBlocks();this.initEditingControls();this.initToolbar();a(document).trigger("product_list_init_view")}catch(h){a.shop.error("$.product_list.initView error: "+h.message,h)}},highlightInlineEditorCells:function(){a.product_list.container.find("tr").each(function(){var b=a(this),
c=b.data("edit-rights");c&&b.data("min-price")==b.data("max-price")||b.find(".s-product-price .editable").filter(function(){return!a(this).data("plugin")}).addClass("not-editable");c&&1==b.data("sku-count")||b.find(".s-product-stock .editable").filter(function(){return!a(this).data("plugin")}).addClass("not-editable")})},initInlineEditor:function(){function b(a,b){if(a.data("denied-reason")==b)a.data("denied-reason",""),alert(b);else{a.data("denied-reason",b);setTimeout(function(){a.data("denied-reason",
"")},3E3);a.wrapInner('<div class="animation-container" style="position:relative;"></div>');var c=a.find(".animation-container").animate({left:"3px"},100,function(){c.animate({left:"0px"},100,function(){c.animate({left:"3px"},100,function(){c.animate({left:"0px"},100,function(){c.children().first().unwrap()})})})})}}function c(b){var c=[];a.product_list.container.find("tr.product").each(function(){var b=a(this);void 0===b.data("original-price")&&b.data("edit-rights")&&c.push(a(this).data("product-id"))});
if(!c.length)return b();a.post("?module=products&action=inlineEditorData",{ids:c},function(c){c.data&&a.product_list.container.find("tr.product").each(function(){var b=a(this),d=c.data[parseInt(b.data("product-id"),10)];d&&(b.data("stocks",d.stocks||null),b.data("original-price",d.price.replace(/\.?0+$/g,"")))});b()},"json")}a.product_list.highlightInlineEditorCells();a.product_list.container.on("append_product_list",function(){a.product_list.highlightInlineEditorCells()});a.product_list.container.on("click",
".s-product-price,.s-product-stock",function(){function e(){if(g)d.html(tmpl("template-list-price-editor-one",{product_id:f.data("product-id"),currency:f.data("currency"),value:f.data("original-price")}));else{var b=f.data("stocks");b&&"object"==typeof b?d.html(tmpl("template-list-stock-editor-many",{product_id:f.data("product-id"),values:b})):d.html(tmpl("template-list-stock-editor-one",{product_id:f.data("product-id"),value:b||""}))}d.find(".cancel").click(function(){var a=d;a.removeClass("editor-on").html(a.data("read-only-state-html"));
a.data("read-only-state-html","");a.data("denied-reason","")});var c=d.find("form").submit(function(){if(c.find(".loading").length)return!1;c.find(":submit").after('<i class="icon16 loading"></i>');a.post("?module=products&action=inlineSave",c.serialize(),function(b){c.find(".loading").remove();try{b.data&&b.data[0]&&(b.data[0].alien=f.hasClass("s-alien"));var d=a("<table>").html(tmpl("template-product-list-table",{products:b.data,check_all:a.product_list.container.find(".s-select-all:first").prop("checked"),
sort:a.product_list.sort}));f.replaceWith(d.find("tr"));self.container.trigger("append_product_list",[b.data])}catch(e){console.log("Error: "+e.message)}},"json");return!1});c.on("dblclick",!1);setTimeout(function(){d.find(":input:visible:first").focus()},0)}var d=a(this);if(!d.data("plugin")){var f=d.closest("tr"),g=d.hasClass("s-product-price");if(g){if(f.data("min-price")!=f.data("max-price"))return b(d,$_("Inline editing is available only for products with a single SKU"))}else if("1"!=f.data("sku-count"))return b(d,
$_("Inline editing is available only for products with a single SKU"));if(!f.data("edit-rights"))return b(d,$_("Insufficient access rights"));d.hasClass("editor-on")||(d.addClass("editor-on").data("read-only-state-html",d.html()),a.product_list.container.removeClass("single-lined"),void 0!==f.data("original-price")?e():(d.html('<i class="icon16 loading"></i>'),c(e)))}})},initFixedBlocks:function(){var b=a("#mainmenu").height(),c=a("#s-sidebar").width(),e=a(window),d=a("#s-fixed-blocks");d.length||
(d=a('<div id="s-fixed-blocks"></div>').css({display:"none",position:"fixed",background:"#fff",top:b,width:c,"float":"left"}).appendTo("#s-sidebar"));var f=a("#s-category-list"),g=a("#s-category-list-block"),h=a("#s-set-list"),k=a("#s-set-list-block"),m=function(){function h(){if(!l){var k=a("#s-category-list-handler");r=a.categories_tree.isCollapsed(k);n=f.is(":hidden");var m=a('<div id="s-category-list-dummy" class="block"></div>').css({height:g.height()});g.replaceWith(m);d.show().append(g.hide());
g.find(".heading").before('<span class="hint float-right" style="margin-top: 3px;">'+$_("Drag products here")+"</span>");r&&a.categories_tree.expand(k,null,function(){a.categories_tree.collapse(k)});n||f.hide();g.show();a("i.add",g).hide();a("#s-category-list-handler").hide();g.css({"overflow-x":"hidden","overflow-y":"auto"});(function(){var a=f.is(":hidden"),d;g.bind("mousemove.fixed_blocks.category",function(c){document.getElementById("products-helper")&&a&&(d&&(clearTimeout(d),d=null),d=setTimeout(function(){if(a){g.css({height:""});
f.show();var c=g.height(),d=(e.height()-b)/2;g.css({height:Math.min(c,d)});g.find(".heading").prev(".hint").hide();a=!1}},250))});e.bind("mouseout.fixed_blocks.category",function(b){b.pageX>c+10&&(d&&clearTimeout(d),d=null,a||(f.hide(),g.css({height:""}),g.find(".heading").prev(".hint").show(),a=!0))})})();l=!0}}function k(){if(l){var b=a("#s-category-list-dummy");b.replaceWith(g);g.css({"overflow-x":"","overflow-y":""});var c=a("#s-category-list-handler");r&&a.categories_tree.collapse(c);n||f.show();
g.find(".heading").prev(".hint").remove();a("#s-category-list-handler").show();a("i.add",g).show();b.remove();g.unbind("mousemove.fixed_blocks.category");e.unbind("mouseout.fixed_blocks.category");d.children().length||d.hide();l=!1;a.categories_tree.init()}}var m=g.offset().top,l=!1,n,r;e.unbind("scroll.fixed_blocks.category").bind("scroll.fixed_blocks.category",function(){l||(m=g.offset().top);var c=m,c=document.getElementById("s-category-list-dummy")?c+a("#s-category-list-dummy").height():c+a("#s-category-list-block").height();
e.scrollTop()+b+5>=c?h():k()});return{setFixed:h,unsetFixed:k}}(),n=function(){function f(){if(!n){l=h.is(":hidden");var g=a('<div id="s-set-list-dummy" class="block"></div>').css({height:k.height()});k.replaceWith(g);d.show().append(k);k.find(".heading").before('<span class="hint float-right" style="margin-top: 3px;">'+$_("Drag products here")+"</span>");l||h.hide();a("i.add",k).hide();a("i.collapse-handler",k).hide();k.css({"overflow-x":"hidden","overflow-y":"auto"});(function(){var a=h.is(":hidden"),
d;k.bind("mousemove.fixed_blocks.set",function(c){document.getElementById("products-helper")&&a&&(d&&(clearTimeout(d),d=null),d=setTimeout(function(){if(a){k.css({height:""});h.show();var c=k.height(),d=(e.height()-b)/2;k.css({height:Math.min(c,d)});k.find(".heading").prev(".hint").hide();a=!1}},250))});e.bind("mouseout.fixed_blocks.set",function(b){b.pageX>c+10&&(d&&clearTimeout(d),d=null,a||(h.hide(),k.css({height:""}),k.find(".heading").prev(".hint").show(),a=!0))})})();n=!0}}function g(){if(n){var b=
a("#s-set-list-dummy");b.replaceWith(k);k.css({"overflow-x":"","overflow-y":""});k.find(".heading").prev(".hint").remove();l||h.show();a("i.add",k).show();a("i.collapse-handler",k).show();b.remove();k.unbind("mousemove.fixed_blocks.category");e.unbind("mouseout.fixed_blocks.category");d.children().length||d.hide();n=!1}}var m=k.offset().top,l,n=!1;e.unbind("scroll.fixed_blocks.set").bind("scroll.fixed_blocks.set",function(){n||(m=k.offset().top);var c=m,c=document.getElementById("s-set-list-dummy")?
c+a("#s-set-list-dummy").height():c+a("#s-set-list-block").height();e.scrollTop()+b+5>=c?f():g()});return{setFixed:f,unsetFixed:g}}();return{category:m,set:n}},initEditingControls:function(){var b=a("#s-product-list-title");b.hasClass("editable")&&(b.inlineEditable({minSize:{width:350},maxSize:{width:600},size:{height:30},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){a(".s-product-list-manage").hide()},afterBackReadable:function(b,c){a(".s-product-list-manage").show();if(!c.changed)return!1;
a.shop.jsonPost("?module=products&action=saveListSettings&"+a.product_list.collection_param+"&edit=name",{name:a(b).val()},function(b){a.product_list.sidebar.find("#"+a.product_list.collection_hash[0]+"-"+b.data.id).find(".name:first").html(b.data.name)})}}),"name"==this.options.edit&&b.trigger("editable"));var c=a.product_list.collection_hash[0],b=a("#s-product-list-settings");!b.length||"category"!=c&&"set"!=c||b.unbind("click").bind("click",function(){a.product_list.settingsListDialog();return!1});
b=a("#s-product-list-delete");!b.length||"category"!=c&&"set"!=c||b.unbind("click").bind("click",function(){a("#s-product-list-delete-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(){function b(a,c){if(!a.length)return c&&c();var f=a.shift();d(["category",f],function(){b(a,c)})}function d(b,c){var d={hash:b.join("/")||"all",remove:["list"]};k&&d.remove.push("products");var e=function(){a.product_list.remove(d,function(d,
e){f(b,d);a.product_list.sidebar.trigger("update",d.data.lists);c&&c()})},g=a("#"+b.join("-")+"-handler");g.length?a.categories_tree.expand(g,function(a){a.parent().find("ul:first").hide();e()}):e();return!1}function f(b,c){var d=b[0],e=a("#"+b.join("-")),f=e.prev(".drag-newposition"),g=a("#s-"+b[0]+"-list"),h=g.find("ul:first");"set"==d?(e.remove(),f.remove()):(d=e.find("ul:first"),d.length&&(d.find(">li.drag-newposition:first").remove(),e.hide(),d.find(">li").each(function(){e.after(this)})),d=
e.parents("ul:first"),e.remove(),f.remove(),d.find("li.dr").length||(h.get(0)!=d.get(0)?(d.parents("li:first").find("i.collapse-handler").remove(),d.closest("li").find(".collapse-handler-ajax:first").remove(),d.remove()):h.closest(".block").find(".collapse-handler-ajax:first").remove()));h.find("li.dr:first").length?(h.show(),g.find(".s-empty-list").hide()):(h.hide(),g.find(".s-empty-list").show());c.data.old_parent_category&&"undefined"!==typeof c.data.old_parent_category.children_count&&!parseInt(c.data.old_parent_category.children_count,
10)&&a("#category-"+c.data.old_parent_category.id+"-handler").remove()}var g=a(this),h=parseInt(a.product_list.collection_hash[1]);g.find(".dialog-buttons i.loading").show();var k="1"==g.find("input[name=s-delete-products]:checked").val();"category"==c&&g.find('input[name="s-delete-sub"]').is(":checked")?a.get("?action=categoryExpand&tree=1&recurse=1&id="+h,function(c){c=a("<div>").html(c).find('li[id^="category-"]').map(function(){return parseInt(this.id.substr(9),10)}).get().reverse();c.push(h);
b(c,function(){location.href="#/"})}):d(a.product_list.collection_hash,function(){location.href="#/"});return!1}});return!1});"set"===c&&a("#s-embed-code").click(function(){a("#s-product-list-embed-dialog").waDialog();return!1})},initDragndrop:function(){a.product_dragndrop.init({products:!0,view:this.options.view,sort:this.options.sort}).bind("move_product",function(b){a.shop.jsonPost("?module=product&action=move&"+a.product_list.collection_param,{product_ids:b.product_ids,before_id:b.before_id||
null},b.success,b.error)}).bind("is_product_sortable",function(){return a.product_list.sortable}).bind("add_to_list",function(b){var c={};b.whole_list?c.hash=a.product_list.collection_hash.join("/")||"all":c.product_id=b.product_ids;a.shop.jsonPost("?module=product&action=addToList&"+b.collection_param,c,b.success,b.error)})},initToolbar:function(){var b=this.toolbar;b.find("li").unbind("click.product_list").bind("click.product_list",function(){var b=a(this),e=b.attr("data-action");if(e){var d=a.product_list.getSelectedProducts("delete"!=
e);if(!d.count)return alert($_("Please select at least one product")),!1;switch(e){case "new-set":break;case "category":a.product_list.categoriesDialog(d);break;case "set":a.product_list.setsDialog(d);break;case "type":a.product_list.typesDialog(d);break;case "assign-tags":a.product_list.assignTagsDialog(d);break;case "delete":a.product_list.deleteProductsDialog(d);break;case "delete-from-set":"set"==a.product_list.collection_hash[0]&&a.product_list.deleteFromSet(d);break;case "delete-from-category":"category"==
a.product_list.collection_hash[0]&&a.product_list.deleteFromCategory(d);break;case "visibility":a.product_list.visibilityDialog(d,b);break;case "export":a.product_list.exportProducts(d,a(this).attr("data-plugin"));break;case "duplicate":a.product_list.duplicateProducts(d,a(this));break;case "set-badge":case "delete-badge":a.product_list.setBadge(d,a(this));break;default:return}return!1}});b.find('li[data-action="set-custom-badge"] a').click(function(){a(this).parent().find(".textarea-wrapper").slideToggle("fast");
return!1}).closest("li").find(".textarea-wrapper").click(function(){return!1}).find("input").click(function(){var b=a.product_list.getSelectedProducts(!0);b.count?a.product_list.setBadge(b,a(this).closest("li")):alert($_("Please select at least one product"));return!1});(function(){var c,e=a("#mainmenu").height(),d=b.find(":first").offset().top-e,f=a(document),g=a(window);f.bind("scroll",c=function(){jQuery.contains(document.documentElement,b[0])?f.scrollTop()>d&&b.height()+e<g.height()?b.addClass("s-fixed").css({top:e}):
b.removeClass("s-fixed"):(f.off("scroll",c),g.off("resize",c))});g.bind("resize",c)})()},getSelectedProducts:function(b){b=b||!1;var c={count:0};if(this.container.find(".s-select-all:first").attr("checked")){var e=a.product_list.collection_hash.join("/")||"all";b?c.serialized=[{name:"hash",value:e}]:c.hash=e;c.count=this.total_count}else b?c.serialized=a.product_list.container.find(".product.selected").map(function(){c.count+=1;return{name:"product_id[]",value:a(this).attr("data-product-id")}}).toArray():
c.product_id=a.product_list.container.find(".product.selected").map(function(){c.count+=1;return a(this).attr("data-product-id")}).toArray();return c},visibilityDialog:function(b,c){if(!a.isArray(b.serialized))return!1;var e=c.find("i.icon16");if(!e.hasClass("loading")){var d=a("#visibility-dialog-wrapper");d.length||(d=a('<div id="visibility-dialog-wrapper">').appendTo("#s-content"));var f=e.attr("class");e.attr("class","icon16 loading");d.data("products",b).load("?module=dialog&action=visibility",
function(){e.attr("class",f)})}},categoriesDialog:function(b){var c=a("#s-categories"),e=this.sidebar,d=this.container;c.length&&c.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=categories",function(){a("#s-categories").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=a(this);c.find(".dialog-content h1 span").text("("+b.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_category_name]").val("");c.find("input[name=new_category]").attr("checked",
!1)},onSubmit:function(c){var g=c.find("form");g.find(".dialog-buttons i.loading").show();a.shop.jsonPost(g.attr("action"),g.serializeArray().concat(b.serialized),function(b){b.data.new_category&&a("#s-category-list ul:first").trigger("add",[b.data.new_category,"category","#/products/category_id="+b.data.new_category+"&view="+a.product_list.options.view]);b.data.categories&&(e.trigger("update",[{category:b.data.categories}]),d.find(".s-select-all:first").trigger("select",!1));g.find("input:checked").attr("checked",
!1);c.trigger("close")});return!1}})})},setsDialog:function(b){var c=a("#s-sets"),e=this.sidebar,d=this.container;c.length&&c.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=sets",function(){a("#s-sets").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=a(this);c.find(".dialog-content h1 span").text("("+b.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_set_name]").val("");c.find("input[name=new_set]").attr("checked",!1)},
onSubmit:function(c){var g=c.find("form");g.find(".dialog-buttons i.loading").show();a.shop.jsonPost(g.attr("action"),g.serializeArray().concat(b.serialized),function(b){b.data.new_set&&a("#s-set-list ul:first").trigger("add",[b.data.new_set,"set","#/products/set_id="+b.data.new_set+"&view="+a.product_list.options.view]);b.data.sets&&(e.trigger("update",[{set:b.data.sets}]),d.find(".s-select-all:first").trigger("select",!1));g.find("input:checked").attr("checked",!1);c.trigger("close")});return!1}})})},
assignTagsDialog:function(b){var c=a("#s-assign-tags"),e=function(){a("#s-assign-tags").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=a(this);c.find(".dialog-content h1 span").text("("+b.count+")").show();c.find(".dialog-buttons i.loading").hide()},onSubmit:function(c){var e=a(this),g=e.find("#s-assign-tags-list_tag");if(g.length){var h=jQuery.Event("keypress",{which:13});g.trigger(h)}e.find(".dialog-buttons i.loading").show();var k=e.attr("action");setTimeout(function(){var g=e.serializeArray().concat(b.serialized);
a.shop.jsonPost(k,g,function(b){b.data.cloud&&a("#s-tag-cloud").trigger("update",[b.data.cloud]);c.trigger("close");a.products.dispatch()},function(){c.trigger("close")})},10);return!1}})};c.length&&c.remove();a.post("?module=dialog&action=assignTags",b.serialized,function(b){a("body").append(b);e()})},typesDialog:function(b){var c=a("#s-types"),e=this.container,d=this.sidebar,f=function(){a("#s-types").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},
onSubmit:function(c){var f=a(this);f.find(".dialog-buttons i.loading").show();a.shop.jsonPost(f.attr("action"),f.serializeArray().concat(b.serialized),function(b){d.trigger("update",{type:b.data.types});e.find(".s-select-all:first").trigger("select",!1);f.find("input:checked").attr("checked",!1);c.trigger("close");a.products.dispatch()});return!1}})},g=c.parent();c.length?f():(g=a("<div></div>").appendTo("body"),g.load("?module=dialog&action=types",f))},deleteFromSet:function(b){0<b.count&&a.shop.jsonPost("?module=products&action=deleteFromSet&id="+
this.collection_hash[1],b.serialized,function(){a.products.dispatch()})},deleteFromCategory:function(b){0<b.count&&a.shop.jsonPost("?module=products&action=deleteFromCategory&id="+this.collection_hash[1],b.serialized,function(){a.products.dispatch()})},deleteProductsDialog:function(b){var c=a("#s-product-list-delete-products-dialog"),e=c.parent();c.length||(e=a("<div></div>").appendTo("body"));e.load("?module=dialog&action=productsDelete&count="+b.count,function(){a("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(c){a(this).find(".dialog-buttons i.loading").show();a.product_list.remove(a.extend(b,{remove:["products"]}),function(b,e){a.product_list.sidebar.trigger("update",b.data.lists);a.products.dispatch();c.trigger("close");e.length&&alert((c.data("not-allowed-string")||"").replace("%d",e.length))});return!1}})})},settingsListDialog:function(){var b=a("#s-product-list-settings-dialog");(b.length?b.parent():a("<div></div>").appendTo("body")).load("?module=dialog&action=productListSettings&"+
a.product_list.collection_param,function(){var b=a("#s-product-list-create-dialog");b.length&&(b.parent().remove(),b.remove());a("#s-product-list-settings-dialog").waDialog({esc:!1,disableButtonsOnSubmit:!0,onLoad:function(){a("#s-category-description-content").length&&a.product_sidebar.initCategoryDescriptionWysiwyg(a(this));setTimeout(function(){a("#s-product-list-name").focus()},50)},onSubmit:function(b){var c=a(this),f=function(c){var d=a.product_list.collection_hash,f=location.hash.replace(d[0]+
"_id="+d[1],d[0]+"_id="+c.data.id),g=a("#"+d.join("-"));g.find(".name:first").html(c.data.name);a.isArray(c.data.routes)&&c.data.routes.length?g.find(".routes:first").html(" "+c.data.routes.join(" ")):g.find(".routes:first").html(" ");"0"==c.data.status?g.children("a").addClass("gray"):"1"==c.data.status&&g.children("a").removeClass("gray");g.find(".id:first").html(c.data.id);g.attr("id",d[0]+"-"+c.data.id);g.find("a").attr("href",f);"sort_products"in c.data&&(f=f.replace(/&sort=[^&]*/,"&sort="),
f=f.replace(/&order=[^&]*/,"&order="));location.hash!=f?location.hash=f:a.products.dispatch();b.trigger("close")},g=function(a){if(a&&a.errors){a=a.errors;for(var c in a)b.find("input[name="+c+"]").addClass("error").parent().find(".errormsg").text(a[c]);return!1}};a("#s-category-description-content").length&&a("#s-category-description-content").waEditor("sync");if(c.find("input:file").length)a.products._iframePost(c,f,g);else return a.shop.jsonPost(c.attr("action"),c.serialize(),f,g),!1}})})},exportProducts:function(a,
c){for(var e=[],d,f=!1;d=a.serialized.pop();)d.name&&("product_id[]"==d.name?e.push(parseInt(d.value,10)):"hash"==d.name&&(f=d.value));d="?action=importexport#/"+c;f?window.location=d+("/hash/"+f):e.length&&(d+="/hash/id/"+e.join(","),window.location=d)},duplicateProducts:function(b,c){for(var e=[],d,f=!1;d=b.serialized.pop();)d.name&&("product_id[]"==d.name?e.push(parseInt(d.value,10)):"hash"==d.name&&(f=d.value));!f&&e.length&&(f="id/"+e.join(","));f&&(c.find("i.icon16").removeClass("split").addClass("loading"),
this.duplicate(f,{progress:function(a){c.attr("title",Math.round(100*a.offset/a.total_count)+"%")},finish:function(b,d){c.attr("title",null);var e=c.find("i.icon16");e.removeClass("loading").addClass("yes");setTimeout(function(){e.removeClass("yes").addClass("split")},3E3);a(document).one("product_list_init_view",function(){var b={};a.each(d,function(a,c){b[c]=1});a("#product-list [data-product-id]").each(function(){var c=a(this),d=a(this).data("product-id");d&&b[d]&&c.addClass("highlighted")})});
a.products.dispatch()},error:function(a){}}))},setBadge:function(b,c){function e(b){var e="delete-badge"==d?null:b.data;a("#product-list [data-product-id]").each(function(){var b=a(this);if(g||f[b.data("product-id")]){if(b.is("tr")){var c=b.find(".s-image a");c.find(".s-image-corner").remove();e&&c.prepend(a('<div class="s-image-corner"></div>').html(e))}else c=b.find(".s-product-image a"),c.find(".s-image-corner.top.right").remove(),e&&c.append(a('<div class="s-image-corner top right"></div>').html(e));
b.trigger("badge",[e])}});"set-custom-badge"==d&&c.parent().find(".textarea-wrapper").slideUp("fast");c.find(".loading").remove();c.find("a").append(a('<span class="count"><i class="icon16 yes"></i></span>').animate({opacity:0},function(){a(this).remove()}));a.product_list.container.find(".s-select-all:first").trigger("select",!1)}var d=c.data("action");"set-custom-badge"!=d&&c.parent().find(".textarea-wrapper").slideUp("fast");c.find(".loading").remove();c.find("a").append('<span class="count"><i class="icon16 loading"></i></span>');
var f={},g=!1;a.each(b.serialized,function(){g=g||"hash"==this.name;f[this.value]=1});if("delete-badge"==d)c.find(".loading").remove(),a.shop.jsonPost("?module=product&action=badgeDelete",b.serialized,e);else{var h;h="set-custom-badge"==d?c.find("textarea").val():c.data("type");var k=b.serialized;k.push({name:"code",value:h});a.shop.jsonPost("?module=product&action=badgeSet",k,e)}},duplicate:function(b,c){var e=this,d=[];a.shop.jsonPost("?module=products&action=duplicate",{hash:b,limit:50,offset:c.offset||
0},function(a){"ok"==(a.status||"error")&&(d=d.concat(a.data.new_ids||[]),a.data.offset<a.data.total_count?(c.offset=a.data.offset,e.duplicate(b,c),c.progress(a.data||{})):c.finish(a.data||{},d))})},remove:function(b,c){var e={},d=[],f;b.product_id?f=function(){100>=b.product_id.length&&(e.get_lists=!0);e.product_id=b.product_id.splice(0,100);a.shop.jsonPost("?module=products&action=deleteList",e,function(a){a.data.not_allowed&&a.data.not_allowed.length&&(d=d.concat(a.data.not_allowed));b.product_id.length?
f():"function"===typeof c&&c(a,d)})}:(e.hash=b.hash||this.collection_hash.join("/")||"all",e.remove=a.isArray(b.remove)&&b.remove.length?b.remove:["list"],1==e.remove.length&&"list"==e.remove[0]?f=function(){a.shop.jsonPost("?module=products&action=deleteList",e,c)}:(e.count=100,f=function(){a.shop.jsonPost("?module=products&action=deleteList",e,function(a){a.data.not_allowed&&a.data.not_allowed.length&&(d=d.concat(a.data.not_allowed));0<a.data.rest_count&&null!=a.data.rest_count?f():"function"===
typeof c&&c(a,d)})}));f()},rubberTable:function(){var b=a("#wa"),c=a("#s-content"),e=a("#s-content > .content"),c=parseInt(c.css("margin-left")),d=parseInt(e.css("margin-right")),f=a("#s-product-list-table-container table").width(),g=b.attr("style");g&&b.data("style",g);e=parseInt(e.width()-a("#s-product-list-table-container").width())+f+c+d;b.width()<e&&b.css({"min-width":e+"px"});a(window).resize()}}})(jQuery);
//# sourceMappingURL=product.min.js.map