var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var d=b.length,e=0;e<d;e++){var f=b[e];if(a.call(c,f,e,b))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,c,d){if(a){c=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var e=b[d];e in c||(c[e]={});c=c[e]}b=b[b.length-1];d=c[b];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};
$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,a){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:a})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function b(c){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+a++,c)}var a=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,d={next:function(){if(c<b.length){var e=c++;return{value:a(e,b[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");
(function(b){var a=function(b,d,e){var c=/[^\w\-\.:]/.test(b)?new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+b.replace(a.regexp,a.func)+"';return _s;"):e?a.cache[b]=a(a.load(b)):a.cache[b]=a.cache[b]||a(a.load(b));return d?c(d,a):function(b){return c(b,a)}};a.cache={};a.load=function(b){var a=document.getElementById(b),c=/<\\\/(\w+)/g;if(!a&&console)throw{message:"template with id="+b+" not found"};return a?("textarea"==a.tagName.toLowerCase()?a.value:document.getElementById(b).innerHTML).replace(c,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(b,a,e,f,g,h){if(a)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[b]||"\\"+b;if(e)return"="===e?"'+_e("+f+")+'":"'+("+f+"||'')+'";if(g)return"';";if(h)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(b){return String(b||"").replace(a.encReg,function(b){return a.encMap[b]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):b.tmpl=a})(this);(function(b){b.fn.lazyLoad=function(a,c){function d(){if(e.stopped)this.onscroll=null;else if(!e.stopped&&!e.loading&&h(g,f)<=e.distance){if(null!==e.hash){var b=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(b)){this.onscroll=null;return}}e.load()}}if("stop"==a){var e=this.data("lazyLoadSettings");e&&(e.stopped=!0)}else if("reload"==a){if(e=this.data("lazyLoadSettings"))e.stopped=!1,e.loading=!1,this.get(0).onscroll=null,this.lazyLoad(e)}else if("sleep"==a){if(e=this.data("lazyLoadSettings"))e.loading=
!0}else if("wake"==a){if(e=this.data("lazyLoadSettings"))e.loading=!1}else if("force"==a)(e=this.data("lazyLoadSettings"))&&(e.loading||e.load());else{if("get"===a)return e=this.data("lazyLoadSettings")||{},e[c];this.data("lazyLoadSettings",b.extend({distance:50,load:function(){},container:g,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));e=this.data("lazyLoadSettings");e.loading=!1;e.stopped=!1;var f=b(window),g=e.container||b(this);
null===e.hash||b.isArray(e.hash)||(e.hash=[e.hash]);b.fn.lazyLoad.call(f,e.state);(function(){var b,a=setTimeout(b=function(){if(e.stopped)clearTimeout(a);else{if(null!==e.hash){var c=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(c)){clearTimeout(a);return}}e.loading?a=setTimeout(b,350):(h(g,f),h(g,f)<=e.distance?(e.load(),a=setTimeout(b,350)):(f.get(0).onscroll=d,clearTimeout(a)))}},350)})();var h="function"===typeof e.distanceBetweenBottoms?e.distanceBetweenBottoms:
function(a,c,d){a="string"===typeof a?b(a):a;d=d||0;return a.position().top+a.outerHeight()-d-(c.scrollTop()+c.height())}}}})(jQuery);$.fn.liveDraggable=function(b){this.each(function(b,a){b=$(this);b.data("init_draggable")&&b.die("mouseover",b.data("init_draggable"))});var a;this.die("mouseover").live("mouseover",a=function(){var c=$(this);c.data("init_draggable")||c.data("init_draggable",a).draggable(b)})};
$.fn.liveDroppable=function(b){this.each(function(b,a){b=$(this);b.data("init_droppable")&&b.die("mouseover",b.data("init_droppable"))});var a=function(){var c=$(this);c.data("init_droppable")||(c.data("init_droppable",a).droppable(b),c.mouseover())};a.call(this);this.die("mouseover",a).live("mouseover",a)};(function(b){b.fn.inlineEditable=function(a,c){function d(){p(b(this))||b(this).addClass(m.placeholderClass).text(m.placeholder)}function e(){p(b(this))==m.placeholder&&b(this).text("").removeClass(m.placeholderClass)}function f(a){return b(a).val()?!1:(b(this).text(m.placeholder).addClass(m.placeholderClass),!0)}function g(){u="edit";this.id=this.id||(""+Math.random()).slice(2);var a=this.id+"-input",c=b("#"+a);c.length||(q.after(k(a)),c=b("#"+a));c.addClass(m.inputClass);l(c,q);m.placeholder&&p(b(this))==
m.placeholder&&e.call(q);m.beforeMakeEditable.call(this,c);r=m.truncate?q.data("real_text"):p(q);c.val(r).show().focus();q.hide();b(m.editLink).hide();if(!t){a=[];for(var d=[],f=0,g=m.makeReadableBy.length;f<g;++f){var n=m.makeReadableBy[f];"blur"==n&&c.blur(function(){"read"!=u&&h.call(this)});"enter"==n&&a.push(13);"esc"==n&&a.push(27)}f=0;for(g=m.updateBy.length;f<g;++f)n=m.updateBy[f],"alt+enter"==n&&d.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==n&&d.push({ctrl:!0,alt:!1,shift:!1,key:13}),
"ctrl+s"==n&&d.push({ctrl:!0,alt:!1,shift:!1,key:17});a.length&&function(b){c.keydown(function(a){!~b.indexOf(a.keyCode)||a.ctrlKey||a.altKey||a.shiftKey||"read"!=u&&h.call(this,27==a.keyCode?r:null);if(d.length)for(var c in d){var e=d[c];if(a.keyCode==e.key&&a.ctrlKey==e.ctrl&&a.altKey==e.alt&&a.shiftKey==e.shift){q.trigger("readable");break}}})}(a);q.unbind("readable.inlineEditable").bind("readable.inlineEditable",function(a,c){"read"!=u&&(a=b("#"+(this.id+"-input")),h.call(a,a.val(),c))});t=!0}m.afterMakeEditable.call(this,
c)}function h(a,c){c="undefined"===typeof c?!1:!0;void 0!=a&&null!=a?b(this).val(a):a=b(this).val();if(!1!==c||!1!==m.beforeBackReadable.call(q.get(0),this,{changed:a!=r,old_text:r,new_text:a})){u="read";if(!m.placeholder||!f.call(q,this))if(m.allowEmpty||a){if(m.truncate)q.data("real_text",a),q.text(a.length<m.truncate-3?a:a.substr(0,m.truncate-3)+"...");else{var e=q,g=a;m.html?e.html(g):e.text(g)}a||d.call(this)}q.show();b(this).hide();b(m.editLink).show();!1===c&&m.afterBackReadable.call(q.get(0),
this,{changed:a!=r,old_text:r})}}function k(b){switch(m.inputType){case "textarea":return'<textarea id="'+b+'" style="display:none;"></textarea>';default:return'<input type="text" id="'+b+'" style="display:none;">'}}function l(b,a){var c=m.size.height||a.height();a=m.size.width||1.5*a.width();c=m.minSize.height&&c<m.minSize.height?m.minSize.height:c;a=m.minSize.width&&a<m.minSize.width?m.minSize.width:a;c=m.maxSize.height&&c>m.maxSize.height?m.maxSize.height:c;a=m.maxSize.width&&a>m.maxSize.width?
m.maxSize.width:a;b.height(c);b.width(a)}function n(b){return function(){return b}}function p(b){return m.html?b.html():b.text()}if(this.length){var t=!1;if("string"==typeof a){if("setOption"==a){var m=this.data("inlineEditableSettings")||{};b.extend(!0,m,c);"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(m.hold=n(m.hold));this.data("inlineEditableSettings",m)}return this}c=this.data("inlineEditableSettings");this.data("inlineEditableSettings",b.extend({inputType:"text",inputClass:"",size:{height:null,
width:null},minSize:{height:null,width:null},maxSize:{height:null,width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur","enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},afterBackReadable:function(){},beforeMakeEditable:function(){},afterMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},c,a||{}));m=this.data("inlineEditableSettings")||{};var q=this,u="read",r="";"function"!==typeof m.hold&&(m.hold=
n(m.hold));(function(){if(!this.data("inited")){m.truncate&&"boolean"==typeof m.truncate&&(m.truncate=255);if(m.truncate){var a=m.placeholder&&m.placeholder===this.text()?"":this.text();this.data("real_text",a);this.text(a.length<m.truncate-3?a:a.substr(0,m.truncate-3)+"...")}m.placeholder&&d.call(this);m.editLink&&b(m.editLink).unbind("click.inlineEditable").bind("click.inlineEditable",function(){m.hold.call(q)||"edit"!=u&&g.call(q.get(0))});m.editOnItself&&this.unbind("click.inlineEditable").bind("click.inlineEditable",
function(){m.hold.call(q)||"edit"!=u&&g.call(this)});this.unbind("editable.inlineEditable").bind("editable.inlineEditable",function(){m.hold.call(q)||"edit"!=u&&g.call(this)});this.unbind("placeholder.inlineEditable").bind("placeholder.inlineEditable",function(a,c){c&&m.placeholder&&d.call(this);c||b(this).removeClass(m.placeholderClass)});this.data("inited",!0)}}).call(this);return this}}})(jQuery);(function(b){b.fn.photoStreamSlider=function(a){function c(){function a(c){function f(){a.execution=!1;var b="on"+k.charAt(0).toUpperCase()+k.slice(1);b=d[b];"function"==typeof b&&b.call(e);b=c.fn;"function"==typeof b&&b.call(e)}"string"==typeof c&&(c={direction:c,animate:!0});var k=c.direction||"forward",p=c.steps||h.length;if(!a.execution){a.execution=!0;var t=h.filter(":first").outerWidth()*p,q=h.length;if("forward"==k){var r=h.filter(":last").nextAll(":lt("+p+")");p=r.length;r=r.filter(":last");
p&&(h.removeClass("visible"),r.prevAll(":lt("+(q-1)+")").addClass("visible"),r.addClass("visible"))}else r=h.filter(":first").prevAll(":lt("+p+")"),p=r.length,r=r.filter(":last"),p&&(h.removeClass("visible"),r.nextAll(":lt("+(q-1)+")").addClass("visible").show(),r.addClass("visible"));h=b("li.visible",g);q=g.position().left;"forward"==k?(p=n-l-m,q-=t,q=q>-p?q:-p):(q+=t,q=q<m?q:m);c.animate?g.animate({left:q},d.duration,f):(g.css({left:q}),f())}}var g=e.find(d.photoStream),h=b("li.visible",g),k=b("li",
g),l=h.filter(":first").outerWidth()*h.length,n=k.filter(":first").outerWidth()*k.length,p=d.height||k.filter(":first").outerHeight();g.parent().css({overflow:"hidden",height:p,position:"relative",padding:"4px 0",margin:0,width:l});p=g.find("li:first");var t=h.filter(":first"),m=(t.outerWidth()-t.width())/2,q=0,u=p.outerWidth();for(t=t.get(0);p.length&&p.get(0)!=t;)q+=u,p=p.next();g.css({position:"absolute",left:-(q-m),width:n});b(d.forwardLink).unbind("click").bind("click",function(){a("forward");
return!1});b(d.backwardLink).unbind("click").bind("click",function(){a("backward");return!1});e.unbind("append prepend").bind("append prepend",function(a,c){if("append"==a.type){for(var d=g.find("li:last"),f=b();d.hasClass("dummy");)f=f.add(d),d=d.prev("li");f.remove();g.append(c)}else{d=b("<div></div>").html(c);c=d.find("li");var h=c.length*u;d.remove();d=g.find("li:first");for(f=b();d.hasClass("dummy");)f=f.add(d),d=d.next("li");f.remove();g.prepend(c)}k=g.find("li");n=k.filter(":first").outerWidth()*
k.length;g.css("width",n);"prepend"==a.type&&(g.is(":animated")&&g.stop(!1,!0),g.css("left",parseInt(g.css("left"))-h));g.find("li.selected").hasClass("visible")&&e.trigger("home",[null,!1])});e.unbind("forward backward").bind("forward backward",function(b,c){a({direction:b.type,steps:c.steps,animate:"undefined"!==typeof c.animate?c.animate:!0,fn:c.fn});c=g.find("li.selected");b="forward"==b.type?c.next("li:not(.dummy)"):c.prev("li:not(.dummy)");b.length&&(c.removeClass("selected"),b.addClass("selected"))});
e.unbind("home").bind("home",function(c,d,e){c=parseInt(h.length/2);c=h.filter(":eq("+c+")");var f=c.nextAll(".selected:first"),g=c.prevAll(".selected:first"),k=0,l="";"function"!==typeof d&&(e=d);e="undefined"!==typeof e?e:!0;f.length?(l="forward",c.nextAll().each(function(){++k;if(b(this).hasClass("selected"))return!1})):g.length&&(l="backward",c.prevAll().each(function(){++k;if(b(this).hasClass("selected"))return!1}));l&&k?a({direction:l,steps:k,fn:d,animate:e}):"function"==typeof d&&d();return!1});
e.unbind("refresh").bind("refresh",function(){c()})}var d=b.extend({duration:200,height:48},a||{}),e=this;c()}})(jQuery);(function(b){function a(){b("#hint-menu-block").hide().children().hide()}b.product_dragndrop={handlers:{},options:{},init:function(b){this.options=b;b.collections&&(this.initDragCollections(),this.initDropCollections());b.products&&(this.initDragProducts(),this.initDropProducts());return this},bind:function(b,a){this.handlers[b]=a;return this},trigger:function(b){if("function"===typeof this.handlers[b])return this.handlers[b].apply(this,Array.prototype.slice.call(arguments,1))},initDragProducts:function(){var c=
b("#product-list"),d=c.find(".product:not(.s-alien)");d.find(".drag-handle").live("selectstart",function(){document.onselectstart=function(){return!1};return!1});d.liveDraggable({opacity:.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,containment:[0,0,b(window).width(),{toString:function(){return b(document).height()}}],start:function(a,c){document.ondragstart=function(){return!1};c.helper.data("scrollTop",b(document).scrollTop());b(document).bind("scroll",b.product_dragndrop._scrolHelper);
b(".block.drop-target").addClass("drag-active")},handle:".drag-handle",stop:function(c,d){document.ondragstart=null;document.onselectstart=null;c=b(this);c.find("input:checked").length||c.removeClass("selected");a();b(document).unbind("scroll",b.product_dragndrop._scrolHelper);b(".block.drop-target").removeClass("drag-active");a()},helper:function(a,d){a=1;d=c.find(".s-select-all");d.is(":checked")?a=d.attr("data-count"):(d=c.find(".product.selected"),d.length?-1!==d.index(this)?a=d.length:(b(this).trigger("select",
!0),a=d.length+1):b(this).addClass("selected"));return'<div id="products-helper"><span class="indicator red">'+a+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},drag:function(b,a){b=b.originalEvent;a.position.left=b.pageX-20;a.position.top=b.pageY}})},initDropProducts:function(){b("#product-list .product").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(c,d){if(b(this).hasClass("s-alien")||!d.draggable.hasClass("product"))return!1;if(b.product_dragndrop.trigger("is_product_sortable"))a();
else if(c=b.product_dragndrop.options.sort)d=b("#hint-menu-block").show(),d.children().hide(),d.find("."+c).show();b.product_dragndrop._activatePhotoListItem.call(this)},out:function(a,d){b.product_dragndrop._unactivatePhotoListItem.call(this)},drop:function(a,d){if(!d.draggable.hasClass("product"))return!1;var c=b(this);if(c.hasClass("selected"))return b.product_dragndrop._unactivatePhotoListItem.call(this),!1;var f=b("#product-list").find(".product.selected");if(!b.product_dragndrop.trigger("is_product_sortable"))return b.product_dragndrop._unactivatePhotoListItem.call(this),
b.product_dragndrop._unactivatePhotoListItem.call(d.draggable),!1;a=null;if(c.hasClass("s-alien")){var g=c.nextAll(":not(.s-alien):first");if(g.length)a=g.attr("data-product-id"),g.before(f);else{g=c.prevAll(":not(.s-alien):first");if(!g.length||g.hasClass("selected"))return!1;a=null;g.after(f)}g.hasClass("last")&&(g.removeClass("last"),f.filter(":last").addClass("last"))}else c.hasClass("drag-active-last")||(a=c.attr("data-product-id")),c.hasClass("last")&&c.hasClass("drag-active-last")?(c.after(f).removeClass("drag-active drag-active-last last"),
f.filter(":last").addClass("last")):c.before(f).removeClass("drag-active"),c.removeClass("drag-active drag-active-last");b.product_dragndrop._unactivatePhotoListItem.call(this);b.product_dragndrop._unactivatePhotoListItem.call(d.draggable);f.trigger("select",!1);d=f.map(function(){return b(this).attr("data-product-id")}).toArray();b.product_dragndrop.trigger("move_product",{product_ids:d,before_id:a,error:function(b){b&&console&&console.log("undefined"!==typeof b.errors?b.errors:b)}})}})},initDragCollections:function(){var a=
b("#wa-app .sidebar:first"),d=a.position(),e=a.width();a=a.height();b(".s-collection-list li.dr").liveDraggable({containment:[d.left,d.top,d.left+1.25*e,d.top+1.25*a],refreshPositions:!0,revert:"invalid",helper:function(){var a=b(this),c=a.parents(".s-collection-list:first").find("ul:first");a=a.clone().addClass("ui-draggable dr-helper").css({position:"absolute"}).prependTo(c);a.find("a:first").append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display:none;"></i>');return a},
cursor:"move",cursorAt:{left:5},opacity:.75,zIndex:9999,distance:5,start:function(b,a){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},initDropCollections:function(){this.initDropBetweenCollections();this.initDropInsideCollections()},initDropBetweenCollections:function(){b(".s-collection-list li.drag-newposition").liveDroppable({greedy:!0,tolerance:"pointer",over:function(a,d){a=b(this);if(d.draggable.attr("data-type")!=a.attr("data-type"))return!1;a.addClass("active").parent().parent().addClass("drag-active")},
out:function(a,d){a=b(this);if(d.draggable.attr("data-type")!=a.attr("data-type"))return!1;a.removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(a,d){var c=b(this);if(d.draggable.attr("data-type")!=c.attr("data-type"))return!1;(c.is(":animated")||c.hasClass("dragging"))&&c.stop().animate({height:"2px"},300,null,function(){c.removeClass("dragging")});c.removeClass("active").parent().parent().removeClass("drag-active")},drop:function(a,d){var c=b(this),f=d.draggable;
d=f.attr("data-type");if(d!=c.attr("data-type"))return!1;a=function(b){b=b.split("-");b.shift();return b.join("-")};var g=a(f.attr("id")),h=c.prev("li"),k=f.next(),l=f.prev();if(h.length&&h.attr("id")=="category-"+g&&!h.hasClass("dr-helper")||this==f.next().get(0))return!1;var n=f.parent("ul"),p=n.children("li.dr[id!=category-"+g+"]").length,t=parseInt(a(n.parent().attr("id")),10)||0;c.after(k).after(f);c=f.parent().parent();if(c.is("li.dr")||c.is(".s-collection-list")){var m=0;c.is(".s-collection-list")||
(m=parseInt(a(c.attr("id")),10)||0);c=f.nextAll("li.dr:first");h=null;c.length&&(h=a(c.attr("id"))||null);p||t===m||(n.parent("li").children("i").hide(),n.hide());b.product_dragndrop.trigger("move_list",{id:g,type:d,before_id:h,parent_id:m,success:function(a){p||t===m||(n.parent("li").children("i").remove(),n.remove(),b.categories_tree.setCollapsed(t))},error:function(b){b&&console&&console.log("undefined"!==typeof b.errors?b.errors:b);l.after(f.next()).after(f);p||n.show()}})}}})},initDropInsideCollections:function(){b(".s-collection-list li.dr a").liveDroppable({tolerance:"pointer",
greedy:!0,out:function(a,d){a=d.draggable;var c=b(this).parent();if(!a.hasClass("product")&&c.attr("data-type")!=a.attr("data-type"))return!1;a.hasClass("product")&&d.helper.find("span").show().end().find("i").hide();c.removeClass("drag-newparent")},over:function(a,d){var c=d.draggable;a=b(this).parent();var f=c.attr("data-type");if(!c.hasClass("product")&&f!=a.attr("data-type"))return!1;"set"!=f&&a.addClass("drag-newparent");if(c.hasClass("product"))return a.hasClass("dynamic")?d.helper.find("span").hide().end().find("i").show():
d.helper.find("span").show().end().find("i").hide(),!1;if(!c.hasClass("dynamic")&&a.hasClass("dynamic"))return d.helper.find("i.no-bw").show(),!1;d.helper.find("i.no-bw").hide();var g='.dr[id!="'+c.attr("id")+'"]',h=b(),k=function(b,a){if(!a.length)return b;b=b.add(a.nextUntil(g).filter("li.drag-newposition"));return 0<a.nextAll(g).length?b:k(b,a.parent().closest("li"))};d=a.prevAll(g+":first");0<d.length?(c=d.find(g),h=0<c.length?k(h,c.last()):k(h,d)):h=h.add(a.prevUntil(g).filter("li.drag-newposition"));
h=0<a.children("ul").children(g).length?h.add(a.children("ul").children("li.drag-newposition:first")):k(h,a);var l=b(".drag-newposition:animated, .drag-newposition.dragging").not(h);l.stop().animate({height:"2px"},300,null,function(){l.removeClass("dragging")});h.stop().animate({height:"10px"},300,null,function(){h.addClass("dragging")})},drop:function(a,d){var c=d.draggable,f=b(this).parent();a=c.attr("data-type");if(!c.hasClass("product")&&("set"==a||f.attr("id")==c.attr("id")||a!=f.attr("data-type")))return!1;
f.removeClass("drag-newparent");if(c.hasClass("product")){if(f.hasClass("dynamic"))return!1;var g=b("#product-list"),h={};if(g.find(".s-select-all").is(":checked"))h.whole_list=!0;else{var k=g.find(".product.selected");h.product_ids=k.map(function(){return b(this).attr("data-product-id")}).toArray()}b.product_dragndrop.trigger("add_to_list",b.extend(h,{collection_param:f.attr("id").replace("-","_id="),success:function(b){h.whole_list?g.find(".s-select-all").trigger("select",!1):h.product_ids&&h.product_ids.length&&
k.trigger("select",!1);b.data&&(f.find(">.counters .count:not(.subtree)").text(b.data.count),f.find(">.counters .subtree").text(b.data.total_count))}}));return!1}if(!c.hasClass("dynamic")&&f.hasClass("dynamic"))return!1;d=c.attr("id").split("-")[1];if(f.attr("id")=="category-"+d)return!1;if(c.hasClass("product"))return b("#product-list").find(".product.selected").trigger("select",!1),!1;var l=parseInt(f.attr("id").split("-")[1],10)||0,n=null,p=c.next(),t=c.prev(),m=!1;f.hasClass("drag-newposition")?
n=f.parent("ul"):f.children("ul").length?n=f.children("ul"):f.find(">i.collapse-handler-ajax").length||(n=b('<ul class="menu-v with-icons dr unapproved"><li class="drag-newposition unapproved" data-type="'+a+'"></li></ul>').appendTo(f),n.find(".drag-newposition").mouseover(),b('<i class="icon16 darr overhanging collapse-handler-ajax unapproved" id="'+a+"-"+l+'-handler"></i>').insertBefore(f.children("a")),m=!0);var q=c.parent("ul"),u=q.children("li.dr[id!=category-"+d+"]").length,r=parseInt(q.parent().attr("id").split("-")[1],
10)||0;n&&n.append(c).append(p);u||r===l||(q.parent("li").children("i").hide(),q.hide());f.is("li.dr")&&b.product_dragndrop.trigger("move_list",{id:d,type:a,parent_id:l,success:function(a){u||r===l||(q.parent("li").children("i").remove(),q.remove(),b.categories_tree.setCollapsed(r));n?(b(".s-collection-list .unapproved").removeClass("unapproved"),m?b.categories_tree.setExpanded(l):f.trigger("count_subtree")):(c.remove(),p.remove(),f.trigger("update_counters",a.data.count||{}))},error:function(a){a&&
console&&console.log("undefined"!==typeof a.errors?a.errors:a);t.after(c).after(p);u||q.show();b(".s-collection-list .unapproved").remove()}})}})},_scrolHelper:function(a){a=b("#products-helper");var c=a.data("scrollTop"),e=b(document).scrollTop();c=c?e-c:50;a.css("top",a.position().top+c+"px");a.data("scrollTop",e)},_extDragActivate:function(a,d,e){var c=e+"-last";if(d.hasClass("last")){var g=a.pageX;a=a.pageY;var h=d.width(),k=d.height(),l=d.offset();"thumbs"==b.product_dragndrop.options.view?g>
l.left+.5*h&&g<=l.left+h?(d.removeClass(e).addClass(c),b.product_dragndrop._shiftToLeft(d)):g>l.left&&g<=l.left+.5*h?(d.removeClass(c).addClass(e),b.product_dragndrop._shiftToRight(d)):b.product_dragndrop._shiftAtPlace(d):"table"==b.product_dragndrop.options.view&&(a>l.top+.5*k?d.removeClass(e).addClass(c):a>l.top&&d.removeClass(c).addClass(e));(a<l.top||a>l.top+k||g<l.left||g>l.left+h)&&d.removeClass(e).removeClass(c)}else d.addClass("drag-active")},_bindExtDragActivate:function(a,d){b(document).bind("mousemove.ext_drag_activate",
function(c){b.product_dragndrop._extDragActivate(c,a,d)})},_unbindExtDragActivate:function(){b(document).unbind("mousemove.ext_drag_activate")},_activatePhotoListItem:function(){var a=b(this),d=b.product_dragndrop.trigger("is_product_sortable"),e=d?"drag-active":"drag-active-disabled";d&&"thumbs"==b.product_dragndrop.options.view&&b.product_dragndrop._shiftToRight(a);a.hasClass("last")?b.product_dragndrop._bindExtDragActivate(a,e):a.addClass(e)},_unactivatePhotoListItem:function(){var a=b(this),d=
b.product_dragndrop.trigger("is_product_sortable"),e=d?"drag-active":"drag-active-disabled",f=e+"-last";a.hasClass("last")&&b.product_dragndrop._unbindExtDragActivate();a.removeClass(e+" "+f);d&&"thumbs"==b.product_dragndrop.options.view&&b.product_dragndrop._shiftAtPlace(a)},_shiftToLeft:function(a){if("left"!==a.data("shifted")){var c=a.find(".p-wrapper");if(!c.length){var e=a.children();c=b("<div class='p-wrapper' style='position:relative;'></div>").appendTo(a);c.append(e)}c.stop().animate({left:-15},
200);a.data("shifted","left")}},_shiftToRight:function(a){if("right"!==a.data("shifted")){var c=a.find(".p-wrapper");if(!c.length){var e=a.children();c=b("<div class='p-wrapper' style='position:relative;'></div>").appendTo(a);c.append(e)}c.stop().animate({left:15},200);a.data("shifted","right")}},_shiftAtPlace:function(b){if(b.data("shifted")){var a=b.find(".p-wrapper");if(a.length){var c=a.children();a.stop().css({left:0});b.append(c);a.remove()}b.data("shifted","")}}}})(jQuery);(function(b){var a=function(b){var a=/^category-(.*?)-handler$/;return a.test(b.attr("id"))?b.attr("id").replace(a,function(b,a){return parseInt(a,10)||0}):0},c=function(b){if(a(b))b=b.parents("li:not(.drag-newposition):first"),d=c=b.find("ul:first");else{b=b.parent();var c=b.next(),d=c.find("ul:first")}return{parent:b,target:c,ul:d}},d=function(b,a){var d=c(b);"category"==d.parent.attr("data-type")&&d.parent.trigger("count_subtree",!1);b.removeClass("rarr").addClass("darr");d.target.show();"function"===
typeof a&&a(b)},e=function(b,a){var c=b.parent.find(".loading:first");b=b.parent.find(".counters");a?(c.show(),b.hide()):(c.hide(),b.show())},f=function(d,e){var f=c(d);"category"!=f.parent.attr("data-type")||f.parent.hasClass("dynamic")||f.parent.trigger("count_subtree",!0);d.removeClass("darr").addClass("rarr");f.target.hide();"function"===typeof e&&e(d);b.get("?action=categoryExpand&id="+a(d)+"&collapsed=1")},g=function(f,g,l){if(!f.data("loading_content")){var h=c(f);h.ul.length?d(f,g):e(h,!0);
var k=!h.ul.length;f.data("loading_content",k);b.get("?action=categoryExpand&id="+a(f)+(k?"&tree=1":""),function(b){k&&(h.target.length?h.target.append(b):h.parent.append(b),e(h,!1),d(f,g),f.data("loading_content",!1));"function"===typeof l&&l()})}};b.categories_tree={init:function(){b("#s-category-list-block").off("click",".collapse-handler-ajax").on("click",".collapse-handler-ajax",function(){var a=b(this);a.hasClass("darr")?f(a):g(a)});b("#s-category-list-block .heading").off("click").click(function(a){var c=
b(this).find(".collapse-handler-ajax");c.is(a.target)||c.click()})},collapse:function(a,c){a=b(a);a.hasClass("darr")?f(a,c):"function"===typeof c&&c(a)},expand:function(a,c,d){a=b(a);a.hasClass("rarr")?g(a,c,d):("function"===typeof c&&c(a),"function"===typeof d&&d(a))},isCollapsed:function(a){return b(a).hasClass("rarr")},setExpanded:function(a){b.get("?action=categoryExpand&id="+a)},setCollapsed:function(a){b.get("?action=categoryExpand&id="+a+"&collapsed=1")},getHandlerByCategoryId:function(a){b();
return(a=parseInt(a,10)||0)?b("#category-"+a+"-handler"):b("#s-category-list-handler")}}})(jQuery);(function(b){b.product_sidebar={options:{},init:function(){var a=b("#s-sidebar");b.product_dragndrop.init({collections:!0}).bind("move_list",function(a){function c(a){a='<div class="dialog width650px height250px small">\n    <div class="dialog-background"></div>\n        <div class="dialog-window">\n        <div class="dialog-content">\n            <div class="dialog-content-indent">\n                <p>%text%</p>\n            </div>\n        </div>\n        <div class="dialog-buttons">\n            <div class="dialog-buttons-gradient">\n                <input class="button gray cancel" type="button" value="%button_text%">\n            </div>\n        </div>\n    </div>\n</div>'.replace("%text%",
a).replace("%button_text%",b.wa.locale.Close);var c=b(a);c.waDialog({onClose:function(){c.remove()}})}if(a.type){var d={id:a.id,type:a.type,parent_id:a.parent_id||0};a.before_id&&(d.before_id=a.before_id);b.products.jsonPost("?module=products&action=moveList",d,a.success,function(d){d.errors&&d.errors.length&&b.each(d.errors,function(b,a){b=null;"string"===typeof a&&(b=a);"string"===typeof a.text&&(b=a.text);b&&c(b)});return"function"===typeof a.error?a.error(d):a.error})}else"function"===typeof a.error&&
a.error("Unknown list type")});a.off("add",".s-collection-list ul").on("add",".s-collection-list ul",function(a,c,f,g){a=b(this);var d=a.parents(".s-collection-list:first"),e=b("<ul></ul>");e.append(tmpl("template-sidebar-list-item",{type:f,item:c}));c=e.children(":not(.drag-newposition):first");f=c.attr("id");f=a.find("#"+f);var l=e.children();f.length?g&&f.replaceWith(c):a.prepend(l).show();l.each(function(){var a=b(this);a.hasClass("dr")?a.find("a").mouseover():a.mouseover()});a.find(".drag-newposition").css({height:"2px"}).removeClass("dragging");
d.find(".s-empty-list").hide();e.remove();return!1});a.unbind("update").bind("update",function(a,c){for(var d in c)if("all"==d)b("#s-all-products").find(".count:first").text(c[d].count);else{a="#"+d+"-";for(var e in c[d])b(a+e).find(".count:first").text(c[d][e].count)}return!1});b("#s-tag-cloud").unbind("update").bind("update",function(a,c){a='<ul class="tags"><li class="block align-center">';for(var d in c){var e=c[d];a+='<a href="#/products/tag='+e.uri_name+'/" style="font-size: '+e.size+"%; opacity: "+
e.opacity+'"  data-id="'+e.id+'"  class="s-product-list">'+e.name+"</a> "}a+="</li></ul>";b("#s-tag-cloud").html(a).parents(".block:first").show();return!1});a.off("count_subtree",".s-collection-list li").on("count_subtree",".s-collection-list li",function(a,c){var d=b(this);"undefined"===typeof c&&(c=d.find("i.collapse-handler-ajax").hasClass("rarr"));a=d.find(">.counters .count:not(.subtree)");d=d.find(">.counters .subtree");d.length||(d=a.clone().addClass("subtree").hide(),a.after(d));c?(a.hide(),
d.show()):(d.hide(),a.show());return!1});a.off("update_counters",".s-collection-list li").on("update_counters",".s-collection-list li",function(a,c){var d=b(this);a=d.find(">.count:not(.subtree)");d=d.find(">.subtree");d.length||(d=a.clone().addClass("subtree").hide(),a.after(d));"undefined"!==typeof c.item&&a.text(parseInt(c.item,10)||0);"undefined"!==typeof c.subtree&&d.text(parseInt(c.subtree,10)||0);return!1});var c=a.find("#s-category-list-widen-arrows");c.find("a.arrow").unbind("click").bind("click",
function(){var d=a.attr("class"),e=0,f=d.match(/left([\d]{2,3})px/);if(f&&f[1]&&(e=parseInt(f[1]))&&(f=e+(b(this).is(".right")?50:-50),f=Math.max(Math.min(f,1E3),200),f!=e)){c.css({width:f.toString()+"px"});e=["left"+e+"px","left"+f+"px"];a.attr("class",d.replace(e[0],e[1]));a.css("width","");var g=b("#s-content");d=g.attr("class");g.attr("class",d.replace(e[0],e[1]));g.css("margin-left","");b.product&&b.product.setOptions({sidebar_width:f});b.shop.jsonPost("?action=sidebarSaveWidth",{width:f});a.trigger("change_width",
[f])}return!1});a.off("click","#s-forcesort-by-name").on("click","#s-forcesort-by-name",function(){b.product_sidebar.sortCategoryDialog();return!1});a.off("click",".s-new-list").on("click",".s-new-list",function(){var a=b(this),c=a.attr("id"),f=0;c?a=c.replace("s-new-",""):(f=a.parents("li.dr:first").attr("id").split("-"),a=f[0],f=f[1]);"category"===a?shopDialogProductsCategory.staticDialog(b.product_list.collection_hash[1],f,"new"):shopDialogProductsSet.staticDialog(b.product_list.collection_hash[1],
"new");return!1})},updateItemInCategoryList:function(a,c){var d=b("#category-"+a.data.id);d.find(".name:first").html(a.data.name);b.isArray(a.data.routes)&&a.data.routes.length?d.find(".routes:first").html(" "+a.data.routes.join(" ")):d.find(".routes:first").html(" ");a.data.subcategories_updated?"0"==a.data.status?d.find("a").addClass("gray"):"1"==a.data.status&&d.find("a").removeClass("gray"):"0"==a.data.status?d.children("a").addClass("gray"):"1"==a.data.status&&d.children("a").removeClass("gray");
d.find(".id:first").html(a.data.id);d.attr("id","category-"+a.data.id);d.find("a").attr("href",c);return null},createNewElementInList:function(a,c){var d=b("#s-"+c+"-list"),e=d.find("ul:first");e.length||(d.prepend('<ul class="menu-v with-icons"><li class="drag-newposition" data-type="'+c+'"></li></ul>'),d.find(".drag-newposition").mouseover(),e=d.find("ul:first"));var f=parseInt(a.parent_id,10)||0;d=b.categories_tree.getHandlerByCategoryId(f);var g=function(){if(f){var d=e.find("#"+c+"-"+a.parent_id);
d.find(">.collapse-handler-ajax").length||(d.append('<ul class="menu-v with-icons dr"><li class="drag-newposition" data-type="'+c+'"></li></ul>'),d.find(".drag-newposition").mouseover(),d.find(">a").before('<i class="icon16 darr overhanging collapse-handler-ajax" id="'+c+"-"+f+'-handler"></i>'),b.categories_tree.setExpanded(f));e=d.find("ul:first")}e.trigger("add",[a,c])};"category"==c?b.categories_tree.expand(d,function(){g()}):g()},sortCategoryDialog:function(){b("#s-products-sort-categories").waDialog({disableButtonsOnSubmit:!0,
onSubmit:function(a){b(this)}})},initCategoryDescriptionWysiwyg:function(a){var c=a.find(".field.description");c.find("i").hide();c.find(".s-editor-core-wrapper").show();c=.8*a.find(".dialog-window").height()||350;var d=b("#s-category-description-content");d.waEditor({lang:wa_lang,toolbarFixed:!1,maxHeight:c,minHeight:c,modification_wysiwyg_msg:d.data("modification-wysiwyg-msg"),uploadFields:a.data("uploadFields")})}}})(jQuery);(function(b){Array.prototype.filter||(Array.prototype.filter=function(b,c){var a=this.length;if("function"!=typeof b)throw new TypeError;for(var e=[],f=0;f<a;f++)if(f in this){var g=this[f];b.call(c,g,f,this)&&e.push(g)}return e});b(function(){b("#s-content").on("click",".s-alert-close",function(){var a=b.storage.get("shop/alerts");a||(a=[]);a.push(b(this).parent().data("alert"));b.storage.set("shop/alerts",a);b(this).parent().remove();return!1})});b.storage=new b.store;b.products={hash:"",list_hash:"",
list_params:{},random:"",init:function(a){b.extend(this.options,a);this.initRouting();this.initSearch();b.product_sidebar.init();b.categories_tree.init();this.initCollapsible();this.tagsHandler()},data:{prev_action:null},initRouting:function(){"undefined"!=typeof b.History&&b.History.bind(function(){b.products.dispatch()});b.wa.errorHandler=function(a){return 403===a.status||404===a.status?(a=b(a.responseText),console.log(a),a=a.find(".dialog-content").length?b('<div class="block double-padded"></div>').append(a.find(".dialog-content *")):
b('<div class="block double-padded"></div>').append(a.find(":not(style)")),b("#s-content").empty().append(a),!1):!0};var a=window.location.hash;"#/"!==a&&a?b.wa.setHash(a):this.dispatch()},skip_dispatch:0,forceHash:function(a){a!=location.hash&&(b.products.skip_dispatch++,b.wa.setHash(a))},dispatch:function(a){if(0<b.products.skip_dispatch)b.products.skip_dispatch--;else{void 0===a&&(a=window.location.hash);a=a.replace(/(^[^#]*#\/*|\/$)/g,"");var c=new b.Event("shop_before_dispatched");b(window).trigger(c);
if(c.isDefaultPrevented())return b.products.skip_dispatch=1,window.location.hash=b.products.list_hash,!1;this.hash=a;try{if(a)if(a=a.split("/"),a[0]){c="";for(var d=a.length,e=0;e<a.length;e++){var f=a[e];if(2>e)if(0===e)c=f;else if("product"==c||"tag"==c||"search"==c||"plugins"==c||"pages"==c||"stocks"==c){d=e;break}else if(parseInt(f,10)!=f&&-1==f.indexOf("="))c+=f.substr(0,1).toUpperCase()+f.substr(1);else{d=e;break}else{d=e;break}}var g=a.slice(d);this.preExecute(c,g);"function"==typeof this[c+
"Action"]?(b.shop.trace("$.products.dispatch",[c+"Action",g]),this[c+"Action"].apply(this,g)):b.shop.error("Invalid action name:",c+"Action")}else this.preExecute(),this.defaultAction();else this.preExecute(),this.defaultAction()}catch(h){b.shop.error(h.message,h)}}},load:function(a,c){var d=Math.random();this.random=d;var e=this;b.get(a,function(a){if(e.random==d&&(b("#s-content").removeClass("bordered-left").html(a),b("html, body").animate({scrollTop:0},200),c))try{c.call(this)}catch(g){b.shop.error("$.products.load callback error: "+
g.message,g)}})},addOptions:function(a){this.options=b.extend(this.options,a||{})},preExecute:function(a,c){try{if(this.data.prev_action&&this.data.prev_action!=a){var d=this.data.prev_action+"Termination";b.shop.trace("$.products.preExecute",[d,a]);"function"==typeof this[d]&&this[d].apply(this,[])}this.data.prev_action=a;var e=b("#wa"),f=e.data("style");f?e.attr("style",f):e.removeAttr("style");b(window).resize();b("body > .dialog").trigger("close").remove()}catch(g){b.shop.error("preExecute error: "+
g.message,g)}},defaultAction:function(){this.productsAction()},welcomeAction:function(){this.load("?module=products&action=welcome")},paramsFromSession:function(a){if(!(window.sessionStorage&&window.JSON&&window.JSON.stringify&&window.JSON.parse))return a;if(a.category_id){storage=sessionStorage.getItem("shop/list_categories")||"{}";try{storage=JSON.parse(storage)}catch(d){storage={}}var c=storage[a.category_id]=storage[a.category_id]||{};b.each(["sort","order"],function(b,e){void 0===a[e]?a[e]=c[e]:
c[e]=a[e]});try{sessionStorage.setItem("shop/list_categories",JSON.stringify(storage))}catch(d){}}return a},buildProductsUrlComponent:function(b){b=this.paramsFromSession(b);return((b.view?"&view="+b.view:"")+(b.category_id?"&category_id="+b.category_id:"")+(b.set_id?"&set_id="+b.set_id:"")+(b.tag?"&tag="+b.tag:"")+(b.sort?"&sort="+b.sort:"")+(b.order?"&order="+b.order:"")+(b.text?"&text="+b.text:"")+(b.edit?"&edit="+b.edit:"")+(b.hash?"&hash="+b.hash:"")+(b.page?"&page="+b.page:"")+(b.type_id?"&type_id="+
b.type_id:"")).slice(1)},productsAction:function(){var a=Array.prototype.join.call(arguments,"/");a=b.shop.helper.parseParams(a||"");this.list_hash=this.hash;this.list_params=a;void 0!==b.product_list&&void 0!==b.product_list.fixed_blocks&&(b.product_list.fixed_blocks.set&&b.product_list.fixed_blocks.set.unsetFixed(),b.product_list.fixed_blocks.category&&b.product_list.fixed_blocks.category.unsetFixed());this.load("?module=products&"+this.buildProductsUrlComponent(a),this.checkAlerts)},checkAlerts:function(){var a=
b.storage.get("shop/alerts");b(".s-alert").each(function(){-1==b.inArray(b(this).data("alert"),a)&&b(this).show()})},productAction:function(a,c,d){var e=Array.prototype.slice.call(arguments).filter(function(b){return b.length}).join("/");b.shop.trace("$.products.productAction",[e,arguments]);var f="?module=product";a&&(f+="&id="+a);"undefined"!=typeof b.product?b.product.dispatch(e):this.load(f,function(a){b.product.dispatch(e)})},productTermination:function(){"undefined"!=typeof b.product&&b.product.termination()},
reviewsAction:function(b,c){this.load("?module=reviews"+(b?"&"+b:""))},stocksAction:function(a){var c="";if(a&&"desc"!==a&&"asc"!==a){a=""+(a||"");var d=a.match(/stock_count_(\d*)_*(desc|asc)*/);d&&(c="stock_count_"+d[1],a="desc"===d[2]?"desc":"asc")}else c="count";b("#s-stocks-container").length?b("#s-stocks-container").trigger("load",["balance",(a?"order="+a:"")+(c?"&sort="+c:"")]):this.load("?module=stocks"+(a?"&order="+a:"")+(c?"&sort="+c:"")+"&tab=balance")},stockslogAction:function(a){b("#s-stocks-container").length?
b("#s-stocks-container").trigger("load",["log",a?a:""]):this.load("?module=stocks"+(a?"&"+a:"")+"&tab=log")},servicesAction:function(a){this.load("?module=services"+(a?"&id="+a:""),function(){b("#s-content").addClass("bordered-left");"function"===typeof b.products.afterServicesAction&&b.products.afterServicesAction()})},tagsHandler:function(){b("#s-products-all-tags").autocomplete({source:"?module=product&action=tagsAutocomplete&type=search",minLength:1,delay:300,select:function(a,c){b.wa.setHash("#/products/tag="+
c.item.value);return!1}})},initCollapsible:function(){var a=function(a,c){b(a).removeClass("darr").addClass("rarr");d(a).hide();c||(b.storage.set("shop/products/"+a.id+"/collapse",1),!1!==c&&(c=a.id.replace(/\-handler$/,""),a=b(a).parents("div.block:first").find("#"+c+":first"),a.length&&(a=a.data("on-collapse-url"))&&b.get(a)))},c=function(a){d(a).show();var c=b(a);c.removeClass("rarr").addClass("darr");b.storage.del("shop/products/"+a.id+"/collapse");var e=a.id.replace(/\-handler$/,""),h=c.parents("div.block:first").find("#"+
e+"-placeholder:first");if(h.length){var k=b(a).parents("div.block:first").find(".count:first");k.find("i.icon16.loading").remove();k.find("i.icon16").hide();k.prepend('<i class="icon16 loading"></i>');b.get(h.data("url"),function(a){h.replaceWith(b(a));k.find("i.icon16.loading").remove();k.find("i.icon16").show();h.remove()})}else a=b(a).parents("div.block:first").find("#"+e+":first"),a.length&&(a=a.data("on-expand-url"))&&b.get(a)},d=function(a){a=b(a).parent();return a.is("li")?a.find("ul:first"):
a.next()};b(".collapse-handler").die("click").live("click",function(){b(this).hasClass("darr")?a(this):c(this)}).each(function(){var c="shop/products/"+this.id+"/collapse",d=b(this).hasClass("rarr");(b.storage.get(c)||d)&&a(this,!d)});b(".collapse-handler").closest(".heading").off("click").on("click",function(a){$collapse_handler=b(this).find(".collapse-handler");$collapse_handler.is(a.target)||$collapse_handler.click()})},initSearch:function(){var a=function(){b.wa.setHash("#/products/"+(b.products.list_params&&
b.products.list_params.view?"view="+b.products.list_params.view+"&":"")+"text="+encodeURIComponent(this.value))},c=b("#s-products-search");c.unbind("keydown").bind("keydown",function(c){if(13==c.keyCode){a.call(this);var d=b(this);d.autocomplete("close");setTimeout(function(){d.autocomplete("close")},300);return!1}});c.unbind("search").bind("search",function(){a.call(this);return!1});c.autocomplete({source:"?action=autocomplete",minLength:3,delay:300,select:function(a,e){c.val("");b.wa.setHash("#/product/"+
e.item.id);return!1}})},jsonPost:function(a,c,d,e){b.shop.jsonPost(a,c,d,e)},_iframePost:function(a,c,d){var e=a.attr("id")+"-iframe";b("#"+e).length||a.after("<iframe id="+e+" name="+e+" style='display:none;'></iframe>");var f=b("#"+e);a.attr("target",e);f.one("load",function(){try{var a=b(this).contents().find("body").html();var e=b.parseJSON(a)}catch(k){d(a);return}"ok"==e.status?c(e):d(e)})}}})(jQuery);(function(b){b.product={options:{duration:200,container_selector:"#shop-productprofile",message_selector:"#product-save-message",form_selector:"#s-product-save",update_delay:100},message:{submit:'<i class="icon16 loading"></i>',success:'<i class="icon16 yes"></i>',error:'<i class="icon16 no"></i>'},path:{id:null,mode:null,tab:null,tail:null,raw:null,params:{}},ajax:{random:null,target:null,link:null,save:!1,cached:{}},data:{main:{}},$edit_forms:b(),getData:function(b,c){return(this.data[b]||{})[c]},
setData:function(b,c,d){this.data[b]=this.data[b]||{};this.data[b][c]=d},standalone_tabs:["images","services","pages","reviews"],init:function(b,c){this.setOptions(b,c);this.initFeatureDate();this.deleteDivider()},setOptions:function(a,c){c?this[c+"_options"]=b.extend(this[c+"_options"]||{},a||{}):this.options=b.extend(this.options,a||{});this.options.sidebar_width=this.options.sidebar_width||250},get:function(a){if(this.options[a+"_selector"])return b(this.options[a+"_selector"]);throw new exception("");
},deleteDivider:function(){b(".js-delete-divider").click(function(){b(this).parent().find("input").val("");b(this).parent().hide();b.product.helper.updateSubmitButton(!0)})},initFeatureDate:function(){function a(){var a=b(this),c=a.siblings(".js-datepicker-hidden");a.val()||c.val("");try{b.datepicker.parseDate(b.datepicker._defaults.dateFormat,a.val()),a.data("last-correct-value",a.val()),c.data("last-correct-value",c.val())}catch(g){a.val(a.data("last-correct-value")||""),c.val(c.data("last-correct-value")||
"")}}var c=b(b.product.options.form_selector).find(".js-datepicker-wrapper"),d=c.find(".js-datepicker");d.each(function(){b(this).datepicker({altField:b(this).siblings(".js-datepicker-hidden"),altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,onSelect:a}).on("blur",a).on("keydown keypress keyup",function(b){13===b.which&&b.preventDefault()})});c.on("click",".js-focus-on-field",function(){d.focus()})},parsePath:function(a){a=a.replace(/^.*#\//,"").replace(/(^\/|\/$)/,"");var c=a.split("/"),d=c.pop(),
e={};d.match(/^[\w_\-]+=/)?e=b.shop.helper.parseParams(d):c.push(d);return{id:c[0]||"new",mode:c[1]||"profile",tab:c[1]?c[2]||"main":!1,tail:c.slice(3).join("/")||"",raw:a,params:e}},dispatch:function(a){"string"==typeof a&&(a=this.parsePath(a));var c=[];b.shop.trace("$.product.dispatch",[this.path,a,a.raw]);if(a.tab)switch(a.tab){case "main":b(document).trigger("wa_product_section_change","product-general");break;case "descriptions":b(document).trigger("wa_product_section_change","product-seo");
break;case "images":b(document).trigger("wa_product_section_change","product-media");break;case "features":b(document).trigger("wa_product_section_change","product-sku");break;case "services":b(document).trigger("wa_product_section_change","product-services");break;case "related":b(document).trigger("wa_product_section_change","product-related");break;case "pages":b(document).trigger("wa_product_section_change","product-pages");break;default:b(document).trigger("wa_product_section_change","product")}else b(document).trigger("wa_product_section_change",
"product");if(!this.path.id){var d=this.get("container");d.length&&(this.path.id=d.data("product-id"),c.push("load"))}if(this.path.id!=a.id)this.path.id&&c.push("blur"),c.push("load");else{d="undefined";this.path.mode!=a.mode?(b.shop.trace("$.product.dispatch mode",this.path.mode+"->"+a.mode),this.path.mode&&this.path.tab?(b.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+a.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(this.path.mode+"Tab"+d+"Blur"),c.push(this.path.mode+
"TabBlur"),c.push(this.path.mode+"Blur")):c.push("focus"),c.push(a.mode+"Init"),c.push(a.mode+"Focus")):this.path.tab&&a.tab!=this.path.tab&&(b.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+a.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(a.mode+"Tab"+d+"Blur"),c.push(a.mode+"TabBlur"));c.push(a.mode+"Action");var e=this.tabIsLoaded(a);a.tab&&(d=a.tab.substr(0,1).toUpperCase()+a.tab.substr(1));if(a.tab&&a.tab!=this.path.tab)if(b.shop.trace("$.product.dispatch tabFocus",
this.path.tab+"->"+a.tab),e)c.push(a.mode+"TabShow"),c.push(a.mode+"TabInit"),c.push(a.mode+"Tab"+d+"Init"),c.push(a.mode+"TabFocus"),c.push(a.mode+"Tab"+d+"Focus");else{c.push(a.mode+"TabFocus");var f=a.mode+"Tab"+d+"Load";this.isCallable(f)?c.push(f):c.push(a.mode+"TabLoad")}a.tab&&e&&c.push(a.mode+"Tab"+d+"Action")}for(d=0;d<c.length;d++)if(!1===this.call(c[d],[a]))return!1},termination:function(){var b=[];if(this.path.mode&&this.path.tab){var c=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1);
b.push(this.path.mode+"Tab"+c+"Blur");b.push(this.path.mode+"TabBlur");b.push(this.path.mode+"Blur")}b.push("blur");for(c=0;c<b.length;c++)this.call(b[c],[])},isCallable:function(b){return"function"==typeof this[b]},tabIsLoaded:function(a){return b("#s-product-edit-forms").find(".s-product-form."+a.tab).length?!0:!1},call:function(a,c,d){d=null;var e=this.isCallable(a);c=c||[];b.shop.trace("$.product.call",[a,c,e]);if(e)try{d=this[a].apply(this,c)}catch(f){b.shop.error("Error at method $.product."+
a+". Original message: "+f.message,f)}return d},load:function(a){var c=this.get("container");if(!c.length||c.data("product-id")!=a.id){var d=this;c="?module=product&id="+a.id;b.shop.trace("$.product.load product",c);b.products.load(c,function(){d.dispatch(a)})}this.editTabMainData.sku_id="new"==a.id?-1:0;this.editTabMainData.stocks={}},focus:function(){b("*").off(".product");this.helper.init()},blur:function(){this.path.id=null;this.path.mode=null;this.path.tab=null;this.path.tail=null;b("*").off(".product");
b("#mainmenu").find(".s-level2").show();b("#s-product-edit-menu, #s-product-edit-save-panel").hide();b("#s-sidebar").show().animate({width:b.product.options.sidebar_width},"fast").queue(function(){b(this).dequeue()});b("#s-toolbar").show().animate({width:"200px"});b("#maincontent").animate({"margin-top":"84px"},"fast");b("#s-content").animate({"margin-left":b.product.options.sidebar_width},"fast")},saveData:function(a,c,d){var e=this,f=e.get("form"),g="radio",h=f.find('input[name="product[sku_type]"]:first');
if(h.is(":radio")){var k=f.find('input[name="product[sku_type]"]:checked').val();h=f.find('input[name="product[sku_type]"]')}else g="hidden",k=f.find('input[name="product[sku_type]"]:not(:disabled)').val();if("1"==k&&!b("#s-product-feature-superposition").find("input:checked:first").length&&"radio"==g)return h.filter("[value=0]").attr("checked",!0),b.product.onSkuTypeChange(0),!1;if(e.ajax.save)return setTimeout(function(){e.saveData(a,c,d)},100),!1;if(this.path.tab&&(k="editTab"+this.path.tab.substr(0,
1).toUpperCase()+this.path.tab.substr(1)+"Save",!1===this.call(k)))return!1;e.ajax.save=!0;b("#s-product-description-content").length&&b("#s-product-description-content").waEditor("sync");f.find(".s-price").find("input").each(function(){this.value=this.value.replace(/\s+/g,"")});b.shop.trace("$.product.saveData(mode="+a+", tab="+c+")");k=b("#product-tags_tag");k.length&&(g=jQuery.Event("keypress",{which:13}),k.trigger(g));b(f).find(':input[name^="product\\["]:not(:disabled)').each(function(){var a=
b(this).attr("type");if("text"!=a&&"textarea"!=a)return!0;this.defaultValue==this.value?b(this).attr("disabled",!0).addClass("js-ajax-disabled"):b(this).hasClass("js-ajax-disabled")&&b(this).removeAttr("disabled").removeClass("js-ajax-disabled")});this.refresh("submit");this.clearValidateErrors();b.ajax({url:b(f).attr("action"),data:b(f).serializeArray(),dataType:"json",type:"post",success:function(f){if("fail"==f.status)e.showValidateErrors(f.errors)||e.refresh("error",f.errors);else if(f.data.redirect)b.shop.trace("$.product.saveData redirect",
f.data.redirect),window.location.href=f.data.redirect;else{e.refresh("success",f.data.message||"");b.shop.trace("$.product.saveData updateData",[a,c]);e.updateData(f.data,a,c);d&&"function"==typeof d&&d();if(e.path.tab&&(f="editTab"+e.path.tab.substr(0,1).toUpperCase()+e.path.tab.substr(1)+"Saved",!1===e.call(f)))return!1;b.each(e.standalone_tabs,function(b,a){e.path.tab!=a&&(b="editTab"+a.substr(0,1).toUpperCase()+a.substr(1)+"Saved",e.call(b))})}e.ajax.save=!1},error:function(b,a,c){e.ajax.save=
!1;e.refresh("error",a)}});return!1},showValidateErrors:function(a){a=a||{};if(b.isEmptyObject(a))return!1;var c=this,d=!1,e=c.$edit_forms;if(a.features&&a.features.gtin){var f=e.find(".s-product-form.features").find('input[name="product[features][gtin]"]');if(f.length){f.addClass("error js-validate-error-input");var g=b('<div class="errormsg js-validate-error-msg"></div>').text(a.features.gtin);f.after(g);d=!0;c.refresh("error",$_("Cannot save the value of the \u201cGTIN\u201d feature for this product."))}}if(a.skus){var h=
e.find(".s-product-form.main table.s-product-skus tbody");b.each(a.skus,function(a,e){"status"===a?(d=!0,c.refresh("error",$_(e))):e.features&&e.features.gtin&&(a=h.find('.js-sku-settings[data-id="'+a+'"]').find('input[name="'+("skus["+a+"][features][gtin]")+'"]'),a.length&&(a.addClass("error js-validate-error-input"),e=b('<div class="errormsg js-validate-error-msg"></div>').text(e.features.gtin),a.after(e),d=!0,c.refresh("error",$_("Cannot save the value of the \u201cGTIN\u201d feature for an SKU of this product."))))})}return d},
clearValidateErrors:function(){var b=this.$edit_forms,c=b.find(".s-product-form.main table.s-product-skus tbody");b=b.find(".s-product-form.features");c.find(".js-validate-error-input").removeClass("error");c.find(".js-validate-error-msg").remove();b.find(".js-validate-error-input").removeClass("error");b.find(".js-validate-error-msg").remove()},updateData:function(a,c,d){b.shop.trace("$.product.updateData("+c+","+d+")",a);var e=b("#s-product-edit-forms .s-product-form.main"),f=this.path.id;if(this.path.id&&
"new"!=this.path.id)this.path.id!=a.id&&b.shop.error("Abnormal product ID change",[this.path.id,a]);else{this.path.id=a.id;b(this.options.container_selector).data("product-id",this.path.id);var g="/product/"+this.path.id+"/";null!==c&&(c=c||this.path.mode||"profile")&&("profile"!=c&&(g+=c+"/"),null!==d&&(d=d||this.path.tab||"")&&"main"!=d.toLowerCase()&&(g+=d+"/"));b.shop.trace("update location.hash="+g);var h=/#\/product\/new\//,k="#/product/"+this.path.id+"/";b("#shop-productprofile, #s-product-edit-menu, #s-product-edit-forms, #s-product-profile-page").find('[href*="#/product/new/"]').each(function(){b(this).attr("href",
b(this).attr("href").replace(h,k))});b("#s-product-edit-forms").find(':input[name="product\\[id\\]"]').val(this.path.id);window.location.hash=g}c=b("#shop-productprofile h1");c.find(".s-product-name:first").text(a.name);c.find(".s-product-id").show().text("id: "+a.id);c=c.find(".s-new-product-editor-button");c.length&&(d=c.attr("href"),0<=d.indexOf("%product_id%")&&c.attr("data-href",c.attr("data-href").replace("%product_id%",a.id)).attr("href",d.replace("%product_id%",a.id)),c.show());document.title=
a.name+b.product.options.title_suffix;b("#product-stock-stat").html(tmpl("template-product-stock-stat",a.raw));e.find(':input[name="product\\[type_id\\]"]').parents(".value").data("type",a.type_id);if(b.isEmptyObject(a.frontend_urls))b(".s-product-frontend-url-not-empty").hide(),b(".s-product-frontend-url-empty").show();else{c=b("#s-product-frontend-url");c.text(a.url);b("#s-product-frontend-url-input").val(a.url);c.trigger("readable");d=c.parent();d.attr("href",a.frontend_urls[0].url);d.find("span:first").text(a.frontend_urls[0].base);
c.closest("div.value").find(".s-product-frontend-url").each(function(c){a.frontend_urls[c+1]&&b(this).attr("href",a.frontend_urls[c+1].url).text(a.frontend_urls[c+1].url)});b(".s-product-frontend-url-not-empty").show();b(".s-product-frontend-url-empty").hide();c="";d=0;for(g=a.frontend_urls.length;d<g;d+=1)c+=' <span class="s-product-frontend-url-not-empty"><a href="'+a.frontend_urls[d].url+'" target="_blank">'+a.frontend_urls[d].url+'</a><i class="icon10 new-window"></i></span> ';c&&b("#s-product-frontend-links").find(".s-product-frontend-url-not-empty").wrapAll("<div></div>").closest("div").replaceWith(c)}this.editTabMainUpdate(a.raw||
{},a.features_selectable_strings,f);e.find("select.s-product-categories").each(function(){var c=b(this),d=c.parent(),e=c.val();if("select"==e||"---"==e){var f=b("#s-product-edit-forms .s-product-form.main select.s-product-categories");1<f.length?d.remove():d.find(".s-product-delete-from-category").hide()}else if("create"==e){var g=d.find("input.val").val();"0"==g?(f=b("#s-product-edit-forms .s-product-form.main select.s-product-categories"),1<f.length?d.remove():(c.val(g),c.show().attr("disabled",
!1),d.find("input.val").attr("disabled",!0),d.find(".s-new-category").hide(),d.find(".s-product-delete-from-category").hide())):(c.val(g),c.show().attr("disabled",!1),d.find("input.val").attr("disabled",!0),d.find(".s-new-category").hide(),d.find(".s-product-delete-from-category").show())}e=parseInt(e,10);if(!b.isEmptyObject(a.storefront_map[e])){c="";e=a.storefront_map[e];for(f=0;f<e.length;f+=1)c+='<a class="hint" href="'+e[f]+'" target="_blank">'+e[f]+"</a> ";d.find(".s-storefront-map").html(c)}});
b("#s-product-categories").html(tmpl("template-product-categories",{categories:a.categories||[]}));b("#s-product-tags").html(tmpl("template-product-tags",{tags:a.tags||[]}));b("#s-product-save table.s-product-skus > tbody > tr").each(function(){var c=b(this).data("id");b(this).find("td.s-stock .s-product-stock-icon").each(function(){var d=b(this).data("stock");a.raw&&a.raw.skus&&a.raw.skus[c]&&a.raw.skus[c].stock_icon[d]&&b(this).html(a.raw.skus[c].stock_icon[d])})});e.find("tr.js-sku-settings").each(function(){var c=
b(this),d=c.attr("data-id");(d=a.raw.skus[d])&&void 0!==d.file_name&&!d.file_name&&(c.find(".s-sku-attachment").hide(),c.find(".fileupload").show())});this.helper.checkChanges(this.get("form"),!0);b("#s-product-edit-menu li a i.icon10.status-yellow-tiny").remove();this.helper.updateSubmitButton(!1);"0"==a.raw.sku_type&&(e=b("#s-product-feature-superposition"),e.find("input[type=checkbox]").attr("checked",!1),f=e.find("ul.features li"),f.find(".count").text(""),f.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass("status-gray-tiny"),
e=e.find(".superposition-count"),e.find(".options").text(""),e.find(".skus").text(""));b("#s-product-meta-title").attr("placeholder",a.default_meta_title);b("#s-product-meta-keywords").attr("placeholder",a.default_meta_keywords);b("#s-product-meta-description").attr("placeholder",a.default_meta_description);b('#s-product-profile-tabs .s-tab-block[data-tab="stock-logs"]').trigger("refresh");this.setData("main","category_name",a.category_name)},refresh:function(a,c){b(this.options.form_selector).find(':input[name^="product\\["]:disabled.js-ajax-disabled').each(function(){b(this).removeAttr("disabled").removeClass("js-ajax-disabled")});
var d=b(this.options.message_selector);d.removeClass("errormsg successmsg status").empty().show();this.timer&&clearTimeout(this.timer);var e=null;d.append(this.message[a]||"");switch(a){case "submit":d.addClass("status");break;case "error":d.addClass("errormsg");for(a=0;a<c.length;a++)d.append(c[a][0]);e=2E4;break;case "success":c&&d.addClass("successmsg").append(c),e=3E3,this.helper.updateSubmitButton(!1)}e&&(this.timer=setTimeout(function(){d.removeClass("errormsg successmsg status").empty().show()},
e))},editTabLoad:function(a,c){var d=this,e=b("#s-product-edit-forms .s-product-form."+a.tab);!0===c||!e.length&&"new"==a.id?(b.shop.trace("product.editTabLoad: create",[a.tab+" \u2014 create",a,c]),this.saveData(this.path.mode,a.tab,function(){a.tab&&d.call(a)})):this.editTabLoadContent(a)},editTabLoadContent:function(a,c){var d=this;a=a||this.path;var e="?module=product&action="+a.tab+"&id="+a.id;a.tail&&(e+="&param[]="+a.tail.split("/").join("&param[]="));var f=Math.random();this.ajax.random=f;
var g=b("#s-product-edit-forms .s-product-form."+a.tab);g.length&&g.remove();b("#s-product-edit-forms > form").append(tmpl("template-productprofile-tab",{id:a.tab}));g=b("#s-product-edit-forms .s-product-form."+a.tab);this.ajax.target=g;this.ajax.link=b("#s-product-edit-menu li."+a.tab);b.shop.trace("$.product.editTabLoadContent",[a,e,a.params]);if(a.params&&c){var h=typeof a.params;switch(h){case "String":e+=a.params;break;case "Array":e+=a.params.serialize();break;default:b.shop.error("unexpected type "+
h,a.params)}}b.ajax({url:e,type:c?"POST":"GET",data:c?c||{}:a.params||{},success:function(c,e){b.shop.trace("$.product.loadTab status="+e);if(d.ajax.random==f){g.empty().append(c);d.ajax.target=null;d.ajax.link=null;c="#/product/"+a.id+"/edit/";a.tab&&(c+=a.tab+"/");a.tail&&(c+=a.tail+"/");if(a.params&&!b.isEmptyObject(a.params)){e=[];for(var h in a.params)a.params.hasOwnProperty(h)&&e.push(h+"="+a.params[h]);c+=e.join("&")}window.location.hash=c;d.dispatch(a)}}})},editTabInit:function(a){b("html, body").animate({scrollTop:0},
200);b("#shop-productprofile").find(".s-product-name").removeClass("editable");this.$edit_forms=b("#s-product-edit-forms")},editTabFocus:function(a){b("#s-product-edit-menu li."+a.tab).addClass("selected");this.refresh()},editTabBlur:function(a){if(a){b("#s-product-edit-forms .s-product-form").hide();b("#s-product-edit-menu li.selected").removeClass("selected");var c=a.tab;if(-1!==this.standalone_tabs.indexOf(c)){var d=this;this.helper.checkChanges(this.get("form"),!0,function(a){a&&(b.shop.trace("$.product.editTabBlur: save standalone tab ["+
c+"]",d.standalone_tabs),d.saveData(d.path.mode,c,function(){c&&d.call(d.path)}))})}this.path.tab=null;this.path.tail=null}},editTabShow:function(a){var c=b("#s-product-edit-forms .s-product-form."+a.tab);c.length?(c.show(),b.shop.trace("$.product.showTab",a),this.path.tab=a.tab):b.shop.error("$.product.showTab",a)},editClick:function(a){var c=a.attr("href").replace(/.*#\/product\/(\d+|new)\/edit\//,"").replace(/\/$/,"").split("/"),d=[];if(c.length){b.shop.trace("$.product.editClick",c);for(var e,
f="editTab";e=c.shift();)if(f+=e.substr(0,1).toUpperCase()+e.substr(1),e="function"==typeof this[f],b.shop.trace("$.settings.featuresClick try",[f,e,c]),!0===e){var g=f;d=c.slice(0)}}if(g){if(b.shop.trace("$.product.editClick",[g,d]),!a.hasClass("js-confirm")||confirm(a.attr("title")||"Are you sure?")){d.push(a);try{this[g].apply(this,d)}catch(h){b.shop.error("Error at method $.product."+g+". Original message: "+h.message,h)}}}else b.shop.error("Not found js handler for link",[g,a]);return!1},switchSubMenu:function(a){a=
a||"default";b("#mainmenu .s-submenu > *").hide();b("#mainmenu .s-submenu .s-submenu-"+a).show()},profileFocus:function(){var a=this.options.duration,c=this;b("#s-product-edit-menu, #s-product-edit-save-panel").hide();c.switchSubMenu();b("#s-sidebar").show().animate({width:b.product.options.sidebar_width});b("#s-toolbar").show().animate({width:"200px"},a).queue(function(){b(this).dequeue();b("#s-product-edit-forms").hide();b("#s-product-profile-page, h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").show();
c.get("container").find(".back").attr("href","#/"+b.products.list_hash)});b("#maincontent").animate({"margin-top":"84px"},a);b("#s-content").animate({"margin-left":b.product.options.sidebar_width},a);b("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return c.editClick(b(this))})},profileAction:function(){this.path.mode="profile"},disableSkus:function(a,c){var d=b(this.options.form_selector).find(".s-sku-list");a?c?d.find(".s-sku-virtual").hide().find(":input").attr("disabled",
!0):d.find(".s-sku-virtual").show().find(":input").attr("disabled",!1):(c?d.hide():d.show(),d.find(":input").attr("disabled",c))},skuTypeFeaturesSelectableLoad:function(a,c){var d=this,e="?module=product&action=featuresSelectable&id="+this.path.id,f={type_id:a,sku_type:1};b("#s-product-feature-superposition-field-group").load(e,f,function(){var b=d.featureSelectableInit();c&&(c.base_price_selectable&&b.find(':input[name="product[base_price_selectable]"]').val(c.base_price_selectable),c.currency&&
b.find("select.s-product-currency").val(c.currency));d.onSkuTypeEnabled(a)})},onSkuTypeEnabled:function(a){var c=b("#s-product-feature-superposition-field-group");a&&c.data("type",a);c.show(400,function(){b.product.checkFeatureValidation()});c.find("input").attr("disabled",!1);"new"==b.product.path.id?b.product.disableSkus(!1,!0):b.product.disableSkus(!0,!1);a=["compare_price","purchase_price"];for(var d,e,f=0;f<a.length;f++)d=c.find(':input[name="product['+a[f]+'_selectable]"]:first'),d.length&&
!parseInt(d.val())&&(e=b(':input[name^="skus"][name$="['+a[f]+']"]:first'),e.length&&d.val(e.val()))},checkFeatureValidation:function(){var a=b("#s-product-feature-superposition-field-group").find("ul.features li"),c=b("#product-save-message");a.find(".status-blue-tiny").length?c.removeClass("errormsg").empty():c.addClass("errormsg").empty().html($_("Select parameters to be available to customers for ordering this product in the storefront.")).show()},onSkuTypeChange:function(a){var c=b("#s-product-feature-superposition-field-group");
b.shop.trace("onSkuTypeChange",{sku_type:a});if("1"==a)if(a=b(this.options.form_selector+' :input[name="product[type_id]"]').val(),c.data("type")!=a)c={base_price_selectable:c.find(':input[name="product[base_price_selectable]"]').val(),currency:c.find("select.s-product-currency").val()},parseInt(c.base_price_selectable)||(c.base_price_selectable=b(':input[name^="skus"][name$="[price]"]:first').val()),b.product.skuTypeFeaturesSelectableLoad(a,c);else b.product.onSkuTypeEnabled();else c.hide(400,function(){b("#product-save-message").removeClass("errormsg").empty()}),
c.find("input").attr("disabled",!0),c=b(this.options.form_selector).find(".s-product-skus"),"new"==b.product.path.id?b.product.disableSkus(!1,!1):(a=c.find("tbody"),b.product.disableSkus(!0,!0),a.find(">tr:not(.s-sku-virtual)").length||(b.product.editTabMainSkuAdd(),a.find(">tr:not(.s-sku-virtual):first").find('input[name="product[sku_id]"]').attr("checked",!0))),c.closest(".field").find(".name").show()},featureSelectableInit:function(){var a=b(this.options.form_selector),c=b("#s-product-feature-superposition"),
d=a.find(".s-product-skus");a=a.find(':input[name="product[base_price_selectable]"]');var e=this;c.on("click","ul.features>li",function(){var a=b(this);a.parent().find("li.selected").removeClass("selected");a.addClass("selected");a=a.attr("data-feature-id");a=c.find(".feature-values[data-feature-id="+a+"]");c.find(".feature-values").hide();a.show();return!1});c.on("change","ul.values>li input",function(){var a=b(this).parents("li:first").parent().find(">li input:checked").length,d=c.find("ul.features li.selected");
d.find(".count").text(a||"");a=a?"status-blue-tiny":"status-gray-tiny";d.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass(a);e.featureSelectableCount(c);b.product.checkFeatureValidation()});b.shop.changeListener(a,function(){d.find(".s-sku-virtual .s-price input").val(b(this).val())});b.shop.changeListener(d,function(){var a=b(this);if("product[sku_id]"!=a.attr("name")&&(a=a.parents("tr:first"),a.length)){var c=parseInt(a.attr("data-id"),10);if(c){if(a.hasClass("js-sku-settings")&&
(a=d.find("tr[data-id="+c+"]:first"),!a.length))return;a.find("input.s-input-virtual").val(0);a.removeClass("s-sku-virtual");b("#s-product-view").find("tr[data-id="+c+"]").removeClass("s-sku-virtual")}}},"input, textarea");c.find("i.status-blue-tiny:first").parents("li").trigger("click");return c},featureSelectableCount:function(a){a||(a=b("#s-product-feature-superposition"));var c=[],d=b("#s-product-edit-forms .s-product-form.features");a.find("ul.features>li").each(function(){var e=b(this),f=parseInt(e.find(".count").text(),
10);f&&c.push(f);if(d.length){var g=d.find('div[data-code="'+e.data("feature-code")+'"] div.value');if(f){e=e.data("feature-id");var h=a.find('div.feature-values[data-feature-id="'+e+'"] ul.values input:checked');g.each(function(){var a=b(this),c=h.filter('[value="'+a.data("value-id")+'"]').length;a.find("input:checkbox").attr("checked",c?"checked":null).attr("disabled","disabled");c?a.show():a.hide()})}else g.show(),g.find("input:checkbox").each(function(b,a){a.checked=a.defaultChecked;a.disabled=
null})}});var e=a.find(".superposition-count");if(c.length){e.find(".options").text($_("Parameters: %s").replace("%s",c.join(" x ")));for(var f=1,g=0,h=c.length;g<h;g+=1)f*=c[g];e.find(".skus").html('<span class="highlighted">'+$_("SKUs: %d").replace("%d",f)+"</span>")}else e.find(".options").text(""),e.find(".skus").html("")},editInit:function(){b("#s-product-edit-forms").unbind("keydown.product").bind("keydown.product",function(a){if(b(a.target).is(":input")&&(a.ctrlKey||a.metaKey)&&83==a.keyCode)return b("#s-product-save-button").click(),
!1});b.shop.makeFlexibleInput("s-product-meta-title");if(!this.options.edit_rights)return window.location.hash="#/product/"+this.path.id+"/",!1;var a=b(this.options.form_selector);a.bind("submit.product",function(a){return b.product.saveData("profile",null)});a.on("change.product, keyup.product","div.s-product-form:not(.ajax) :input",function(a){b.product.helper.onChange(b(this).parents("div.s-product-form"))});a.on("change.product, keyup.product, keypress.product",':input[name="product[name]"]',
function(a){b.product.helper.onNameChange(b(this),!1,b.product.options.update_delay||500)});b.shop.changeListener(a,':input[name="product[url]"]',function(){var a=b(this);b.getJSON("?module=product&action=checkUrlInUse",{id:b.product.path.id,url:a.val()||""},function(a){b.product.informAboutUrlInUse("ok"===a.status&&a.data.url_in_use)})});var c=b("#product-tags");c.data("tags_input_init")||(c.tagsInput({autocomplete_url:"?module=product&action=tagsAutocomplete",height:120,onChange:function(){b.product.updateMetaFields()},
defaultText:""}).data("tags_input_init",!0),b("#s-product-popular-tags").off("click.product","a").on("click.product","a",function(){var a=b(this).text();c.removeTag(a);c.addTag(a)}));a.on("change.product",".s-product-currency",function(){var c=b(this).val();a.find(".s-product-currency").val(c);a.find(".s-product-currency-readonly").text(c);b("#s-product-currency-code").val(c)});a.on("change.product",':input[name="product[type_id]"]',function(){return b.product.editTabMainTypeChange(b(this))});a.on("change",
'select[name="product[status]"]',function(){"1"==b(this).val()?(b(this).prev().removeClass("no-bw").addClass("yes"),b(".s-product-status-text").hide()):(b(this).prev().removeClass("yes").addClass("no-bw"),b(".s-product-status-text").show())});a.on("change",'input[name="product[sku_type]"]',function(){b.product.onSkuTypeChange(this.value)}).change();b.product.featureSelectableInit();b.product.editTabMainTypeChange(b(".js-shop-product-set-type"))},informAboutUrlInUse:function(a){a?b("#s-product-url-in-use-block").show().find(".s-text").html(a):
b("#s-product-url-in-use-block").hide()},editFocus:function(){var a=this.options.duration,c=this;b("h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").hide();b("#s-sidebar, #s-toolbar").animate({width:0},a).queue(function(){b(this).hide();b(this).dequeue();b("#s-product-edit-menu, #s-product-edit-forms, #s-product-edit-save-panel").show();"new"!=c.path.id?c.get("container").find(".back").attr("href","#/product/"+c.path.id+"/"):c.get("container").find(".back").attr("href","#/"+
b.products.list_hash);b("#s-product-profile-page").hide();c.switchSubMenu("productprofile")});b("#maincontent").animate({"margin-top":"40px"},a);b("#s-content").animate({"margin-left":0},a);b("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return c.editClick(b(this))})},editBlur:function(){this.path.tab=!1;this.path.mode=!1;b(b.product.options.form_selector).off("submit.product");b(this.options.form_selector).off("change.product, keyup.product");
b("#s-product-edit-forms").off("click.edit-product")},editAction:function(b){this.path.mode=b.mode},editTabMainData:{sku_id:-1,stocks:{}},editTabMainInit:function(a){b("#s-product-type").each(function(){b(this).parent().get(0)!=document.body&&(b("body > #s-product-type").remove(),b(document.body).append(b(this)))});var c=b("#s-product-edit-forms .s-product-form.main"),d=this,e=c.find("table.s-product-skus:last > tbody");e.sortable({distance:5,helper:"original",items:"> tr",handle:"i.sort",opacity:.75,
tolerance:"pointer",update:function(a,c){a=parseInt(b(c.item).data("id"),10);c=b(c.item).prev().data("id");c=void 0===c?0:parseInt(c,10);d.editTabMainSkuSort(a,c,b(this));c=e.find('> tr.js-sku-settings[data-id="'+a+'"]');c.length&&(c=c.detach(),b.shop.trace("detach",c),c&&(b.shop.trace("detach",e.find('> tr[data-id="'+a+'"]').length),e.find('> tr[data-id="'+a+'"]:first').after(c)))},start:function(b,a){e.find("> tr.js-sku-settings").hide()},stop:function(b,a){e.find("> tr.js-sku-settings").show()}});
var f=b("#s-product-frontend-url");f.inlineEditable({editLink:"#s-product-frontend-url-edit-link",editOnItself:!1,minSize:{height:15,width:100},makeReadableBy:[],beforeMakeEditable:function(a){var c=b(this).closest("span.s-product-frontend-url-not-empty"),d=c.find("span.slash"),e=c.find("i.new-window");b(a).after(d);e.hide();c.find("a.s-frontend-base-url").hide();c.find("span.s-frontend-base-url").show()},beforeBackReadable:function(a,c){a=b(this).closest("span.s-product-frontend-url-not-empty");
c=a.find("span.slash");a.find("i.new-window").show();a.find("span.s-frontend-base-url").hide();a.find("a.s-frontend-base-url").show().append(c)}});parseInt(a.id,10)||f.trigger("editable");"new"==a.id&&b.product_list&&b.isArray(b.product_list.collection_hash)&&("category"==b.product_list.collection_hash[0]?c.find("select.s-product-categories").val(b.product_list.collection_hash[1]):"set"==b.product_list.collection_hash[0]&&c.find(".add-set-button").click().closest(".field").find("select:first").val(b.product_list.collection_hash[1]));
c.off("change.product","select.s-product-categories").on("change.product","select.s-product-categories",function(a){a=b(this);var c=a.val(),d=a.parent(),e=d.find(".s-product-delete-from-category"),f=parseInt(c,10)||0;f?e.show():e.hide();"create"==c?(d.find(".s-new-category").show(),d.find("input.val").attr("disabled",!1),a.hide().attr("disabled",!0).addClass("js-ignore-change")):d.find("input.val").val(f)});c.off("keydown.product","input.new-category").on("keydown.product","input.new-category",function(a){if(13==
a.keyCode)return b(this).parent().find("input[type=button]").click(),!1});c.off("click.product",".s-new-category input[type=button]").on("click.product",".s-new-category input[type=button]",function(a){var c=b(this).parent(),d=c.parent(),e=c.find("input[name=new_category]");a=e.val();b.shop.jsonPost("?module=category&action=save&category_id=0&parent_id=0",{name:a},function(a){var f=d.find("select"),g=f.find("option.separator:first").show();b.when(g.after('<option class="category" value="'+a.data.id+
'">'+a.data.name+"</option>")).then(function(){f.find("option:first").text($_("Please select a category"));f.val(a.data.id).attr("disabled",!1).show().removeClass("js-ignore-change");c.find("input.val").val(a.data.id).attr("disabled",!0);c.hide();d.find(".s-product-delete-from-category").show();e.val("");b.product.helper.onTabChanged("main",{"saving new category":!0});b("#s-category-list>ul").trigger("add",[a.data,"category"])})})});c.off("click.product",".s-product-delete-from-category").on("click.product",
".s-product-delete-from-category",function(){var a=b(this),c=a.parent("div"),d=c.find("select");if(d.length)if(2<b("#s-product-edit-forms .s-product-form.main select.s-product-categories").length){d.attr("disabled",!0);var e=c.parents("div.field:first").find('input[name="product[categories.deleted]"]');if(0<parseInt(d.val())){var f=e.val().split(",");f.push(d.val());f.sort();e.val(f.join(","));b.product.helper.onChange(b.product.get("form").find("div.main:first"))}c.remove()}else d.val("selected").attr("disabled",
!1),c.find("input.val").val(0).attr("disabled",!0).parent().hide(),c.find(".s-storefront-map").html(""),c.find(".s-product-delete-from-category").hide();else e=c.parents("div.field:first").find('input[name="product[categories.deleted]"]'),d=a.parents(".value:first").find(":input:first"),0<parseInt(d.val())&&(f=e.val().split(","),f.push(d.val()),f.sort(),e.val(f.join(",")),b.product.helper.onChange(b.product.get("form").find("div.main:first"))),a.parents(".value:first").remove();return!1})},editTabMainAction:function(a){var c=
!1,d=null;a&&a.params&&a.params.focus?(d=a.params.name||"",!d.length&&a.params.sku&&(d="product[skus]["+parseInt(a.params.sku,10)+"]",a.params.focus&&(d+="["+a.params.focus+"]"),"stock"==a.params.focus&&(d+="["+(parseInt(a.params.stock,10)||0)+"]")),c=':input[name$="'+d.replace(/(\[|\]|\|\-)/g,"\\$1")+'"]:first'):a&&"new"==a.id&&(c=':input[name$="[name]"]:first');c&&(b.shop.trace("$.product.editTabMainFocus",[d,b(c).length]),setTimeout(function(){b(c).focus();window.location.hash="#/product/"+a.raw.replace(/\/focus=.*$/,
"/")},100))},editTabMainBlur:function(){},editTabMainSave:function(){if(!1===this.call("editTabMainSkuEproductSave"))return!1},helper:{options:{tab_changed:'<i class="icon10 status-yellow-tiny"></i>',defaultChangedStatus:!1},data:{url_helper:{url:"",name:"",timer:null}},init:function(){this.data.url_helper={url:"",name:"",timer:null}},onTabChanged:function(a,c){b.shop.trace("$.product.onTabChanged id="+a+" changed="+!!c,c);b("#s-product-edit-menu li."+a+" .s-product-edit-tab-status").html(c?this.options.tab_changed:
"");c&&this.updateSubmitButton(!0)},type:function(a){return parseInt(a,10)||parseInt(b('#s-product-edit-forms .s-product-form.main :input[name="product\\[type_id\\]"]').val(),10)||0},onNameChange:function(a,c,d){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var e=b(b.product.options.form_selector).find(':input[name="product\\[url\\]"]'),f=e.parent();if(b.product.path.id&&"new"!=b.product.path.id||e.val()!=this.data.url_helper.url)b.shop.trace("$.product.onNameChange stop "+
this.data.url_helper.url+" != "+e.val()),b(b.product.options.form_selector).off(".product",':input[name="product\\[name\\]"]'),f.find(".js-url-helper").hide();else{c&&(f.find(".js-url-helper").length?f.find(".js-url-helper").show():f.append('<i class="icon16 loading js-url-helper"></i>'));var g=this;this.data.url_helper.timer=setTimeout(function(){g.urlHelper(a,e,d)},d||500)}},onChange:function(b){var a=this.getContainerId(b),d=this;this.checkChanges(b.parents("form"),!1,function(c){d.updateSubmitButton(c);
if(c)d.checkChanges(b,!1,function(b){d.onTabChanged(a,b)});else d.onTabChanged(a,c)})},urlHelper:function(a,c){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);a={name:b(a).val()};b.shop.trace("$.product.urlHelper ",a);if(a.url!=this.data.url_helper.name){var d=this;this.data.url_helper.url=a.url;b.getJSON("?module=product&action=suggestUrl",a,function(a){"ok"===a.status&&(d.data.url_helper.url=a.data.url,c.val(a.data.url),c.parent().find(".js-url-helper").hide(),b.product.informAboutUrlInUse(a.data.in_use))})}else c.parent().find(".js-url-helper").hide()},
getValueByName:function(a,c){for(var d=a,e=c.replace(/\]/,"").split("[");e.shift();)if(void 0!==d[c])d=d[c];else{d="";break}b.shop.trace("$.product.helper.getValueByName",[d,c,a]);return d},checkChangesStack:{},checkChanges:function(a,c,d){var e=a.attr("id");this.checkChangesStack[e]&&(clearTimeout(this.checkChangesStack[e]),this.checkChangesStack[e]=null);var f=this;this.checkChangesStack[e]=setTimeout(function(){var g=f.checkChangesDelayed(a,c);b.shop.trace("$.product.helper.checkChanges["+e+"]",
[a,c,g,d?"callback":"none"]);d&&d(g)},c?50:500)},checkChangesDelayed:function(a,c){var d=this.options.defaultChangedStatus,e=this,f=":input:not(.js-ignore-change)";if(a.hasClass("s-product-form")){if(a.hasClass("ajax"))return!1}else a.hasClass("s-product-form-chunk")||(f=".s-product-form:not(.ajax) "+f);a.find(f).each(function(){var f=b(this),h=(f.attr("type")||this.tagName).toLowerCase();switch(h){case "input":case "text":case "textarea":if(f.hasClass("ace_text-input"))break;this.defaultValue!=this.value&&
(d=!0,c&&(this.defaultValue=this.value,e.updateInput(this.name,this.value,"textarea"==h)));break;case "radio":case "checkbox":this.defaultChecked!=this.checked&&(d=!0,c&&(this.defaultChecked=this.checked));break;case "select":this.length&&b(this).find("option").each(function(){this.defaultSelected!=this.selected&&(d=!0,c&&(this.defaultSelected=this.selected))});break;case "file":this.value&&(d=!0,c&&(this.value=null));break;case "reset":case "button":case "submit":break;case "hidden":f.hasClass("js-check-change")&&
void 0!==f.attr("data-value")&&(defaultValue=f.attr("data-value"),this.disabled?c&&(h=b.shop.helper.escape(this.name),h=a.find(':input[name="'+h+'"]:enabled'),h.length&&f.attr("data-value",h.val())):defaultValue!=this.value&&(d=!0,c&&f.attr("data-value",this.value)));break;default:b.shop.error("$.product.checkChangesDelayed unsupported type "+h,[h,this])}!c&&d&&(b.shop.trace("$.product.helper.checkChangesDelayed",[this,d,this.defaultValue,this.value]),d=f);return c||!d});return d},getContainerId:function(a){a=
(b(a).attr("class")||"").split(" ");var c=!1,d;for(d in a)if("s-product-form"!=a[d]){c=a[d];break}return c},updateInput:function(a,c,d,e){if(a){var f=".s-"+a.replace(/\[(.+?)\]/g,"-$1")+"-input";b.shop.trace("update field: "+a+" "+f,c);var g=b(f);g.is("input,textarea")?g.val(c):d?"product[summary]"===a?g.text(c):g.html(c):g.text(c);e&&(a=b(f).attr("name"),a=a.replaceAll(/\[-[\d]+\]/,"["+e+"]"),b.shop.trace("$.product.helper.updateInput name",[a]))}},updateSubmitButton:function(a){b("#s-product-edit-save-panel :submit").removeClass(a?
"green":"yellow").addClass(a?"yellow":"green")},count:function(b){var a=0,d;for(d in b)b.hasOwnProperty(d)&&a++;return a}},multiSkus:function(a,c){c="boolean"===typeof c?c:!0;var d=b("#s-product-edit-forms .s-product-form.main table.s-product-skus:first");1<a?(d.find("thead tr th.s-sku-sort").show(),d.find(".s-name,.s-sku-sort").show("slow"),d.find(".delete").parent("a").show(),c&&(2===a?d.find("> tbody:first > tr:first .s-name :input").focus():d.find("> tbody:first > tr:last .s-name :input").focus())):
(d.find("thead tr th.s-sku-sort").hide(),d.find(".s-name,.s-sku-sort").hide(),d.find(".delete").parent("a").hide(),d.find(".s-sku-big").removeClass("s-sku-big"))},editTabMainSkuAdd:function(){try{var a=b("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),c=0,d="0";a.find(':input[name$="[price]"]').each(function(){var a=b(this),e=a.val()?a.val().replace(",","."):0;e=parseFloat(e);e>c&&(c=e,d=a.val()||"0")});var e=0;a.find(':input[name$="[purchase_price]"]').each(function(){e=
Math.max(e,parseFloat(b(this).val())||0)});b.product.multiSkus(a.find("tr:not(.js-sku-settings)").length+1);var f={id:--b.product.editTabMainData.sku_id,product_id:b('input:hidden[name="product[id]"]').val()||"new",sku:"",available:1,status:1,name:"",price:""+c,price_loc:d,purchase_price:""+e,stock_icon:{0:"<i class='icon10 status-green' ></i>"},stock:{},count:null};b.shop.trace("$.product.editTabMainSkuAdd",[b.product.editTabMainData.sku_id,f]);a.append(tmpl("template-sku-edit",{sku_id:b.product.editTabMainData.sku_id,
sku:f,stocks:this.getData("main","stocks"),stock_ids:this.getData("main","stock_ids")},!0));a.find(".s-product-currency").trigger("change");a.find("td.s-sku").addClass("s-sku-big")}catch(g){b.shop.error(g.message,g)}return!1},editTabMainSkuSort:function(a,c,d){try{b.post("?module=product&action=skuSort",{product_id:this.path.id,sku_id:a,after_id:c},function(a){b.shop.trace("$.product.editTabMainSkuSort result",a);a.error&&(b.shop.error("Error occurred while sorting product SKUs","error"),d.sortable("cancel"))},
function(a){b.shop.trace("$.product.editTabMainSkuSort cancel",{data:a});d.sortable("cancel");b.shop.error("Error occurred while sorting product SKUs","error")})}catch(e){b.shop.error(e.message,e)}return!1},editTabMainProductDelete:function(a){a=b("#s-product-list-delete-products-dialog");var c=a.parent();a.length||(c=b("<div></div>").appendTo("body"));c.load("?module=dialog&action=productsDelete",{product_id:[b.product.path.id]},function(){b("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){b(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(a){b(this).find(".dialog-buttons i.loading").show();b.shop.jsonPost("?module=products&action=deleteList",{product_id:[b.product.path.id],get_lists:1},function(c){b.product_list&&b("#s-sidebar").trigger("update",c.data.lists);a.trigger("close");window.location.hash="#/products/"});return!1}})});return!1},editTabMainSkuDelete:function(a,c){var d=b("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),
e=c.parents("tbody").find('> tr[data-id="'+a+'"]'),f=this;if(0<a){var g=c.parents("tbody").find('tr[data-id]:not(.js-sku-settings):not([data-id^="-"])').length;c=c.parents("tbody").find("tr[data-id]:not(.js-sku-settings)").length;1<g?b.ajax({url:"?module=product&action=skuDelete",data:{sku_id:a,product_id:this.path.id},dataType:"json",type:"post",success:function(c){"fail"==c.status?f.refresh("error",c.errors):c.data.redirect?window.location.href=c.data.redirect:(f.refresh("success",c.data.message||
"Success"),e.hide("normal",function(){e.remove();b('#s-product-view table.s-product-skus > tbody > tr[data-id="'+a+'"]').remove();b.product.multiSkus(d.find("tr:not(.js-sku-settings)").length,!1)}),b("#s-product-edit-forms .s-product-form.main").find("input[name=product\\[sku_id\\]][value="+c.data.sku_id+"]").attr("checked",!0))},error:function(b,a,c){f.refresh("error",a)}}):1<c?(e.after('<input type="hidden" name="skus['+a+']" value="%deleted%">'),e.hide("normal",function(){e.remove();b('#s-product-view table.s-product-skus > tbody >tr[data-id="'+
a+'"]').remove();b.product.multiSkus(d.find("tr:not(.js-sku-settings)").length,!1)})):f.refresh("error",$_("A product must have at least one SKU."))}else e.hide("normal",function(){e.remove();b('#s-product-view table.s-product-skus > tbody >tr[data-id="'+a+'"]').remove();b.product.multiSkus(d.find("tr:not(.js-sku-settings)").length,!1)})},editTabMainCategoriesAdd:function(){var a=b("#s-product-edit-forms .s-product-form.main select.s-product-categories:last").parent("div"),c=a.clone(!1);c.find("select").val("select").attr("disabled",
!1).show();c.find("input.val").val(0).attr("disabled",!0).parent().hide();c.find(".s-product-delete-from-category").hide();c.find(".s-storefront-map").html("");c.show();a.after(c)},editTabMainSkuStock:function(a,c){c=b("#s-product-sku-"+a);c.hide().find(":input:enabled").attr("disabled",!0);a=b("#s-product-sku-stock-"+a);a.show().find(":input:disabled").removeAttr("disabled");a.find(":input:first").val(c.find(":input:first").val())},editTabMainSkuSettings:function(a,c){c.hide();var d=c.parents("tr");
c=d.data();var e=this;b.when(d.after(tmpl("template-sku-settings",{sku_id:a,sku:c}))).done(function(){var c="?module=product&action=skuSettings&product_id="+e.path.id;c+="&sku_id="+a;c+="&type_id="+e.helper.type();var g=b('#s-product-edit-forms .s-product-form.main tr.js-sku-settings[data-id="'+a+'"] > td:first');g.load(c,function(){d.find(':input[name$="[available]"], :input[name$="[status]"]').remove();b.product_images&&b.product_images.options&&b.product_images.options.enable_2x&&b.fn.retina&&
g.find(".s-product-image-crops img").retina();b.product.initFeatureDate();if(0<a){b.shop.trace("fileupload",[g.find(".fileupload").length,typeof g.find(".fileupload").fileupload]);try{var c=document.cookie.match(/(?:^|; )_csrf=([^;]*)/),e=c?decodeURIComponent(c[1]):"";g.find(".fileupload:first").fileupload({dropZone:null,url:"?module=product&action=skuEproductUpload",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,start:function(){g.find(".fileupload:first").hide()},progress:function(a,c){b.shop.trace("fileupload progress",
c);a=g.find(".js-progressbar-container");a.show();a.find(".progressbar-inner:first").css("width",Math.round(100*c.loaded/c.total,0)+"%")},done:function(a,c){b.shop.trace("fileupload done",[c.result,typeof c.result]);a=(c.result.files||[]).shift();g.find(".js-progressbar-container").hide();!a||a.error?(g.find(".error-message").text(a.error).show(),g.find(".fileupload:first").addClass("error").show()):(c=g.find(".s-sku-attachment"),c.find("input.s-input-file-name").val(a.name),c.find(".s-file-name").text(a.name),
c.find(".s-file-size").text(a.size),c.find(".s-file-description").val(""),c.find("input[type=checkbox]").attr("checked",!0),c.show(),d.find("input.s-input-virtual").val(0))},fail:function(a,c){b.shop.trace("fileupload fail",[c.textStatus,c.errorThrown]);g.find(".error-message").text("error").show().text(c.errorThrown||"error");g.find(".js-progressbar-container").hide();g.find(".fileupload:first").addClass("error").show()},formData:{product_id:b.product.path.id,sku_id:a,_csrf:e}})}catch(l){b.shop.error("Exception "+
l.message,l)}}})})},editTabMainSkuImageSelect:function(a,c,d){a=d.parents("li:first");var e=a.hasClass("selected"),f=d.parents("div.value:first");f.find("ul.s-product-image-crops li.selected").removeClass("selected");e?f.find('input[name$="[image_id]"]').val(0):(a.addClass("selected"),f.find('input[name$="[image_id]"]').val(c));b.shop.trace("$.product.editTabMainSkuImageSelect",[f,f.find(':input[name$="[image_id]"]')]);b.product.helper.onChange(d.parents("div.s-product-form"))},editTabMainSkuEproductSave:function(a){a=
b("#s-product-edit-forms .s-product-form.main tr.js-sku-settings"+(a&&0<a?'[data-id="'+a+'"]':"")+" > td:first .fileupload");b.shop.trace("$.product.editTabMainSkuEproductSave",a.length);a.length&&a.fileupload("start")},editTabMainSkuEproductDelete:function(b){},editTabMainLinkEdit:function(b){return!1},editTabMainTypeSelect:function(b){var a=b.parents("form").find(':input[name="product[type_id]"]').parents(".value");"main"==this.path.tab?b.hide():(a.find(".js-action").hide(),window.location.hash=
"/product/"+this.path.id+"/"+this.path.mode+"/");a.find(".js-type-name").hide();a.find(":input").show().focus();setTimeout(function(){a.find(":input").focus()},100)},editTabMainTypeChange:function(a){var c=a.parents(".value"),d=a.find(":selected:first"),e=d.val();a=parseInt(d.data("sku-type"));c.find(".js-type-icon").html(d.data("icon"));c.find(".js-type-name").text(d.text());e!=c.data("type")?b("#s-product-edit-forms .s-product-form.features").length&&"undefined"!=typeof this.editTabFeaturesReload?
this.editTabFeaturesReload(e):(c=b("#s-product-edit-menu > li.features > a"),e="/features/"+e+"/",c.attr("href",c.attr("href").replace(/\/features\/.*$/,e))):(c=b("#s-product-edit-menu > li.features > a"),e="/features/",c.attr("href",c.attr("href").replace(/\/features\/.*$/,e)));c=b(this.options.form_selector+' :input[name="product[sku_type]"]');b.shop.trace("sku_type",[a,c]);c.filter('[value="1"]').trigger("disabled",[a?null:!0]);e=c.parents("ul");a?(c.filter(":checked").change(),e.find('[data-sku-type="1"]').hide()):
(c.filter('[value="0"]').trigger("checked",!0).change(),e.find('[data-sku-type="1"]').show())},editTabMainUpdate:function(a,c,d){var e=b("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody"),f=b("#s-product-view table.s-product-skus tbody");e.find('tr[data-id^="-"]').remove();f.find('tr[data-id^="-"]').remove();e.parents("table").find("tr:hidden").show();var g=[];for(h in a.skus||{})g.push(b.extend({id:h},a.skus[h]));g=g.sort(function(b,a){return b.sort-a.sort});var h=this.getData("main",
"stocks");var k=this.getData("main","stock_ids"),l="";tmpl.cache["template-sku-edit"]=tmpl(tmpl.load("template-sku-edit"));for(var n=0,p=g.length;n<p;n+=1)l+=tmpl("template-sku-edit",{sku_id:g[n].id,sku:g[n],hide_sort_column:1>=p,stocks:h,stock_ids:k,checked:g[n].id==a.sku_id});e.html(l);e.find("select.s-product-currency").val(a.currency);e.parent().show();e.closest(".s-sku-list").show();this.multiSkus(e.find("tr:not(.js-sku-settings)").length);l="";n=0;for(p=g.length;n<p;n+=1)l+=tmpl("template-sku",
{sku_id:g[n].id,sku:g[n],stocks:h,stock_ids:k,runout:a.runout||{}});f.html(l);d&&"new"!=d||e.parents("div.field-group:first").after(b("#s-sku-type-field-group"));c&&(d=b("#s-product-feature-superposition .superposition-count"),d.find(".options").text(c.options),d.find(".skus").html('<span class="highlighted">'+c.skus+"</span>"));var t=/#\/product\/new\//,m="#/product/"+a.id+"/";b("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody, #s-product-view table.s-product-skus tbody").find('[href*="#/product/new/"]').each(function(){b(this).attr("href",
b(this).attr("href").replace(t,m))})},editTabDescriptionsBlur:function(){var a=b("#s-product-description-content");a.length&&a.data("redactor")&&a.waEditor("sync")},editTabDescriptionsAction:function(){var a=b("#s-product-description-content");if(a.length&&!a.data("redactor")){var c=a.parents("div.s-product-form");a.waEditor({lang:wa_lang,modification_wysiwyg_msg:a.data("modification-wysiwyg-msg"),toolbarFixedTopOffset:b("#mainmenu").length?b("#mainmenu").height():0,imageUploadFields:a.data("uploadFields"),
saveButton:b("#s-product-save-button"),callbacks:{change:function(){a.length&&(a.waEditor("sync"),b.product.helper.onChange(c))},keydown:function(a){if("115"!=a.which&&"83"!=a.which||!a.ctrlKey&&!a.metaKey)b.product.helper.onChange(c);else return a.preventDefault(),b("#s-product-save-button").click(),!1}}})}},profileInit:function(){void 0!==b.product_list&&void 0!==b.product_list.fixed_blocks&&(b.product_list.fixed_blocks.set&&b.product_list.fixed_blocks.set.unsetFixed(),b.product_list.fixed_blocks.category&&
b.product_list.fixed_blocks.category.unsetFixed());if(this.options.edit_rights){var a=b("#shop-productprofile").find(".s-product-name");parseInt(this.path.id,10)?a.addClass("editable"):a.removeClass("editable");var c=this.get("form");a.inlineEditable({minSize:{width:150},maxSize:{width:550},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){b("#s-edit-product").hide()},afterBackReadable:function(a,e){b("#s-edit-product").show();if(!e.changed)return!1;b.shop.jsonPost("?module=product&action=save&id="+
b.product.path.id,{update:{name:b(a).val()}},function(d){var e=b(a).val();document.title=e+b.product.options.title_suffix;"ok"===d.status&&d.data&&b("#s-product-meta-title").attr("placeholder",d.data.default_meta_title);c.find('input[name="product[name]"]').val(e)})},hold:function(){return!b(this).hasClass("editable")}})}this.call("profileLazyInit",[])},profileLazyInit:function(){var a=b("#product-sales-plot");if(window.sales_data&&sales_data.length){if(!a.data("graph_rendered")){var c=function(){a.length&&
0<a.width()?(showSalesGraph(sales_data,"undefined"==typeof cash_type?null:cash_type),a.data("graph_rendered",1)):setTimeout(c,1E3)};c()}}else a.remove();if(sku_plot_data&&sku_plot_data.length&&sku_plot_data[0]&&sku_plot_data[0].length){if(!b("#product-sku-plot").data("graph_rendered")){var d=[];b.each(sku_plot_data[0],function(b,a){d.push({label:a[0],value:a[1]})});showPieGraph(d,{color_type:"products"});b("#product-sku-plot").data("graph_rendered",1)}}else b("#product-sku-plot").remove()},updateMetaFields:function(){var a=
b(".s-product-name-input").val();b("#s-product-meta-title").attr("placeholder",a);var c=[a],d=5;b(".s-sku-name-input").each(function(){if(0>=d)return!1;var a=b.trim(b(this).val());a&&c.push(a);--d});a=this.getData("main","category_name");null!==a&&c.push(a);a=b("#product-tags").val().split(",");d=5;for(var e=0;e<a.length&&!(0>=d);e+=1){var f=b.trim(a[e]);f&&c.push(f);--d}b("#s-product-meta-keywords").attr("placeholder",c.join(", "));b("#s-product-meta-description").attr("placeholder",b("#s-product-summary").val())},
getId:function(){return this.path.id}}})(jQuery);(function(b){b.fn.rateWidget=function(a,c,d){function e(a){var c=0;this.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){if(c==a)return!1;c++;b(this).removeClass("star-empty").addClass("star")});this.attr("data-rate",a)}function f(b){return function(){return b}}var g=!!("ontouchstart"in window||navigator.msMaxTouchPoints),h=this;if(this&&this.length){if("string"==typeof a){if("getOption"==a&&"rate"==c)return parseInt(this.attr("data-rate"),10);if("setOption"==a&&("rate"==
c&&(e.call(this,parseInt(d,10)),c={rate:d}),"object"===typeof c&&c)){var k=this.data("rateWidgetSettings")||{};b.extend(k,c);"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(k.hold=f(k.hold))}return this}this.data("rateWidgetSettings",b.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0},a||{}));if(!this.data("inited"))return k=this.data("rateWidgetSettings"),"function"!==typeof k.hold&&(k.hold=f(k.hold)),function(){h.attr("id")||h.attr("id",(""+Math.random()).substr(2));
null!==k.rate&&h.attr("data-rate",k.rate);h.find("i:lt("+h.attr("data-rate")+")").removeClass("star-empty").addClass("star");g||h.mouseover(function(a){k.hold.call(h)||(a=a.target,"I"==a.tagName&&(a=b(a),a.prevAll().removeClass("star star-empty").addClass("star-hover").end().removeClass("star star-empty").addClass("star-hover"),a.nextAll().removeClass("star star-hover").addClass("star-empty")))}).mouseleave(function(){k.hold.call(h)||e.call(h,h.attr("data-rate"))});h.click(function(a){if(!k.hold.call(h)){for(var c=
a.target;"I"!=c.tagName;)if(c==this)return;var d=h.attr("data-rate"),e=0;h.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){e++;b(this).removeClass("star-empty").addClass("star");if(this==c)return d!=e&&(h.attr("data-rate",e),k.onUpdate(e)),!1});return!1}});if(k.withClearAction){var a="clear-"+b(this).attr("id"),c=b("#"+a);c.length||(h.after('<a href="javascript:void(0);" class="inline-link rate-clear" id="'+a+'" style="display:none;"><b><i>'+$_("clear")+"</b></i></a>"),
c=b("#"+a));c.click(function(){if(!k.hold.call(h)){var b=h.attr("data-rate");e.call(h,0);if(0!==b)k.onUpdate(0)}});var d;h.parent().mousemove(function(){k.hold.call(h)||(d&&clearTimeout(d),c.show(0))}).mouseleave(function(){d=setTimeout(function(){k.hold.call(h)||c.hide(0)},150)})}this.unbind("clear").bind("clear",function(){e.call(h,0)});this.data("inited",!0);h[0].addEventListener("touchend",function(a){b(a.target).trigger("click")},!1)}.call(this),this}}})(jQuery);(function(b){b.product_reviews={container:null,sidebar_counter:null,statuses:{},form:null,hotkeys:{"alt+enter":{ctrl:!1,alt:!0,shift:!1,key:13},"ctrl+enter":{ctrl:!0,alt:!1,shift:!1,key:13},"ctrl+s":{ctrl:!0,alt:!1,shift:!1,key:17}},options:{},init:function(a){this.options=a;this.statuses=a.statuses;a.product_id&&(this.product_id=a.product_id);this.form=b("#s-review-add-form");this.sidebar_counter=b("#s-all-reviews").find(".count");a.container&&(this.container="object"===typeof a.container?a.container:
b(a.container),this.container.find(".s-reviews").off("click",".s-review-reply, .s-review-delete, .s-review-restore, .js-review-publish").on("click",".s-review-reply, .s-review-delete, .s-review-restore, .js-review-publish",function(){var c=b(this),e=c.parents("li:first");e=parseInt(e.attr("data-id"),10)||0;if(c.hasClass("s-review-reply")){if("ignore"===b.product_reviews.options.reply)return;b.product_reviews.prepareAddingForm.call(c,b.product_reviews.form,e)}else c.hasClass("s-review-delete")?b.product_reviews.deleteReview(e,
a.afterDelete):c.hasClass("s-review-restore")?b.product_reviews.restoreReview(e,a.afterRestore):c.hasClass("js-review-publish")&&b.product_reviews.publishReview(e);return!1}));this.product_id&&this.container.addClass("ajax");var c=function(){b.product_reviews.addReview("backend",a.afterAdd)};this.addHotkeyHandler("textarea","ctrl+enter",c);this.form.find("input.save").unbind("click").bind("click",c);this.initView();this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);b.product&&
(b.product.editTabReviewsAction=function(a){a.tail&&setTimeout(function(){b.product_reviews.activeReplyToForm(a.tail)},200)})},activeReplyToForm:function(a){var c=this.container.find(".s-reviews li[data-id="+a+"]");if(c.length){var d=c.find(".s-review-reply:first");this.prepareAddingForm.call(d,this.form,a);b(document).scrollTop(c.offset().top)}},initView:function(){if("reviews"==b.products.hash.substr(0,7)){var a=b("#s-sidebar");a.find("li.selected").removeClass("selected");a.find("#s-all-reviews").addClass("selected")}},
initReview:function(a){function c(a){return b("<div />").text(a).html()}var d=b(document),e=a.$wrapper,f=e.data("id"),g=a.locales,h=a.urls,k=!1;e.on("click",".js-show-image",function(a){a.preventDefault();a=b(this);var f=[];e.find(".js-show-image").each(function(){var a=b(this);f.push({href:a.attr("href"),title:c(a.attr("title"))})});(a=a.closest(".s-image-wrapper").prevAll(".s-image-wrapper").length)&&(f=f.slice(a).concat(f.slice(0,a)));b.swipebox(f,{useSVG:!1,hideBarsDelay:!1,afterOpen:function(){function a(){var c=
b("#swipebox-close");c.length&&c.trigger("click");d.off("scroll",a)}d.on("scroll",a)}})});e.on("click",".js-delete-image",function(a){a.preventDefault();var c=b(this).closest(".s-image-wrapper");a=c.data("image-id");!k&&confirm(g.confirm)&&(k=!0,b.post(h["delete"],{review_id:f,image_id:a},"json").always(function(){k=!1}).done(function(){c.remove()}))})},initLazyLoad:function(a){var c=a.count,d=a.total_count,e=a.url||"?module=reviews",f=b(a.target||".s-reviews:first ul:first");b(window).lazyLoad("stop");
c<d&&(b(window).lazyLoad({container:f,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",load:function(){b(window).lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();b.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(a){a=b("<div></div>").html(a);var e=a.find(".s-reviews").children();c+=e.length;f.append(e);b(".lazyloading-progress-string").replaceWith(a.find(".lazyloading-progress-string"));b(".lazyloading-progress").replaceWith(a.find(".lazyloading-progress"));
c>=d?(b(window).lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),b(window).lazyLoad("wake"));a.remove()},"html")}}),b(".lazyloading-link").unbind("click").bind("click",function(){b(window).lazyLoad("force");return!1}))},prepareAddingForm:function(a,c){if(c)this.after(a),a.find(".rate a:first").hide();else{var d=b("#s-review-add li:first");d.find("form").length||d.append(a);a.find(".rate a:first").show()}b.product_reviews.clear(!1);b("input[name=parent_id]",a).val(c)},
addHotkeyHandler:function(b,c,d){var a=this.hotkeys[c];this.form.off("keydown",b).on("keydown",b,function(b){if(b.keyCode==a.key&&b.altKey==a.alt&&b.ctrlKey==a.ctrl&&b.shiftKey==a.shift)return d()})},addReview:function(a,c){var d=this.sidebar_counter;b.post("backend"!=a&&a?"#":"?module=reviews&action=add",b.product_reviews.form.serialize(),function(a){if("fail"==a.status)b.product_reviews.clear(!1),b.product_reviews.showErrors(a.errors);else if("ok"==a.status&&a.data.html){var e=b("input[name=parent_id]",
b.product_reviews.form),g=b.product_reviews.form.parents(".s-review:first").parent("li"),h=a.data.html,k=b("ul:first",g),l=b.product_reviews.container;g.length||(l.show(),k=b("ul:first",l).show());k.length||(k=b('<ul class="menu-v with-icon"></ul>'),g.append(k));k.append(b('<li data-id="'+a.data.id+'" data-parent-id="'+a.data.parent_id+'"></li>').append(h));b("textarea",b.product_reviews.form).val("");g=b("#s-review-add");g.find("form").length||(g.append(b.product_reviews.form),e.val(0));d.length&&
d.text(parseInt(d.text(),10)+1);"function"===typeof c&&c(a);b.product_reviews.clear()}else console&&console.log("Error occured.")},"json").error(function(b){console&&console.log(b.responseText?"Error occured: "+b.responseText:"Error occured.")})},deleteReview:function(a,c){var d=this.container,e=this.sidebar_counter;b.post("?module=reviews&action=changeStatus",{review_id:a,status:this.statuses.deleted},function(b){if("ok"==b.status){var f=d.find("li[data-id="+a+"]").find("div:first");f.removeClass("is-published").removeClass("is-unpublished").addClass("is-deleted");
f.find(".s-review-delete").hide();f.find(".s-review-restore").show();e.length&&e.text(parseInt(e.text(),10)-1);"function"===typeof c&&c(b)}},"json")},restoreReview:function(a){var c=this.container,d=this.sidebar_counter;b.post("?module=reviews&action=changeStatus",{review_id:a,status:this.statuses.published},function(b){"ok"==b.status&&(b=c.find("li[data-id="+a+"]").find("div:first"),b.addClass("is-published").removeClass("is-unpublished").removeClass("is-deleted"),b.find(".s-review-delete").show(),
b.find(".s-review-restore").hide(),d.length&&d.text(parseInt(d.text(),10)+1),"function"===typeof success&&success())},"json")},publishReview:function(a){var c=this.container,d=this.sidebar_counter;b.post("?module=reviews&action=changeStatus",{review_id:a,status:this.statuses.published},function(b){"ok"==b.status&&(b=c.find("li[data-id="+a+"]").find("div:first"),b.addClass("is-published").removeClass("is-unpublished").removeClass("is-deleted"),b.find(".s-review-delete").show(),b.find(".js-review-publish").remove(),
d.length&&d.text(parseInt(d.text(),10)+1),"function"===typeof success&&success())},"json")},clear:function(a){a="undefined"===typeof a?!0:a;b(".errormsg",this.form).remove();b(".error",this.form).removeClass("error");b(".wa-captcha-refresh",this.form).click();a&&(b("input[name=captcha], textarea",this.form).val(""),b("input[name=rate]",this.form).val(0),b(".rate a:first",this.form).trigger("clear"))},showErrors:function(a){for(var c=0,d=a.length,e=a[c];c<d;e=a[++c])for(var f in e)b("[name="+f+"]",
this.form).after(b('<em class="errormsg"></em>').text(e[f])).addClass("error")}}})(jQuery);(function(b){b.product_images={product_id:0,image:null,product_image:null,image_list:null,photo_stream:null,tail:null,options:{},init:function(a){this.options=a;this.product_id=a.product_id||0;this.image=a.image||null;this.options.placeholder=this.options.placeholder||null;var c=b("#s-product-edit-menu .images");this.image?setTimeout(function(){b.product_images.initImage()},200):this.initImageList(a);c.find(".hint").text(a.count||a.images&&a.images.length||0);b("#s-product-edit-forms .s-product-form.images").addClass("ajax");
b.product.editTabImagesAction=function(a){if(null!==b.product_images.tail){var c="?module=product&action=images&id="+a.id;if(a.tail&&(c+="&param[]="+a.tail,b.product_images.photo_stream&&b.product_images.photo_stream.length)){var d=b.product_images.photo_stream.find(".s-stream-wrapper>ul");c+="&ps[left]="+parseInt(d.css("left"),10);c+="&ps[width]="+parseInt(d.css("width"),10)}b.get(c,function(a){b("#s-product-edit-forms .s-product-form.images").html(a)})}b.product_images.tail=a.tail};b.product.editTabImagesBlur=
function(a){b("#fileupload").fileupload("destroy")};var d=b("#s-product-set-custom-badge");b(".s-product-images-actions").off("click","li").on("click","li",function(){var a=b(this),c=a.attr("data-action");switch(c){case "set-badge":b.product_images.setBadge(a.attr("data-type"));break;case "set-custom-badge":d.data("type",a.attr("data-type"));d.show();break;case "delete-badge":b.product_images.deleteBadge()}"set-custom-badge"!=c&&d.hide();return!1});d.find("input[type=button]").unbind("click").bind("click",
function(){var a=b(this).parent();d.show();b.product_images.setBadge(d.data("type"),a.find("textarea[name=code]").val());return!1})},initImageList:function(a){this.image_list=b(a.image_list||"#s-product-image-list");this.image_list.html(tmpl("template-product-image-list",{images:a.images,placeholder:a.placeholder,type:a.type,product_id:this.product_id}));this.initListSortable();a.type&&"thumbs"!=a.type||this.initListEditable();a.enable_2x&&b.fn.retina&&this.image_list.find("img").retina()},initImage:function(){b("#s-product-one-image").parent().width();
this.photo_stream=b("#s-product-image-toolbar ul.s-photostream:first");var a=this.setImageDimensions();b(window).unbind("resize.product_images").bind("resize.product_images",function(a){b("#s-product-image").length?b.product_images.image?(a=b.product_images.setImageDimensions(),b.product_images.loupe.resize(a)):b(this).unbind("resize.product_images"):b(this).unbind("resize.product_images")});b("#s-product-image-description").inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],
placeholderClass:"gray",placeholder:b.product_images.options.placeholder,minSize:{height:50,widht:600},size:{width:a.width},editLink:"#s-product-image-description-edit-link",allowEmpty:!0,beforeMakeEditable:function(a){var c=b(this),d=this.id+"-button",e=b("#"+d);e.length||(a.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),b("#"+d).click(function(){c.trigger("readable")}));b("#"+this.id+"-hint").show();e.show().prev("br").hide()},
afterBackReadable:function(a,c){a=b(a).val();var d="#"+this.id+"-";b(d+"button").hide().prev("br").hide();b(d+"hint").hide();c.changed&&b.products.jsonPost("?module=product&action=imageSave",{id:b.product_images.image.id,data:{description:a}})}});var c=this.photo_stream,d=c.find("li.selected");c.photoStreamSlider({backwardLink:"#s-product-image-toolbar .rewind",forwardLink:"#s-product-image-toolbar .ff",photoStream:"ul",duration:400});c.off("click","li.visible a").on("click","li.visible a",function(){var a=
b(this).attr("href"),e=b(this).parent();d.removeClass("selected");d=e.addClass("selected");c.trigger("home",[function(){location.href=a}]);return!1});this.photo_stream=c;this.product_image=b("#s-product-image");var e=b("#s-product-set-custom-badge");b(".s-product-image-actions").off("click","li").on("click","li",function(){var a=b(this),c=a.attr("data-action");switch(c){case "delete":b.product_images.deleteImage();break;case "rotate-right":b.product_images.rotateImage("right");break;case "rotate-left":b.product_images.rotateImage("left");
break;case "set-badge":b.product_images.setBadge(a.attr("data-type"));break;case "set-custom-badge":e.data("type",a.attr("data-type"));e.show();break;case "delete-badge":b.product_images.deleteBadge()}"set-custom-badge"!=c&&e.hide();return!1});e.find("input[type=button]").unbind("click").bind("click",function(){var a=b(this).parent();e.show();b.product_images.setBadge(e.data("type"),a.find("textarea[name=code]").val());return!1});a=this.image;b("#s-product-image-loupe").length&&b.product_images.loupe.init({original:{width:a.width,
height:a.height,src:"?module=product&action=ImageDownload&id="+a.id},image:{width:this.product_image.width(),height:this.product_image.height(),src:a.url_big,dom:this.product_image},animate:!(!a.dimensions.width||!a.dimensions.height)});var f=this;b("#s-restore-image-original").unbind("click").bind("click",function(){confirm($_("This will reset all changes you applied to the image after upload, and will restore the image to its original. Are you sure?"))&&(f.coverToggle(),b.products.jsonPost("?module=product&action=imageRestore",
{id:f.image.id},function(a){b("#s-product-view").find("li[data-image-id="+f.image.id+"] img").attr("src",a.data.url_crop);b("<img>").attr("src",a.data.url_big).load(function(){b(this).remove();b.products.dispatch("#/product/"+f.product_id+"/edit/images/"+f.image.id+"/");f.coverToggle()})},"json"))});this.options.enable_2x&&b.fn.retina&&b("#s-product-image").retina();var g=!1;b(document).unbind("keydown.product_images").bind("keydown.product_images",function(a){var d=b(a.target).prop("nodeName").toLowerCase();
a=a.keyCode;if(!(g||"text"==d||"textarea"==d||37!=a&&39!=a)){if(39==a)return d=c.find("li.selected").next(),d.length&&!d.hasClass("dummy")&&(g=!0,location.href=d.find("a").attr("href")),!1;if(37==a)return d=c.find("li.selected").prev(),d.length&&!d.hasClass("dummy")&&(g=!0,location.href=d.find("a").attr("href")),!1}})},setImageDimensions:function(){var a=b("#s-product-image"),c=b("#s-product-one-image").parent().width(),d=this.image.dimensions;d.width=parseInt(d.width,10);d.height=parseInt(d.height,
10);var e={width:"",height:""};!isNaN(d.width)&&d.width<c?(e.width=d.width,isNaN(d.height)||(e.height=d.height)):e.width=c;a.css(e);return e},deleteImage:function(){var a=this,c=b("#s-product-image-delete-dialog");c.waDialog({onSubmit:function(){c.trigger("close");a.coverToggle();var d=c.find("form");b.shop.jsonPost(d.attr("action"),d.serialize(),function(c){var d="#/product/"+a.product_id+"/edit/images/",e=a.photo_stream.find("li.selected"),h=e.next("li:not(.dummy)");h.length?d=h.find("a").attr("href"):
(h=e.prev("li:not(.dummy)"),h.length&&(d=h.find("a").attr("href")));b(".s-product-image-crops").find("li[data-image-id="+c.data.id+"]").remove();a.coverToggle();location.href=d});return!1}})},rotateImage:function(a){var c=this;c.coverToggle();b.products.jsonPost("?module=product&action=imageRotate&id="+c.image.id,{direction:a},function(a){b("#s-product-view").find("li[data-image-id="+c.image.id+"] img").attr("src",a.data.url_crop);b("<img>").attr("src",a.data.url_big).load(function(){b(this).remove();
b.products.dispatch("#/product/"+c.product_id+"/edit/images/"+c.image.id+"/");c.coverToggle()})})},setBadge:function(a,c,d){c=c||a;var e=b("#photo-organize-menu"),f=e.find("li[data-type="+a+"]");f.find("a").append('<span class="count"><i class="icon16 loading"></i></span>');b.shop.jsonPost("?module=product&action=badgeSet&id="+this.product_id,{code:c},function(c){var g=b("#s-product-one-image");g.find(".top.right").html(c.data);e.find("li.selected").removeClass("selected").find(".small").text("");
f.addClass("selected");f.find("span.count").remove();g.length||(f.find("a").append('<span class="count"><i class="icon10 yes"></i></span>'),setTimeout(function(){f.find("span.count").remove()},1E3));"custom"!=a?(b("#s-product-set-custom-badge").hide(),f.find(".small").text(c.data)):b("#s-product-set-custom-badge").show();"function"===typeof d&&d(c)})},deleteBadge:function(){b.getJSON("?module=product&action=badgeDelete&id="+this.product_id,function(a){b("#s-product-one-image").find(".top.right").html("");
b("#photo-organize-menu").find("li.selected").removeClass("selected").find(".small").text("")})},initListSortable:function(){this.image_list.sortable({distance:5,helper:"clone",items:"li",opacity:.75,tolerance:"pointer",start:function(){document.ondragstart=function(){return!1}},update:function(a,c){document.ondragstart=null;var d=b(this);a=b(c.item);var e=parseInt(a.attr("data-image-id"),10);a=a.next();var f=null;a.length&&(f=parseInt(a.attr("data-image-id"),10));b.products.jsonPost("?module=product&action=imageMove",
{id:e,before_id:f},function(a){if("function"===typeof b.product_images.options.onSort)b.product_images.options.onSort(e,f)},function(){d.sortable("cancel")})}})},coverToggle:function(){var a=b("#s-product-image-cover");if(a.is(":hidden")){var c=a.find(".loading");c.css({position:"absolute",left:parseInt((a.width()-c.width())/2,10)+"px",top:parseInt((a.height()-c.height())/2,10)+"px"});a.show()}else a.hide()},initListEditable:function(){this.image_list.off("click",".editable").on("click",".editable",
function(){b(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",placeholder:b.product_images.options.placeholder,minSize:{height:40},allowEmpty:!0,beforeMakeEditable:function(a){var c=b(this);a.css({"font-size":c.css("font-size"),"line-height":c.css("line-height")}).width(c.parents("li:first").find("img").width());var d=this.id+"-button",e=b("#"+d);e.length||(a.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+
this.id+'-hint">Ctrl+Enter</em>'),b("#"+d).click(function(){c.trigger("readable")}));b("#"+this.id+"-hint").show();e.show()},afterBackReadable:function(a,c){var d=b(this);d=parseInt(d.parents("li:first").attr("data-image-id"),10);a=b(a).val();var e="#"+this.id+"-";b(e+"button").hide();b(e+"hint").hide();c.changed&&b.products.jsonPost("?module=product&action=imageSave",{id:d,data:{description:a}})}}).trigger("editable")})}}})(jQuery);(function(b){b.product_stocks={options:{},container:null,products_ids:[],init:function(a){this.options=a;this.stocks=a.stocks;this.container=b("#s-product-stocks");this.products_ids=[];this.initView();a.stocks&&1<a.stocks.length&&this.initDragndrop();this.options.lazy_loading&&0<this.options.product_stocks.length&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(a){var c=a.count,d=a.total_count,e=a.sort;b(window).lazyLoad("stop");if(c<d){var f=this;b(window).lazyLoad({container:f.container,
state:"undefined"===typeof a.auto||a.auto?"wake":"stop",hash:"stocks",load:function(){b(window).lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();var a=function(a){console&&(a&&a.errors?console.error("Error when loading products: "+a.errors):a&&a.responseText?console.error("Error when loading products: "+a.responseText):console.error(a));b(window).lazyLoad("stop")},h=["module=stocksBalance","offset="+c,"total_count="+d];f.options.order&&h.push("order="+f.options.order);
e&&h.push("sort="+e);b.get("?"+h.join("&"),function(e){e&&"ok"===e.status?(c+=e.data.count,f.append({product_stocks:e.data.product_stocks,stocks:f.stocks})?(b(".lazyloading-progress-string").text(e.data.progress.loaded+" "+e.data.progress.of),b(".lazyloading-progress").hide(),b(".lazyloading-chunk").text(e.data.progress.chunk),c>=d?(b(window).lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),b(window).lazyLoad("wake"))):b(window).lazyLoad("stop")):a(e)},"json").error(a)}});
b(".lazyloading-link").die("click").live("click",function(){b(window).lazyLoad("force");return!1})}},initView:function(){if(!this.append({product_stocks:this.options.product_stocks,stocks:this.stocks}))return this},initDragndrop:function(){this.container.find("td.s-stock-cell li.item").liveDraggable({containment:this.container,distance:5,cursor:"move",helper:function(){return b(this).clone().append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display: none;"></i>')},refreshPositions:!0,
start:function(){b(this).parents("tr:first").find("td.s-stock-cell").addClass("drag-active").filter(":first").addClass("first")},stop:function(){b(this).parents("tr:first").find("td.s-stock-cell").removeClass("drag-active").filter(":first").removeClass("first")}});this.container.find("td").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(a,c){b(this).hasClass("drag-active")?c.helper.find(".no-bw").hide():c.helper.find(".no-bw").show()},drop:function(a,c){a=b(this);if(!a.hasClass("drag-active"))return!1;
c=c.draggable;var d=c.parents("td:first");if(a.get(0)==d.get(0))return!1;c=c.attr("id").replace("s-item-","").split("-");d=c[1];a=a.attr("data-stock-id");var e=b("#s-item-"+[c[0],a].join("-"));if(e.length&&e.hasClass("infinity"))return!1;e=b("#s-transfer-product-dialog");e.length&&e.parent().remove();b("<div></div>").appendTo("body").load("?module=transfer",{sku_id:c[0],from:d,to:a})}})},append:function(a){var c=this;a=function(a){var d=[];b.each(a.product_stocks,function(b,a){0>c.products_ids.indexOf(a.id)&&
(d.push(a),c.products_ids.push(a.id))});a.product_stocks=d;return a}(a);try{this.container.append(tmpl("template-product-stocks",a))}catch(d){return console.error("Error: "+d.message),!1}return!0}}})(jQuery);(function(b){b.product_stocks_log={product_id:null,container:null,options:{},init:function(a){this.options=a;this.container=a.container?b(a.container):b("body");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(a){var c=a.count,d=this.options.total_count,e=a.url;b(window).lazyLoad("stop");if(c<d){var f=this;b(window).lazyLoad({container:f.container,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",load:function(){if(f.container.is(":visible"))b(window).lazyLoad("sleep"),
b(".lazyloading-link").hide(),b(".lazyloading-progress").show(),b.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(a){a=b("<div></div>").html(a);var e=a.find("table tr");e.length?(c+=e.length,b("table",f.container).append(e),c>=d?(b(window).lazyLoad("stop"),b(".lazyloading-progress").hide()):(b(window).lazyLoad("wake"),b(".lazyloading-link").show())):(b(window).lazyLoad("stop"),b(".lazyloading-progress").hide());b(".lazyloading-progress-string",f.container).replaceWith(b(".lazyloading-progress-string",
a));b(".lazyloading-chunk",f.container).replaceWith(b(".lazyloading-chunk",a));a.remove()});else{b(window).lazyLoad("sleep");var a=setInterval(function(){f.container.is(":visible")&&(b(window).lazyLoad("wake"),clearInterval(a))},500)}}});b(".lazyloading-link").die("click").live("click",function(){b(window).lazyLoad("force");return!1})}}}})(jQuery);(function(b){b.stocks_log={container:null,options:{},init:function(a){this.options=a;this.container=a.container||b("#s-content");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(a){var c=a.count,d=this.options.total_count,e=a.url;b(window).lazyLoad("stop");if(c<d){var f=this;b(window).lazyLoad({container:f.container,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",load:function(){b(window).lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();
b.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(a){a=b("<div></div>").html(a);var e=a.find("table tr");e.length?(c+=e.length,b("table",f.container).append(e),c>=d?(b(window).lazyLoad("stop"),b(".lazyloading-progress").hide()):(b(window).lazyLoad("wake"),b(".lazyloading-link").show())):(b(window).lazyLoad("stop"),b(".lazyloading-progress").hide());b(".lazyloading-progress-string",f.container).replaceWith(b(".lazyloading-progress-string",a));b(".lazyloading-chunk",f.container).replaceWith(b(".lazyloading-chunk",
a));a.remove()})}});b(".lazyloading-link").die("click").live("click",function(){b(window).lazyLoad("force");return!1})}}}})(jQuery);(function(b){b.product_orders={product_id:null,container:null,options:{},init:function(a){this.options=a;this.container=a.container?b(a.container):b("body");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(a){var c=a.count,d=this.options.total_count,e=a.url;b(window).lazyLoad("stop");if(c<d){var f=this;b(window).lazyLoad({container:f.container,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",load:function(){b(window).lazyLoad("sleep");b(".lazyloading-link").hide();
b(".lazyloading-progress").show();b.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(a){a=b("<div></div>").html(a);var e=a.find("table tr");e.length?(c+=e.length,b("table",f.container).append(e),c>=d?(b(window).lazyLoad("stop"),b(".lazyloading-progress").hide()):(b(window).lazyLoad("wake"),b(".lazyloading-link").show())):(b(window).lazyLoad("stop"),b(".lazyloading-progress").hide());b(".lazyloading-progress-string",f.container).replaceWith(b(".lazyloading-progress-string",a));b(".lazyloading-chunk",
f.container).replaceWith(b(".lazyloading-chunk",a));a.remove()})}});b(".lazyloading-link").die("click").live("click",function(){b(window).lazyLoad("force");return!1})}}}})(jQuery);(function(b){var a=[],c=[];b.fn.doAutosize=function(a){var c=b(this).data("minwidth"),d=b(this).data("maxwidth"),g="",h=b(this),k=b("#"+b(this).data("tester_id"));g!==(g=h.val())&&(g=g.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),k.html(g),k=k.width(),a=k+a.comfortZone>=c?k+a.comfortZone:c,k=h.width(),(a<k&&a>=c||a>c&&a<d)&&h.width(a))};b.fn.resetAutosize=function(a){var c=b(this).data("minwidth")||a.minInputWidth||b(this).width();a=b(this).data("maxwidth")||a.maxInputWidth||
b(this).closest(".tagsinput").width()-a.inputPadding;var d=b(this),g=b("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:d.css("fontSize"),fontFamily:d.css("fontFamily"),fontWeight:d.css("fontWeight"),letterSpacing:d.css("letterSpacing"),whiteSpace:"nowrap"}),h=b(this).attr("id")+"_autosize_tester";0< !b("#"+h).length&&(g.attr("id",h),g.appendTo("body"));d.data("minwidth",c);d.data("maxwidth",a);d.data("tester_id",h);d.css("width",c)};b.fn.addTag=function(d,e){e=jQuery.extend({focus:!1,
callback:!0},e);this.each(function(){var f=b(this).attr("id"),g=b(this).val().split(a[f]);""==g[0]&&(g=[]);d=jQuery.trim(d);if(e.unique){var h=b(g).tagExist(d);1==h&&b("#"+f+"_tag").addClass("not_valid")}else h=!1;if(""!=d&&1!=h&&(b("<span>").addClass("tag").append(b("<span>").text(d).append("\u00a0\u00a0"),b("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return b("#"+f).removeTag(escape(d))})).insertBefore("#"+f+"_addTag"),g.push(d),b("#"+f+"_tag").val(""),e.focus?b("#"+f+"_tag").focus():
b("#"+f+"_tag").blur(),b.fn.tagsInput.updateTagsField(this,g),e.callback&&c[f]&&c[f].onAddTag&&(h=c[f].onAddTag,h.call(this,d)),c[f]&&c[f].onChange)){var k=g.length;h=c[f].onChange;h.call(this,b(this),g[k-1])}});return!1};b.fn.removeTag=function(d){d=unescape(d);this.each(function(){var e=b(this).attr("id"),f=b(this).val().split(a[e]);b("#"+e+"_tagsinput .tag").remove();str="";for(var g=0;g<f.length;g++)f[g]!=d&&(str=str+a[e]+f[g]);b.fn.tagsInput.importTags(this,str);c[e]&&c[e].onRemoveTag&&c[e].onRemoveTag.call(this,
d)});return!1};b.fn.tagExist=function(a){return 0<=jQuery.inArray(a,b(this))};b.fn.importTags=function(a){id=b(this).attr("id");b("#"+id+"_tagsinput .tag").remove();b.fn.tagsInput.importTags(this,a)};b.fn.tagsInput=function(d){var e=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},d);this.each(function(){e.hide&&
b(this).hide();var d=b(this).attr("id"),g=jQuery.extend({pid:d,real_input:"#"+d,holder:"#"+d+"_tagsinput",input_wrapper:"#"+d+"_addTag",fake_input:"#"+d+"_tag"},e);a[d]=g.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange)c[d]=[],c[d].onAddTag=e.onAddTag,c[d].onRemoveTag=e.onRemoveTag,c[d].onChange=e.onChange;var h='<div id="'+d+'_tagsinput" class="tagsinput"><div id="'+d+'_addTag">';e.interactive&&(h=h+'<input id="'+d+'_tag" value="" data-default="'+e.defaultText+'" />');b(h+'</div><div class="tags_clear"></div></div>').insertAfter(this);
b(g.holder).css("width",e.width);b(g.holder).css("height",e.height);""!=b(g.real_input).val()&&b.fn.tagsInput.importTags(b(g.real_input),b(g.real_input).val());if(e.interactive){b(g.fake_input).val(b(g.fake_input).attr("data-default"));b(g.fake_input).css("color",e.placeholderColor);b(g.fake_input).resetAutosize(e);b(g.holder).bind("click",g,function(a){b(a.data.fake_input).focus()});b(g.fake_input).bind("focus",g,function(a){b(a.data.fake_input).val()==b(a.data.fake_input).attr("data-default")&&
b(a.data.fake_input).val("");b(a.data.fake_input).css("color","#000000")});if(void 0!=e.autocomplete_url){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete)autocomplete_options[attrname]=e.autocomplete[attrname];void 0!==jQuery.Autocompleter?(b(g.fake_input).autocomplete(e.autocomplete_url,e.autocomplete),b(g.fake_input).bind("result",g,function(a,c,f){c&&b("#"+d).addTag(c[0]+"",{focus:!0,unique:e.unique})})):void 0!==jQuery.ui.autocomplete&&(b(g.fake_input).autocomplete(autocomplete_options),
b(g.fake_input).bind("autocompleteselect",g,function(a,c){b(a.data.real_input).addTag(c.item.value,{focus:!0,unique:e.unique});return!1}))}else b(g.fake_input).bind("blur",g,function(a){var c=b(this).attr("data-default");""!=b(a.data.fake_input).val()&&b(a.data.fake_input).val()!=c?a.data.minChars<=b(a.data.fake_input).val().length&&(!a.data.maxChars||a.data.maxChars>=b(a.data.fake_input).val().length)&&b(a.data.real_input).addTag(b(a.data.fake_input).val(),{focus:!0,unique:e.unique}):(b(a.data.fake_input).val(b(a.data.fake_input).attr("data-default")),
b(a.data.fake_input).css("color",e.placeholderColor));return!1});b(g.fake_input).bind("keypress",g,function(a){if(a.which==a.data.delimiter.charCodeAt(0)||13==a.which)return a.preventDefault(),a.data.minChars<=b(a.data.fake_input).val().length&&(!a.data.maxChars||a.data.maxChars>=b(a.data.fake_input).val().length)&&b(a.data.real_input).addTag(b(a.data.fake_input).val(),{focus:!0,unique:e.unique}),b(a.data.fake_input).resetAutosize(e),!1;a.data.autosize&&b(a.data.fake_input).doAutosize(e)});g.removeWithBackspace&&
b(g.fake_input).bind("keydown",function(a){if(8==a.keyCode&&""==b(this).val()){a.preventDefault();a=b(this).closest(".tagsinput").find(".tag:last").text();var c=b(this).attr("id").replace(/_tag$/,"");a=a.replace(/[\s]+x$/,"");b("#"+c).removeTag(escape(a));b(this).trigger("focus")}});b(g.fake_input).blur();g.unique&&b(g.fake_input).keydown(function(a){(8==a.keyCode||String.fromCharCode(a.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,\/]+/))&&b(this).removeClass("not_valid")})}return!1});
return this};b.fn.tagsInput.updateTagsField=function(c,e){var d=b(c).attr("id");b(c).val(e.join(a[d]))};b.fn.tagsInput.importTags=function(d,e){b(d).val("");var f=b(d).attr("id");e=e.split(a[f]);for(var g=0;g<e.length;g++)b(d).addTag(e[g],{focus:!1,callback:!1});c[f]&&c[f].onChange&&c[f].onChange.call(d,d,e[g])}})(jQuery);(function(b){function a(a){var c=[],e="";b.each(a,function(b,a){a.name&&("product_id[]"===a.name?c.push(parseInt(a.value,10)):"hash"===a.name&&(e=a.value))});!e&&c.length&&(e="id/"+c.join(","));return e}b.product_list={options:{},collection_hash:[],collection_param:"",total_count:0,category_count:0,sort:null,order:null,container:null,toolbar:null,sortable:!0,cached:{},fixed_blocks:{},init:function(a){var c=[];a.collection_param&&c.push(a.collection_param);c.push("view="+a.view);a.sort&&c.push("sort="+
a.sort);a.order&&c.push("order="+a.order);a.page&&1<a.page&&c.push("page="+a.page);c="#/products/"+c.join("&");b.products.forceHash(c);try{this.options=a;this.container=b("#product-list");this.toolbar=b("#s-product-list-toolbar");this.sidebar=b("#s-sidebar");var e=this.options.products;delete this.options.products;this.total_count=this.options.total_count||0;this.category_count=parseInt(this.options.category_count,10);isNaN(this.category_count)&&(this.category_count=this.total_count);this.sortable=
"undefined"===typeof a.sortable?this.sortable:a.sortable;this.sort=a.sort||null;if(a.enable_2x)this.container.on("append_product_list",function(){b.fn.retina&&b.product_list.container.find("img").not(".is-empty").retina()});if(e&&a.view){try{this.container.append(tmpl("template-product-list-"+this.options.view,{products:e,sort:this.sort,primary_currency:this.options.primary_currency,stocks:this.options.stocks},"thumbs"!=this.options.view)),this.container.trigger("append_product_list",[e])}catch(g){return console.log("Error: "+
g.message),this}delete a.products}b.isArray(this.options.collection_hash)&&this.options.collection_hash.length?this.collection_hash=this.options.collection_hash:this.collection_hash=[];this.collection_param=this.options.collection_param?this.options.collection_param:"";a.order&&(this.order=a.order);if(this.options.lazy_loading)this.initLazyLoad(this.options.lazy_loading);else{var f=c.replace(/&page=\d+/,"")+"&page=";b(".pagination a").each(function(){var a=b(this).attr("href").match(/\?page=(\d+)/);
b(this).attr("href",f+(a?a[1]:1))})}this.initSelecting();this.initView(this.options.view);this.initDragndrop();this.rubberTable();"table"==this.options.view&&this.initInlineEditor()}catch(g){b.shop.error("$.product_list.init error: "+g.message,g)}return this},initLazyLoad:function(a){var c=a.count,e=this.total_count;b(window).lazyLoad("stop");if(c<e){var f=this,g=f.container.find("tr.header th[data-additional-column]").map(function(){return b(this).data("additional-column")}).get().join(",");b(window).lazyLoad({container:f.container,
state:"undefined"===typeof a.auto||a.auto?"wake":"stop",hash:["","products"],load:function(){b(window).lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();b.get("?module=products&action=loadList&offset="+c+("&total_count="+e)+(f.collection_param?"&"+f.collection_param:"")+(f.sort?"&sort="+f.sort:"")+(f.order?"&order="+f.order:"")+("&enabled_columns="+(g||"")),function(a){if("ok"==a.status&&a.data.count){c+=a.data.count;var d=f.container;try{f.container.append(tmpl("template-product-list-"+
f.options.view,{products:a.data.products,check_all:d.find(".s-select-all:first").length?d.find(".s-select-all:first").attr("checked"):!1,sort:b.product_list.sort,primary_currency:b.product_list.options.primary_currency,stocks:b.product_list.options.stocks})),f.container.trigger("append_product_list",[a.data.products])}catch(l){console.log("Error: "+l.message);b(window).lazyLoad("stop");return}d.find(".last").removeClass("last");d.find(".product:last").addClass("last");b(".lazyloading-progress-string").text(a.data.progress.loaded+
" "+a.data.progress.of);b(".lazyloading-progress").hide();b(".lazyloading-chunk").text(a.data.progress.chunk);c>=e?(b(window).lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),b(window).lazyLoad("wake"))}else a.data&&!a.data.count?console&&(console.log("Count of again loaded products is 0"),b(".lazyloading-progress").hide()):(a.errors&&console&&console.log("Error when loading products: "+a.errors),b(window).lazyLoad("stop"))},"json")}});b(".lazyloading-link").die("click").live("click",
function(){b(window).lazyLoad("force");return!1})}},initSelecting:function(){var a=this.container,d=this.toolbar.find(".count"),e=a.find(".s-select-all:first"),f=function(){var b=parseInt(a.find("> .product.selected").length,10);b?d.text(b).show():d.text("").hide()};b(document).keydown(function(a){16!=a.keyCode||b(a.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(a){16==a.keyCode&&(document.body.onselectstart=null)});a.off("select",".product").on("select",
".product",function(a,c,d){d=void 0!==d?d:!0;(void 0!==c?c:1)?b(this).addClass("selected").find("input:first").attr("checked",!0):(b(this).removeClass("selected").find("input:first").attr("checked",!1),e.is(":checked")&&e.attr("checked",!1));d&&f();return!1});e.unbind("select").bind("select",function(c,e){e=void 0!==e?e:!0;c=b(this);e?(c.attr("checked",!0),a.find("> .product").trigger("select",!0,!1),d.text(c.attr("data-count")).show()):(c.attr("checked",!1),a.find("> .product").trigger("select",
!1,!1),d.text("").hide())});a.off("click",".product input").on("click",".product input",function(c,d){var g=c.shiftKey;c=this.checked;d&&(g=d.shiftKey,c=d.checked);d=b(this).parents(".product:first");c?d.addClass("selected"):(e.is(":checked")&&e.attr("checked",!1),d.removeClass("selected"));if(g&&c){(g=a.data("last_checked"))||(g=a.find("> .product:first").trigger("select",!0));var h=d.prevAll(".selected[data-product-id="+g.attr("data-product-id")+"]");if(h.length){var n=d.prev();for(g=g.get(0);n.length&&
g!=n.get(0);)n.addClass("selected").find("input").attr("checked",!0),n=n.prev()}else if(h=d.nextAll(".selected[data-product-id="+g.attr("data-product-id")+"]"),h.length)for(n=d.next(),g=g.get(0);n.length&&g!=n.get(0);)n.addClass("selected").find("input").attr("checked",!0),n=n.next();a.data("last_checked")||h.length||g.trigger("selected",!1)}c&&a.data("last_checked",d);f()});if(b.browser.mozilla)a.off("click",".product label").on("click",".product label",function(a){if(a.shiftKey){var c=b(a.target);
b(c).is("label")||(c=b(c).parents("label:first"));c=b("#"+c.attr("for"));c.trigger("click",{shiftKey:a.shiftKey,checked:!c.attr("checked")})}})},initView:function(a){try{var c=this.container,e=this.sidebar;c.find(".s-select-all:first").length&&c.find(".s-select-all:first").click(function(){b(this).trigger("select",this.checked)});"table"==a&&(b("#s-content .list-view-mode-table").click(function(){c.toggleClass("single-lined");b.storage.set("shop/product_list/multi-lined",!c.hasClass("single-lined"));
return!1}),b.storage.get("shop/product_list/multi-lined")&&c.removeClass("single-lined"));var f="view="+a;e.find(".s-collection-list li.dr").each(function(){var a=b(this);a.find("a:first").attr("href","#/products/"+a.attr("id").replace("-","_id=")+"&"+f)});b("#s-products-search").autocomplete("disable").val(this.options.text||"").autocomplete("enable");var g="s-all-products",h=b.product_list.collection_hash.length&&"search"!==b.product_list.collection_hash[0]&&"tag"!==b.product_list.collection_hash[0]&&
"id"!==b.product_list.collection_hash[0];h&&(g=b.product_list.collection_hash.join("-"));b.shop.trace("$.product_list.initView",[a,g]);e.find("li.selected").removeClass("selected");var k=e.find("#"+g);0>=k.length&&window.location.hash&&(k=e.find('a[href="'+window.location.hash+'"]').parent());0>=k.length&&(k=e.find("#s-all-products"));k.addClass("selected");h&&k.find(".count:first").text(this.category_count);b.product_list.fixed_blocks=b.product_list.initFixedBlocks();this.initEditingControls();this.initToolbar();
b(document).trigger("product_list_init_view")}catch(l){b.shop.error("$.product_list.initView error: "+l.message,l)}},highlightInlineEditorCells:function(){b.product_list.container.find("tr").each(function(){var a=b(this),d=a.data("edit-rights");d&&a.data("min-price")==a.data("max-price")||a.find(".s-product-price .editable").filter(function(){return!b(this).data("plugin")}).addClass("not-editable");d&&1==a.data("sku-count")||a.find(".s-product-stock .editable").filter(function(){return!b(this).data("plugin")}).addClass("not-editable")})},
initInlineEditor:function(){function a(a,b){if(a.data("denied-reason")==b)a.data("denied-reason",""),alert(b);else{a.data("denied-reason",b);setTimeout(function(){a.data("denied-reason","")},3E3);a.wrapInner('<div class="animation-container" style="position:relative;"></div>');var c=a.find(".animation-container").animate({left:"3px"},100,function(){c.animate({left:"0px"},100,function(){c.animate({left:"3px"},100,function(){c.animate({left:"0px"},100,function(){c.children().first().unwrap()})})})})}}
function d(a){var c=[];b.product_list.container.find("tr.product").each(function(){var a=b(this);void 0===a.data("original-price")&&a.data("edit-rights")&&c.push(b(this).data("product-id"))});if(!c.length)return a();b.post("?module=products&action=inlineEditorData",{ids:c},function(c){c.data&&b.product_list.container.find("tr.product").each(function(){var a=b(this),d=c.data[parseInt(a.data("product-id"),10)];d&&(a.data("stocks",d.stocks||null),a.data("original-price",d.price.replace(/\.?0+$/g,"")))});
a()},"json")}var e=this;b.product_list.highlightInlineEditorCells();b.product_list.container.on("append_product_list",function(){b.product_list.highlightInlineEditorCells()});b.product_list.container.on("click",".s-product-price,.s-product-stock",function(){function c(){if(k)g.html(tmpl("template-list-price-editor-one",{product_id:h.data("product-id"),currency:h.data("currency"),value:h.data("original-price")}));else{var a=h.data("stocks");a&&"object"==typeof a?g.html(tmpl("template-list-stock-editor-many",
{product_id:h.data("product-id"),values:a})):g.html(tmpl("template-list-stock-editor-one",{product_id:h.data("product-id"),value:a||""}))}g.find(".cancel").click(function(){var a=g;a.removeClass("editor-on").html(a.data("read-only-state-html"));a.data("read-only-state-html","");a.data("denied-reason","")});var c=g.find("form").submit(function(){if(c.find(".loading").length)return!1;c.find(":submit").after('<i class="icon16 loading"></i>');b.post("?module=products&action=inlineSave",c.serialize(),
function(a){c.find(".loading").remove();try{a.data&&a.data[0]&&(a.data[0].alien=h.hasClass("s-alien"));var d=b("<table>").html(tmpl("template-product-list-table",{products:a.data,check_all:b.product_list.container.find(".s-select-all:first").prop("checked"),sort:b.product_list.sort}));h.replaceWith(d.find("tr"));e.container.trigger("append_product_list",[a.data])}catch(m){console.log("Error: "+m.message)}},"json");return!1});c.on("dblclick",!1);setTimeout(function(){g.find(":input:visible:first").focus()},
0)}var g=b(this);if(!g.data("plugin")){var h=g.closest("tr"),k=g.hasClass("s-product-price");if(k){if(h.data("min-price")!=h.data("max-price"))return a(g,$_("Inline editing is available only for products with a single SKU"))}else if("1"!=h.data("sku-count"))return a(g,$_("Inline editing is available only for products with a single SKU"));if(!h.data("edit-rights"))return a(g,$_("Insufficient access rights"));g.hasClass("editor-on")||(g.addClass("editor-on").data("read-only-state-html",g.html()),b.product_list.container.removeClass("single-lined"),
void 0!==h.data("original-price")?c():(g.html('<i class="icon16 loading"></i>'),d(c)))}})},initFixedBlocks:function(){var a=b("#mainmenu").height(),d=b("#s-sidebar").width(),e=b(window),f=b("#s-fixed-blocks");f.length||(f=b('<div id="s-fixed-blocks"></div>').css({display:"none",position:"fixed",background:"#fff",top:a,width:d,"float":"left"}).appendTo("#s-sidebar"));var g=b("#s-category-list"),h=b("#s-category-list-block"),k=b("#s-set-list"),l=b("#s-set-list-block"),n=function(){function c(){if(!n){var c=
b("#s-category-list-handler");v=b.categories_tree.isCollapsed(c);p=g.is(":hidden");var k=b('<div id="s-category-list-dummy" class="block"></div>').css({height:h.height()});h.replaceWith(k);f.show().append(h.hide());h.find(".heading").before('<span class="hint float-right" style="margin-top: 3px;">'+$_("Drag products here")+"</span>");v&&b.categories_tree.expand(c,null,function(){b.categories_tree.collapse(c)});p||g.hide();h.show();b("i.add",h).hide();b("#s-category-list-handler").hide();h.css({"overflow-x":"hidden",
"overflow-y":"auto"});(function(){var b=g.is(":hidden"),c;h.bind("mousemove.fixed_blocks.category",function(d){document.getElementById("products-helper")&&b&&(c&&(clearTimeout(c),c=null),c=setTimeout(function(){if(b){h.css({height:""});g.show();var c=h.height(),d=(e.height()-a)/2;h.css({height:Math.min(c,d)});h.find(".heading").prev(".hint").hide();b=!1}},250))});e.bind("mouseout.fixed_blocks.category",function(a){a.pageX>d+10&&(c&&clearTimeout(c),c=null,b||(g.hide(),h.css({height:""}),h.find(".heading").prev(".hint").show(),
b=!0))})})();n=!0}}function k(){if(n){var a=b("#s-category-list-dummy");a.replaceWith(h);h.css({"overflow-x":"","overflow-y":""});var c=b("#s-category-list-handler");v&&b.categories_tree.collapse(c);p||g.show();h.find(".heading").prev(".hint").remove();b("#s-category-list-handler").show();b("i.add",h).show();a.remove();h.unbind("mousemove.fixed_blocks.category");e.unbind("mouseout.fixed_blocks.category");f.children().length||f.hide();n=!1;b.categories_tree.init()}}var l=h.offset().top,n=!1,p,v;e.unbind("scroll.fixed_blocks.category").bind("scroll.fixed_blocks.category",
function(){n||(l=h.offset().top);var d=l;d=document.getElementById("s-category-list-dummy")?d+b("#s-category-list-dummy").height():d+b("#s-category-list-block").height();e.scrollTop()+a+5>=d?c():k()});return{setFixed:c,unsetFixed:k}}(),p=function(){function c(){if(!p){n=k.is(":hidden");var c=b('<div id="s-set-list-dummy" class="block"></div>').css({height:l.height()});l.replaceWith(c);f.show().append(l);l.find(".heading").before('<span class="hint float-right" style="margin-top: 3px;">'+$_("Drag products here")+
"</span>");n||k.hide();b("i.add",l).hide();b("i.collapse-handler",l).hide();l.css({"overflow-x":"hidden","overflow-y":"auto"});(function(){var b=k.is(":hidden"),c;l.bind("mousemove.fixed_blocks.set",function(d){document.getElementById("products-helper")&&b&&(c&&(clearTimeout(c),c=null),c=setTimeout(function(){if(b){l.css({height:""});k.show();var c=l.height(),d=(e.height()-a)/2;l.css({height:Math.min(c,d)});l.find(".heading").prev(".hint").hide();b=!1}},250))});e.bind("mouseout.fixed_blocks.set",
function(a){a.pageX>d+10&&(c&&clearTimeout(c),c=null,b||(k.hide(),l.css({height:""}),l.find(".heading").prev(".hint").show(),b=!0))})})();p=!0}}function g(){if(p){var a=b("#s-set-list-dummy");a.replaceWith(l);l.css({"overflow-x":"","overflow-y":""});l.find(".heading").prev(".hint").remove();n||k.show();b("i.add",l).show();b("i.collapse-handler",l).show();a.remove();l.unbind("mousemove.fixed_blocks.category");e.unbind("mouseout.fixed_blocks.category");f.children().length||f.hide();p=!1}}var h=l.offset().top,
n,p=!1;e.unbind("scroll.fixed_blocks.set").bind("scroll.fixed_blocks.set",function(){p||(h=l.offset().top);var d=h;d=document.getElementById("s-set-list-dummy")?d+b("#s-set-list-dummy").height():d+b("#s-set-list-block").height();e.scrollTop()+a+5>=d?c():g()});return{setFixed:c,unsetFixed:g}}();return{category:n,set:p}},initEditingControls:function(){var a=b("#s-product-list-title"),d=b.product_list.collection_hash[0],e="?module=category&action=save&";"set"===d&&(e="?module=set&action=save&");a.hasClass("editable")&&
(a.inlineEditable({minSize:{width:350},maxSize:{width:600},size:{height:30},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){b(".s-product-list-manage").hide()},afterBackReadable:function(a,c){b(".s-product-list-manage").show();if(!c.changed)return!1;b.shop.jsonPost(e+b.product_list.collection_param+"&edit=name",{name:b(a).val()},function(a){b.product_list.sidebar.find("#"+d+"-"+a.data.id).find(".name:first").html(a.data.name)})}}),"name"==this.options.edit&&a.trigger("editable"));a=b("#s-product-list-settings");
!a.length||"category"!=d&&"set"!=d||a.unbind("click").bind("click",function(){"category"==d?shopDialogProductsCategory.staticDialog(b.product_list.collection_hash[1],null,"edit"):shopDialogProductsSet.staticDialog(b.product_list.collection_hash[1],"edit");return!1});a=b("#s-product-list-delete");!a.length||"category"!=d&&"set"!=d||a.unbind("click").bind("click",function(){b("#s-product-list-delete-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){b(this).find(".dialog-buttons i.loading").hide()},
onSubmit:function(){function a(b,d){if(!b.length)return d&&d();var e=b.shift();c(["category",e],function(){a(b,d)})}function c(a,c){var d={hash:a.join("/")||"all",remove:["list"]};n&&d.remove.push("products");var f=function(){b.product_list.remove(d,function(d,f){e(a,d);b.product_list.sidebar.trigger("update",d.data.lists);c&&c()})},g=b("#"+a.join("-")+"-handler");g.length?b.categories_tree.expand(g,function(a){a.parent().find("ul:first").hide();f()}):f();return!1}function e(a,c){var d=a[0],e=b("#"+
a.join("-")),f=e.prev(".drag-newposition");a=b("#s-"+a[0]+"-list");var g=a.find("ul:first");"set"==d?(e.remove(),f.remove()):(d=e.find("ul:first"),d.length&&(d.find(">li.drag-newposition:first").remove(),e.hide(),d.find(">li").each(function(){e.after(this)})),d=e.parents("ul:first"),e.remove(),f.remove(),d.find("li.dr").length||(g.get(0)!=d.get(0)?(d.parents("li:first").find("i.collapse-handler").remove(),d.closest("li").find(".collapse-handler-ajax:first").remove(),d.remove()):g.closest(".block").find(".collapse-handler-ajax:first").remove()));
g.find("li.dr:first").length?(g.show(),a.find(".s-empty-list").hide()):(g.hide(),a.find(".s-empty-list").show());c.data.old_parent_category&&"undefined"!==typeof c.data.old_parent_category.children_count&&!parseInt(c.data.old_parent_category.children_count,10)&&b("#category-"+c.data.old_parent_category.id+"-handler").remove()}var k=b(this),l=parseInt(b.product_list.collection_hash[1]);k.find(".dialog-buttons i.loading").show();var n="1"==k.find("input[name=s-delete-products]:checked").val();"category"==
d&&k.find('input[name="s-delete-sub"]').is(":checked")?b.get("?action=categoryExpand&tree=1&recurse=1&id="+l,function(c){c=b("<div>").html(c).find('li[id^="category-"]').map(function(){return parseInt(this.id.substr(9),10)}).get().reverse();c.push(l);a(c,function(){location.href="#/"})}):c(b.product_list.collection_hash,function(){location.href="#/"});return!1}});return!1});"set"===d&&b("#s-embed-code").click(function(){b("#s-product-list-embed-dialog").waDialog();return!1})},initDragndrop:function(){b.product_dragndrop.init({products:!0,
view:this.options.view,sort:this.options.sort}).bind("move_product",function(a){b.shop.jsonPost("?module=product&action=move&"+b.product_list.collection_param,{product_ids:a.product_ids,before_id:a.before_id||null},a.success,a.error)}).bind("is_product_sortable",function(){return b.product_list.sortable}).bind("add_to_list",function(a){var c={};a.whole_list?c.hash=b.product_list.collection_hash.join("/")||"all":c.product_id=a.product_ids;b.shop.jsonPost("?module=product&action=addToList&"+a.collection_param,
c,a.success,a.error)})},initToolbar:function(){var a=this.toolbar;a.find("li").unbind("click.product_list").bind("click.product_list",function(a){a.preventDefault();a=b(this);var c=a.attr("data-action");if(c){var d=b.product_list.getSelectedProducts("delete"!=c);if(!d.count)return alert($_("Please select at least one product")),!1;switch(c){case "new-set":break;case "category":b.product_list.categoriesDialog(d);break;case "set":b.product_list.setsDialog(d);break;case "type":b.product_list.typesDialog(d);
break;case "assign-tags":b.product_list.assignTagsDialog(d);break;case "delete":b.product_list.deleteProductsDialog(d);break;case "delete-from-set":"set"==b.product_list.collection_hash[0]&&b.product_list.deleteFromSet(d);break;case "delete-from-category":"category"==b.product_list.collection_hash[0]&&b.product_list.deleteFromCategory(d);break;case "visibility":b.product_list.visibilityDialog(d,a);break;case "export":b.product_list.exportProducts(d,b(this).attr("data-plugin"));break;case "duplicate":b.product_list.duplicateProducts(d,
b(this));break;case "promo":b.product_list.associatePromo(d,b(this));break;case "coupon":b.product_list.createCoupon(d);break;case "set-badge":case "delete-badge":b.product_list.setBadge(d,b(this));break;default:return}return!1}});a.find('li[data-action="set-custom-badge"] a').click(function(){b(this).parent().find(".textarea-wrapper").slideToggle("fast");return!1}).closest("li").find(".textarea-wrapper").click(function(){return!1}).find("input").click(function(){var a=b.product_list.getSelectedProducts(!0);
a.count?b.product_list.setBadge(a,b(this).closest("li")):alert($_("Please select at least one product"));return!1});(function(){var c,e=b("#mainmenu").height(),f=a.find(":first").offset().top-e,g=b(document),h=b(window);g.bind("scroll",c=function(){jQuery.contains(document.documentElement,a[0])?g.scrollTop()>f&&a.height()+e<h.height()?a.addClass("s-fixed").css({top:e}):a.removeClass("s-fixed"):(g.off("scroll",c),h.off("resize",c))});h.bind("resize",c)})()},getSelectedProducts:function(a){a=a||!1;
var c={count:0};if(this.container.find(".s-select-all:first").attr("checked")){var e=b.product_list.collection_hash.join("/")||"all";a?c.serialized=[{name:"hash",value:e}]:c.hash=e;c.count=this.total_count}else a?c.serialized=b.product_list.container.find(".product.selected").map(function(){c.count+=1;return{name:"product_id[]",value:b(this).attr("data-product-id")}}).toArray():c.product_id=b.product_list.container.find(".product.selected").map(function(){c.count+=1;return b(this).attr("data-product-id")}).toArray();
return c},visibilityDialog:function(a,d){if(!b.isArray(a.serialized))return!1;var c=d.find("i.icon16");if(!c.hasClass("loading")){d=b("#visibility-dialog-wrapper");d.length||(d=b('<div id="visibility-dialog-wrapper">').appendTo("#s-content"));var f=c.attr("class");c.attr("class","icon16 loading");d.data("products",a).load("?module=dialog&action=visibility",function(){c.attr("class",f)})}},categoriesDialog:function(a){var c=b("#s-categories"),e=this.sidebar,f=this.container;c.length&&c.parent().remove();
b("<div></div>").appendTo("body").load("?module=dialog&action=categories",function(){b("#s-categories").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=b(this);c.find(".dialog-content h1 span").text("("+a.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_category_name]").val("");c.find("input[name=new_category]").attr("checked",!1)},onSubmit:function(c){var d=c.find("form");d.find(".dialog-buttons i.loading").show();b.shop.jsonPost(d.attr("action"),d.serializeArray().concat(a.serialized),
function(a){a.data.new_category&&b("#s-category-list ul:first").trigger("add",[a.data.new_category,"category","#/products/category_id="+a.data.new_category+"&view="+b.product_list.options.view]);a.data.categories&&(e.trigger("update",[{category:a.data.categories}]),f.find(".s-select-all:first").trigger("select",!1));d.find("input:checked").attr("checked",!1);c.trigger("close")});return!1}})})},setsDialog:function(a){var c=b("#s-sets"),e=this.sidebar,f=this.container;c.length&&c.parent().remove();
b("<div></div>").appendTo("body").load("?module=dialog&action=sets",function(){b("#s-sets").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=b(this);c.find(".dialog-content h1 span").text("("+a.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_set_name]").val("");c.find("input[name=new_set]").attr("checked",!1)},onSubmit:function(c){var d=c.find("form");d.find(".dialog-buttons i.loading").show();b.shop.jsonPost(d.attr("action"),d.serializeArray().concat(a.serialized),
function(a){a.data.new_set&&b("#s-set-list ul:first").trigger("add",[a.data.new_set,"set","#/products/set_id="+a.data.new_set+"&view="+b.product_list.options.view]);a.data.sets&&(e.trigger("update",[{set:a.data.sets}]),f.find(".s-select-all:first").trigger("select",!1));d.find("input:checked").attr("checked",!1);c.trigger("close")});return!1}})})},assignTagsDialog:function(a){var c=b("#s-assign-tags"),e=function(){b("#s-assign-tags").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=b(this);
c.find(".dialog-content h1 span").text("("+a.count+")").show();c.find(".dialog-buttons i.loading").hide()},onSubmit:function(c){var d=b(this),e=d.find("#s-assign-tags-list_tag");if(e.length){var f=jQuery.Event("keypress",{which:13});e.trigger(f)}d.find(".dialog-buttons i.loading").show();var l=d.attr("action");setTimeout(function(){var e=d.serializeArray().concat(a.serialized);b.shop.jsonPost(l,e,function(a){a.data.denied_message&&alert(a.data.denied_message);"search"===a.data.cloud?c.trigger("close"):
a.data.cloud&&b("#s-tag-cloud").trigger("update",[a.data.cloud]);c.trigger("close");b.products.dispatch()},function(){c.trigger("close")})},10);return!1}})};c.length&&c.remove();b.post("?module=dialog&action=assignTags",a.serialized,function(a){b("body").append(a);e()})},typesDialog:function(a){var c=b("#s-types"),e=this.container,f=this.sidebar,g=function(){b("#s-types").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){b(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(c){var d=
b(this);d.find(".dialog-buttons i.loading").show();b.shop.jsonPost(d.attr("action"),d.serializeArray().concat(a.serialized),function(a){f.trigger("update",{type:a.data.types});e.find(".s-select-all:first").trigger("select",!1);d.find("input:checked").attr("checked",!1);c.trigger("close");b.products.dispatch()});return!1}})},h=c.parent();c.length?g():(h=b("<div></div>").appendTo("body"),h.load("?module=dialog&action=types",g))},deleteFromSet:function(a){0<a.count&&b.shop.jsonPost("?module=products&action=deleteFromSet&id="+
this.collection_hash[1],a.serialized,function(){b.products.dispatch()})},deleteFromCategory:function(a){0<a.count&&b.shop.jsonPost("?module=products&action=deleteFromCategory&id="+this.collection_hash[1],a.serialized,function(){b.products.dispatch()})},deleteProductsDialog:function(a){var c=function(){b("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){b(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(c){b(this).find(".dialog-buttons i.loading").show();
b.product_list.remove(b.extend(a,{remove:["products"]}),function(a,d){b.product_list.sidebar.trigger("update",a.data.lists);b.products.dispatch();c.trigger("close");d.length&&alert((c.data("not-allowed-string")||"").replace("%d",d.length))});return!1}})},e=b("#s-product-list-delete-products-dialog"),f=e.parent();e.length||(f=b("<div></div>").appendTo("body"));0<a.count&&f.load("?module=dialog&action=productsDelete",a,c)},exportProducts:function(a,b){for(var c=[],d,g=!1;d=a.serialized.pop();)d.name&&
("product_id[]"==d.name?c.push(parseInt(d.value,10)):"hash"==d.name&&(g=d.value));a="?action=importexport#/"+b;g?window.location=a+("/hash/"+g):c.length&&(a+="/hash/id/"+c.join(","),window.location=a)},createCoupon:function(a){for(var b=[],c,f=!1;c=a.serialized.pop();)c.name&&("product_id[]"==c.name?b.push(parseInt(c.value,10)):"hash"==c.name&&(f=c.value));a=this.options.marketing_url+"coupons/create/";f?window.location=a+("?products_hash="+f):b.length&&(a+="?products_hash=id/"+b.join(","),window.location=
a)},duplicateProducts:function(a,d){for(var c=[],f,g=!1;f=a.serialized.pop();)f.name&&("product_id[]"==f.name?c.push(parseInt(f.value,10)):"hash"==f.name&&(g=f.value));!g&&c.length&&(g="id/"+c.join(","));g&&(d.find("i.icon16").removeClass("split").addClass("loading"),this.duplicate(g,{progress:function(a){d.attr("title",Math.round(100*a.offset/a.total_count)+"%")},finish:function(a,c){d.attr("title",null);var e=d.find("i.icon16");e.removeClass("loading").addClass("yes");setTimeout(function(){e.removeClass("yes").addClass("split")},
3E3);b(document).one("product_list_init_view",function(){var a={};b.each(c,function(b,c){a[c]=1});b("#product-list [data-product-id]").each(function(){var c=b(this),d=b(this).data("product-id");d&&a[d]&&c.addClass("highlighted")})});(a||c)&&b.products.dispatch()},error:function(a){}}))},setBadge:function(a,d){function c(a){var c="delete-badge"==f?null:a.data;b("#product-list [data-product-id]").each(function(){var a=b(this);if(h||g[a.data("product-id")]){if(a.is("tr")){var d=a.find(".s-image a");
d.find(".s-image-corner").remove();c&&d.prepend(b('<div class="s-image-corner"></div>').html(c))}else d=a.find(".s-product-image a"),d.find(".s-image-corner.top.right").remove(),c&&d.append(b('<div class="s-image-corner top right"></div>').html(c));a.trigger("badge",[c])}});"set-custom-badge"==f&&d.parent().find(".textarea-wrapper").slideUp("fast");d.find(".loading").remove();d.find("a").append(b('<span class="count"><i class="icon16 yes"></i></span>').animate({opacity:0},function(){b(this).remove()}));
b.product_list.container.find(".s-select-all:first").trigger("select",!1)}var f=d.data("action");"set-custom-badge"!=f&&d.parent().find(".textarea-wrapper").slideUp("fast");d.find(".loading").remove();d.find("a").append('<span class="count"><i class="icon16 loading"></i></span>');var g={},h=!1;b.each(a.serialized,function(){h=h||"hash"==this.name;g[this.value]=1});if("delete-badge"==f)d.find(".loading").remove(),b.shop.jsonPost("?module=product&action=badgeDelete",a.serialized,c);else{var k="set-custom-badge"==
f?d.find("textarea").val():d.data("type");a=a.serialized;a.push({name:"code",value:k});b.shop.jsonPost("?module=product&action=badgeSet",a,c,function(a){"object"===typeof a.errors&&"string"===typeof a.errors[0]&&alert(a.errors[0]);d.find(".loading").remove()})}},duplicate:function(a,d){var c=this,f=[];b.shop.jsonPost("?module=products&action=duplicate",{hash:a,limit:50,offset:d.offset||0},function(e){"ok"==(e.status||"error")?(f=f.concat(e.data.new_ids||[]),e.data.offset<e.data.total_count?(d.offset=
e.data.offset,c.duplicate(a,d),d.progress(e.data||{})):d.finish(e.data||{},f)):"fail"==e.status&&e.errors.message&&b("#s-product-list-duplicate-error-dialog").waDialog()},function(a){if(a.errors)if(d.finish(),a.errors.message){var c=b("#s-product-list-duplicate-error-dialog");c.find(".js-content").html(a.errors.message);c.waDialog()}else alert(a.errors)})},remove:function(a,d){var c={},f=[];if(a.product_id)var g=function(){100>=a.product_id.length&&(c.get_lists=!0);c.product_id=a.product_id.splice(0,
100);b.shop.jsonPost("?module=products&action=deleteList",c,function(b){b.data.not_allowed&&b.data.not_allowed.length&&(f=f.concat(b.data.not_allowed));a.product_id.length?g():"function"===typeof d&&d(b,f)})};else c.hash=a.hash||this.collection_hash.join("/")||"all",c.remove=b.isArray(a.remove)&&a.remove.length?a.remove:["list"],1==c.remove.length&&"list"==c.remove[0]?g=function(){b.shop.jsonPost("?module=products&action=deleteList",c,d)}:(c.count=100,g=function(){b.shop.jsonPost("?module=products&action=deleteList",
c,function(a){a.data.not_allowed&&a.data.not_allowed.length&&(f=f.concat(a.data.not_allowed));0<a.data.rest_count&&null!=a.data.rest_count?g():"function"===typeof d&&d(a,f)})});g()},associatePromo:function(c,d){function e(){var d=location.pathname+"?module=productsAssociatePromoDialog",e={products_hash:a(c.serialized)};return b.post(d,e).done(function(a){b(a).waDialog({onLoad:function(){b("body").addClass("is-scroll-locked")},onCancel:function(){b("body").removeClass("is-scroll-locked");b(this).remove()}})})}
d.data("locked")||(d.data("locked",!0),e().always(function(){d.removeData("locked")}))},rubberTable:function(){var a=b("#wa"),d=b("#s-content"),e=b("#s-content > .content");d=parseInt(d.css("margin-left"));var f=parseInt(e.css("margin-right")),g=b(".s-product-list-table-container table").width(),h=a.attr("style");h&&a.data("style",h);e=parseInt(e.width()-b(".s-product-list-table-container").width())+g+d+f;a.width()<e&&a.css({"min-width":e+"px"});b(window).resize()}}})(jQuery);var shopDialogProductsSet=function(b){shopDialogProductsSet=function(a){this.$wrapper=a.$wrapper;this.is_new=a.is_new;this.initClass()};shopDialogProductsSet.prototype.initClass=function(){this.is_new&&this.initTransliterateSetID();this.initTypeSwitch();this.initDatepickers()};shopDialogProductsSet.prototype.initTypeSwitch=function(){var a=this.$wrapper;a.find("input[name=type]").on("click",function(){"0"==b(this).val()?a.find(".js-set-dynamic-settings").hide():a.find(".js-set-dynamic-settings").show()})};
shopDialogProductsSet.prototype.initDatepickers=function(){var a=this;a.$wrapper.find(".js-datepicker").each(function(){var a=b(this);a.datepicker({});a.datepicker("widget").hide()});(function(){function c(a){var c=b.datepicker._defaults.dateFormat,d=null;try{b.datepicker.parseDate(c,a),d=!0}catch(k){d=!1}return d}var d=a.$wrapper.find(".js-start-date"),e=a.$wrapper.find(".js-finish-date");d.on("change",function(){var a=b(this),d=b.trim(a.val()),h=null;d&&(c(d)?h=new Date(a.datepicker("getDate").getTime()+
864E5):a.val("").addClass("error"));e.datepicker("option","minDate",h)});e.on("change",function(){var a=b(this),e=b.trim(a.val()),h=null;e&&(c(e)?h=new Date(a.datepicker("getDate").getTime()-864E5):a.val("").addClass("error"));d.datepicker("option","maxDate",h)});b([d,e]).on("keydown",function(a){a=b(this);a.hasClass("error")&&a.removeClass("error")});d.trigger("change").datepicker("refresh");e.trigger("change").datepicker("refresh")})()};shopDialogProductsSet.prototype.initTransliterateSetID=function(){var a=
this.$wrapper,c=a.find(".js-product-set-id");a=a.find(".js-product-list-name");var d="",e=!1,f,g;c.bind("keydown",function(){var a=b(this);null!==f&&(clearTimeout(f),f=null);f=setTimeout(function(){var b=a.val();d!==b&&(e=!0,d=b,a.unbind("keydown"))},200)});a.bind("keydown",function(){var a=b(this);e?a.unbind("keydown"):(null!==g&&(clearTimeout(g),g=null),g=setTimeout(function(){var f=a.val();f&&b.getJSON("?action=transliterate&str="+f,function(b){e?a.unbind("keydown"):"ok"==b.status&&(d=b.data,c.val(d))})},
200))})};shopDialogProductsSet.staticDialog=function(a,c){var d=b("#s-product-set-dialog"),e=function(){d=b("#s-product-set-dialog");d.waDialog({esc:!1,disableButtonsOnSubmit:!0,onLoad:function(){new shopDialogProductsSet({$wrapper:d,is_new:"new"===c});setTimeout(function(){b(".js-product-list-name").focus()},50)},onSubmit:function(d){var e=b(this),f=function(e){if(0<location.hash.indexOf("set_id")){var f=location.hash.replace("set_id="+a,"set_id="+e.data.id);"rule"in e.data&&(f=f.replace(/&sort=[^&]*/,
"&sort="),f=f.replace(/&order=[^&]*/,"&order="))}else f="#/products/set_id="+e.data.id;"new"===c&&b.product_sidebar.createNewElementInList(e.data,"set");b.product_sidebar.updateItemInCategoryList(e,f);location.hash!=f?location.hash=f:b.products.dispatch();d.trigger("close")},g=function(a){if(a&&a.errors){a=a.errors;var b=0,c;for(c in a){var f=d.find("input[name="+c+"]");if(f.length){f.addClass("error");b+=1;var g=f.parent().find(".errormsg");g.length&&g.text(a[c]);f.one("keyup",function(){--b||e.find("[type='submit']").removeAttr("disabled",
!1);f.removeClass("error");g.length&&g.text("")})}}return!1}};if(e.find("input:file").length)b.products._iframePost(e,f,g);else return b.shop.jsonPost(e.attr("action"),e.serialize(),f,g),!1},onClose:function(){d.find(".js-datepicker").each(function(){b(this).datepicker("widget").hide()})}})};var f=d.length?d.closest(".s-products-set-dialog-wrapper").empty():b('<div class="s-products-set-dialog-wrapper"></div>').appendTo("body");"new"===c?f.load("?module=set&action=Create",e):"edit"===c&&f.load("?module=set&action=Edit&set_id="+
a,e)};return shopDialogProductsSet}(jQuery);var shopDialogProductsCategory=function(b){shopDialogProductsCategory=function(a){this.$wrapper=a.$wrapper;this.SEARCH_STEP=a.SEARCH_STEP;this.category_id=a.category_id;this.category_type=a.category_type;this.account_name=a.account_name;this.filter_count=a.filter_count;this.filter_ignore_id=[];this.ignore_id=[];this.filter_element_html=a.templates.filter_element_html;this.show_more_filters_text=a.texts.show_more_filters_text;this.initClass()};shopDialogProductsCategory.prototype.initClass=function(){var a=
this;a.initAutocomplete();a.initEvent();a.initFilter();a.initMetaTagEdit();a.initFrontendUrlEdit();a.initCategoryVisibility();a.initSocialMetaTag();a.initShowMoreFilters();a.initFilterIgnoreId();a.updateShowFilterButton();a.initFilterAutocomplete();var c=a.$wrapper.find('*[data-slider="range"]');c.length&&c.each(function(){a.initRangeSlider(".js-feature-slider-"+b(this).data("code"))})};shopDialogProductsCategory.prototype.initEvent=function(){this.initDynamicSettingsEvent();this.disableManualSorting();
this.initShowMore();this.initShowAllFeatureValue();this.initGetFeatures()};shopDialogProductsCategory.prototype.initShowMoreFilters=function(){var a=this;a.$wrapper.on("click",".js-show-more-filters",function(c){c.preventDefault();c={category:a.category_id,offset:a.getFilterOffset(),ignore_id:a.filter_ignore_id,category_type:a.category_type};b.post("?module=categoryGetFeatures",c).success(function(c){if(!c||!c.data.features)return!1;b.each(c.data.features,function(b,c){a.setFilterElement(c)});a.updateShowFilterButton()})})};
shopDialogProductsCategory.prototype.updateShowFilterButton=function(){var a=this.SEARCH_STEP,b=this.$wrapper.find(".js-show-more-filters"),d=this.$wrapper.find(".js-category-filters .js-filter-checkbox").length,e=this.show_more_filters_text;d=d-1-this.filter_ignore_id.length;d+this.SEARCH_STEP>this.filter_count&&(a=this.filter_count-d);1<=a?(d=this.filter_count-d,e=e.replace(/%d/g,a),e=e.replace(/%all/g,d),b.text(e)):b.hide()};shopDialogProductsCategory.prototype.setFilterElement=function(a,b){var c=
this.filter_element_html,e=this.$wrapper.find(".js-category-filters");b=b?b:!1;c=c.replace(/%id/g,a.id);c=c.replace(/%name/g,a.name);c=c.replace(/%code/g,a.code);c=c.replace(/%type_name/g,a.type_name);e.append(c);b&&this.$wrapper.find('.js-category-filter input[data-filter-id="'+a.id+'"]').prop("checked",!0)};shopDialogProductsCategory.prototype.getFilterOffset=function(){var a=this.$wrapper.find(".js-category-filters .js-filter-checkbox").length;a=a-1-this.filter_ignore_id.length;0>a&&(a=0);return a};
shopDialogProductsCategory.prototype.initFilterIgnoreId=function(){var a=[];this.$wrapper.find(".js-category-filters .js-filter-checkbox:checked").each(function(){var c=b(this).val();"price"!==c&&a.push(c)});this.filter_ignore_id=a};shopDialogProductsCategory.prototype.initFilterAutocomplete=function(){var a=this,c=a.$wrapper.find(".js-filter-autocomplete");c.autocomplete({source:function(c,e){b.post("?action=autocomplete&type=filter",{term:c.term,category_id:a.category_id,options:{ignore_id:a.filter_ignore_id,
category_type:a.category_type}},function(a){e(a)},"json")},minLength:1,delay:300,create:function(){c.autocomplete("widget").appendTo(".js-filter-autocomplete-block")},select:function(c,e){c.preventDefault();a.setFilterElement(e.item,!0);a.filter_ignore_id.push(parseInt(e.item.id));b(this).val("");return!1},focus:function(){return!1}})};shopDialogProductsCategory.prototype.initAutocomplete=function(){var a=this,c=a.$wrapper.find(".js-autocomplete"),d=[];c.length&&c.autocomplete({source:function(c,
f){a.$wrapper.find(".js-condition-feature").each(function(){var a=b(this).data("feature_id");b.isNumeric(a)&&-1==b.inArray(a,d)&&d.push(a)});b.ajax({type:"POST",url:"?action=autocomplete&type=feature",data:{term:c.term,options:{ignore_id:d,count:1}},success:function(b){var c=a.$wrapper.find(".js-autocomplete-wrapper .errormsg");f(b);0===b.length?c.html("").html($_("Matching features were not found or are already selected.")):c.html("")},dataType:"json"})},minLength:1,delay:300,create:function(){c.autocomplete("widget").appendTo(".js-autocomplete-block")},
select:function(b,c){a.renderFeature(c.item.id);a.ignore_id.push(parseInt(c.item.id));return!1},focus:function(){return!1}})};shopDialogProductsCategory.prototype.initRangeSlider=function(a){var c=b(a).find(".js-begin"),d=b(a).find(".js-end"),e=parseFloat(c.attr("placeholder")),f=parseFloat(d.attr("placeholder")),g=1,h=b(a).find(".js-range-slider");if(h.data("step"))g=parseFloat(h.data("step"));else if(a=f-e,Math.round(e)!=e||Math.round(f)!=f){g=a/10;for(a=0;1>g;)g*=10,a+=1;g=Math.pow(10,-a);(a=Math.round(1E5*
Math.abs(Math.round(e)-e))/1E5)&&a<g&&(g=a);(a=Math.round(1E5*Math.abs(Math.round(f)-f))/1E5)&&a<g&&(g=a)}e=parseFloat(c.val()?c.val():0);f=parseFloat(d.val()?d.val():100<c.val()?parseFloat(c.val())+100:100);h.slider({range:!0,min:e-3,max:f+5,step:g,values:[e,f],slide:function(a,e){a=b(this).slider("option","min");var f=b(this).slider("option","max");2!=b(e.handle).index()&&(e.values[0]==a&&b(this).slider("option","min",a-g),c.val(e.values[0]));1!=b(e.handle).index()&&(e.values[1]==f&&b(this).slider("option",
"max",f+g),d.val(e.values[1]))},stop:function(a,b){d.change()}});c.add(d).change(function(){var a=""===c.val()?h.slider("option","min"):parseFloat(c.val()),b=""===d.val()?h.slider("option","max"):parseFloat(d.val());b>=a&&(h.slider("option","values",[a,b]),h.slider("option","max",parseFloat(b)+5),h.slider("option","min",parseFloat(a)-3))})};shopDialogProductsCategory.prototype.initShowFeatures=function(a,b,d,e,f){var c=a.type.substr(0,5);if("range"==c){var h=[],k=[],l;for(l in a.values)a.values.hasOwnProperty(l)&&
(h.push(parseInt(a.values[l].begin)),k.push(parseInt(a.values[l].end)));a.values={};a.values[0]={begin:Math.min.apply(Math,h)?Math.min.apply(Math,h):"",end:Math.max.apply(Math,k)?Math.max.apply(Math,k):""}}b.append(tmpl(d,{feature:a,default_checked:e,show_all:f}));"range"===c&&this.initRangeSlider(".js-feature-slider-"+a.code)};shopDialogProductsCategory.prototype.initGetFeatures=function(){var a=this;this.$wrapper.on("change",".js-condition-feature",function(){var c=b(this).closest("tr").find(".js-condition-feature-block");
if(this.checked){var d=b(this).data("feature_id"),e="?module=category&action=getFeatures&feature_id="+d,f=b(this).attr("data-loading");if("new"===a.category_id&&!f){var g=this;b(g).closest(".js-condition-feature-names").append('<i class="icon16 loading"></i>');b.get(e,function(e){"ok"===e.status&&(e.data.features&&a.initShowFeatures(e.data.features[d],c,"template_feature_field_values",!0,!1),b(g).attr("data-loading","ok"),b(g).closest(".js-condition-feature-names").find("i.loading").remove())})}c.show();
c.find(":input").each(function(){b(this).attr("disabled",!1)})}else c.hide(),c.find(":input").each(function(){b(this).attr("disabled",!0)})})};shopDialogProductsCategory.prototype.renderFeature=function(a){var c=this,d=c.$wrapper,e=!0,f=d.find(".js-show-more").attr("data-offset"),g="feature_id="+a,h="GET";a||(e=!1,g={ignore_id:c.ignore_id,category:c.category_id,category_type:c.category_type,offset:f},h="POST");b.ajax({type:h,url:"?module=categoryGetFeatures",data:g,dataType:"json",success:function(b){d.find(".js-show-more").find("i.loading").remove();
if("ok"===b.status){var g=d.find(".js-condition-list .js-feature-insertion-block"),h=d.find(".js-show-more").attr("data-count"),k=0,t;for(t in b.data.features)b.data.features.hasOwnProperty(t)&&(c.initShowFeatures(b.data.features[t],g,"template_feature_field",e,!1),++k);b=h-k;0<b?(g="<b><i>"+(20<b?$_("Show %d more").replace("%d",20)+" "+$_("From").toLowerCase()+" "+b:$_("Show %d more").replace("%d",b))+"</i></b>",d.find(".js-show-more").html(g).attr("data-count",b),a||(f=parseInt(f)+parseInt(k),d.find(".js-show-more").attr("data-offset",
f))):d.find(".js-autocomplete-wrapper").hide()}else"fail"===b.status&&console.log(b.errors)}})};shopDialogProductsCategory.prototype.initShowAllFeatureValue=function(){var a=this;a.$wrapper.on("click",".js-show-all-feature",function(){var c=this,d=b(this).data("feature_id");b(this).html('<i class="icon16 loading"></i>');if("undefined"==typeof d)b(this).parent().find(".js-feature-hidden").show(),b(this).hide();else{var e="?module=category&action=getFeatures&feature_id="+d,f=b(this).parent();b.get(e,
function(e){if("ok"===e.status&&e.data.features){var g=e.data.features[d];f.find(".js-feature-value").each(function(){var a=parseInt(b(this).data("f_val")),c;for(c in g.values)g.values.hasOwnProperty(c)&&c==a&&delete g.values[c]});a.initShowFeatures(g,f,"template_feature_field_values",!0,!0);b(c).html("")}})}})};shopDialogProductsCategory.prototype.initShowMore=function(){var a=this,c=a.$wrapper,d=c.find(".js-show-more").attr("data-count");a.ignore_id.length||a.$wrapper.find(".js-condition-feature").each(function(){b.isNumeric(b(this).data("feature_id"))&&
a.ignore_id.push(b(this).data("feature_id"))});d-=a.ignore_id.length;if(0>=d)c.find(".js-autocomplete-wrapper").hide();else{var e="<b><i>"+(20<d?$_("Show %d more").replace("%d",20)+" "+$_("From").toLowerCase()+" "+d:$_("Show %d more").replace("%d",d))+"</i></b>";c.find(".js-show-more").html(e).attr("data-count",d)}c.find(".js-show-more").click(function(){b(this).html('<i class="icon16 loading"></i>');a.renderFeature()})};shopDialogProductsCategory.prototype.disableManualSorting=function(){var a=this.$wrapper;
a.find(".js-subcategory-toggle").change(function(){this.checked?a.find('.js-sort-type option[value=""]').attr("disabled",!0).next().attr("selected","selected"):a.find('.js-sort-type option[value=""]').attr("disabled",!1)})};shopDialogProductsCategory.prototype.initDynamicSettingsEvent=function(){var a=this.$wrapper;a.find("input[name=type]").on("click",function(){"0"==b(this).val()?(a.find(".js-category-dynamic-settings").hide(),a.find(".js-category-dynamic-settings").find(":input").each(function(){b(this).attr("disabled",
!0)})):(a.find(".js-category-dynamic-settings").show(),a.find(".js-category-dynamic-settings").find(":input").each(function(){b(this).hasClass("js-always-disabled")||b(this).attr("disabled",!1)}))});a.find(".js-category-rate").rateWidget({withClearAction:!1,onUpdate:function(b){a.find(".js-c-category-rate-value").val(b)}});a.find("select[name^=rating]").change(function(){a.find(".js-condition-rate").attr("checked",!0)});a.find(".js-category-rate").click(function(){a.find(".js-condition-rate").attr("checked",
!0)});a.find("select[name^=count]").change(function(){a.find(".js-condition-count").attr("checked",!0)});a.find(".js-category-count-value").click(function(){a.find(".js-condition-count").attr("checked",!0)});a.on("change","input[name^=tag]",function(){a.find(".js-condition-tag").attr("checked",!0)});a.on("keyup","input[name^=price]",function(){a.find(".js-condition-price-interval").attr("checked",!0)});a.on("change",".js-feature-value",function(){this.checked&&b(this).closest("tr").find(".js-condition-feature").attr("checked",
!0);var c=b(this).closest("tr").find(".js-condition-feature").attr("data-feature_id"),d=parseInt(b(this).closest(".js-condition-feature-block").find("input:checkbox:checked").length);c=a.find('.js-category-filter input[data-filter-id="'+c+'"]');c.length&&(2<=d?c.is(":disabled")&&c.attr("disabled",!1):c.attr("disabled",!0))})};shopDialogProductsCategory.prototype.initFrontendUrlEdit=function(){b("#s-settings-frontend-url").inlineEditable({editLink:".js-settings-frontend-url-edit-link",editOnItself:!1,
minSize:{width:100},makeReadableBy:[],beforeMakeEditable:function(a){var c=b(this).parents("div:first"),d=c.find("span.slash");b(a).after(d);c.find("span.s-frontend-base-url").html(c.find("a.s-frontend-base-url").hide().contents()).show()},beforeBackReadable:function(a,c){a=b(this);c=a.parents("div:first");var d=c.find("span.slash");a.after(d);c.find("a.s-frontend-base-url").html(c.find("span.s-frontend-base-url").hide().contents()).show()}});var a=this.$wrapper.find(".js-product-list-name"),c=this.$wrapper.find(".js-product-list-url"),
d={name:"",url:"",timer_id:null};a.unbind(".create_product_list").bind("change.create_product_list, keyup.create_product_list",function(){d.time_id&&clearTimeout(d.time_id);if(c.val()!==d.url)a.unbind(".create_product_list");else{var e=a.val();e!==d.name&&(d.time_id=setTimeout(function(){b.getJSON("?action=transliterate",{str:e},function(a){"ok"===a.status?(c.val(a.data),d={name:e,url:a.data,time_id:null}):console&&(a.errors?console.error(a.errors):a&&console.error(a))})},300))}})};shopDialogProductsCategory.prototype.initMetaTagEdit=
function(){var a=this.$wrapper,c=this.account_name;(function(){var c=b("input[name=meta_title]",a);b.shop.changeListener(b("input[name=name]",a),function(a){c.attr("placeholder",a.val())})})();(function(){var d=b("[name=meta_keywords]",a);b.shop.changeListener(b("input[name=name]",a),function(a){d.attr("placeholder",[c,a.val()].join(", "))})})();b.shop.makeFlexibleInput("s-meta-title")};shopDialogProductsCategory.prototype.initSocialMetaTag=function(){var a=this.$wrapper.find(".js-category-social-metatag"),
b=a.closest(".field-group"),d=b.find(".editable-og-disabler");a.closest(".field").appendTo(b.closest("form").find('[name="meta_title"]').closest(".field-group"));a.prop("checked")||b.show();a.change(function(){a.prop("checked")?(b.slideUp(200),d.prop("disabled",!1)):(b.slideDown(200),d.prop("disabled",!0))})};shopDialogProductsCategory.prototype.initFilter=function(){function a(){var a=!(1<c.find(".js-filter-item .js-filter-checkbox:checked").length);c.find(".js-filter-item").each(function(){var c=
b(this),d=c.find(".js-filter-checkbox"),e=c.find("i.sort");!a&&d.is(":checked")?c.hasClass("unsortable")&&(c.removeClass("unsortable"),e.show()):c.hasClass("unsortable")||(c.addClass("unsortable"),e.hide())});d.sortable("refresh")}var c=this.$wrapper,d=c.find(".js-category-filter");c.on("click",".js-category-allow-filter",function(){this.checked?(d.find(":input").each(function(){b(this).data("disabled")||b(this).attr("disabled",!1)}),d.show()):(d.find(":input").each(function(){b(this).attr("disabled",
!0)}),d.hide())});d.sortable({distance:5,opacity:.75,items:"li:not(.unsortable)",handle:".sort",cursor:"move",tolerance:"pointer"});c.on("change",".js-filter-checkbox",function(){a()});a()};shopDialogProductsCategory.prototype.initCategoryVisibility=function(){var a=this.$wrapper.find(".js-product-category-visibility-block");b("input[name=storefront]",a).change(function(){"route"==this.value?b('input[name="routes[]"]',a).attr("disabled",!1):b('input[name="routes[]"]',a).attr("disabled",!0)})};shopDialogProductsCategory.staticDialog=
function(a,c,d){var e=function(){b("#s-product-category-dialog").waDialog({esc:!1,disableButtonsOnSubmit:!1,onLoad:function(){b("#s-category-description-content").length&&b.product_sidebar.initCategoryDescriptionWysiwyg(b(this));setTimeout(function(){b(".js-product-list-name").focus()},150)},onSubmit:function(c){var e=b(this);if(function(){var a=!1;e.find(".js-condition-feature:checked, .js-condition-tag:checked").each(function(){var c=b(this).closest("tr").find(".js-condition-feature-block, .js-condition-tag-block"),
d=c.find(".js-feature-value:checkbox, .js-tag-value:checkbox");d.length&&!d.is(":checked")&&(a=!0,c.find(".errormsg").html("").html($_("Nothing selected")),e.find(".js-category-error").html("").html($_("Nothing selected")))});setTimeout(function(){e.find(".errormsg").html("")},5E3);return a}())return!1;var f=function(e){if(0<location.hash.indexOf("category_id")){var f=location.hash.replace("category_id="+a,"category_id="+e.data.id);if("sort_products"in e.data||"rule"in e.data)f=f.replace(/&sort=[^&]*/,
"&sort="),f=f.replace(/&order=[^&]*/,"&order=")}else f="#/products/category_id="+e.data.id;"new"===d&&b.product_sidebar.createNewElementInList(e.data,"category");b.product_sidebar.updateItemInCategoryList(e,f);location.hash!=f?location.hash=f:b.products.dispatch();c.trigger("close")},g=function(a){if(a&&a.errors){a=a.errors;for(var b in a)c.find("input[name="+b+"]").addClass("error").parent().find(".errormsg").text(a[b]);return!1}};b("#s-category-description-content").length&&b("#s-category-description-content").waEditor("sync");
if(e.find("input:file").length)b.products._iframePost(e,f,g);else return b.shop.jsonPost(e.attr("action"),e.serialize(),f,g),!1}})},f=b("#s-product-category-dialog");f=f.length?f.parent():b("<div></div>").appendTo("body");"new"===d&&f.load("?module=category&action=Create&parent_id="+c,e);"edit"===d&&f.load("?module=category&action=Edit&category_id="+a,e)};return shopDialogProductsCategory}(jQuery);(function(b){b.widget("ui.slider",b.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var a=this,c=this.options;this._mouseSliding=this._keySliding=!1;this._animateOff=!0;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all");c.disabled&&this.element.addClass("ui-slider-disabled ui-disabled");
this.range=b([]);c.range&&(!0===c.range?(this.range=b("<div></div>"),c.values||(c.values=[this._valueMin(),this._valueMin()]),c.values.length&&2!==c.values.length&&(c.values=[c.values[0],c.values[0]])):this.range=b("<div></div>"),this.range.appendTo(this.element).addClass("ui-slider-range"),"min"!==c.range&&"max"!==c.range||this.range.addClass("ui-slider-range-"+c.range),this.range.addClass("ui-widget-header"));0===b(".ui-slider-handle",this.element).length&&b("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle");
if(c.values&&c.values.length)for(;b(".ui-slider-handle",this.element).length<c.values.length;)b("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle");this.handles=b(".ui-slider-handle",this.element).addClass("ui-state-default ui-corner-all");this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){c.disabled||b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")}).focus(function(){c.disabled?
b(this).blur():(b(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),b(this).addClass("ui-state-focus"))}).blur(function(){b(this).removeClass("ui-state-focus")});this.handles.each(function(a){b(this).data("index.ui-slider-handle",a)});this.handles.keydown(function(c){var d=!0,f=b(this).data("index.ui-slider-handle"),g;if(!a.options.disabled){switch(c.keyCode){case b.ui.keyCode.HOME:case b.ui.keyCode.END:case b.ui.keyCode.PAGE_UP:case b.ui.keyCode.PAGE_DOWN:case b.ui.keyCode.UP:case b.ui.keyCode.RIGHT:case b.ui.keyCode.DOWN:case b.ui.keyCode.LEFT:if(d=
!1,!a._keySliding){a._keySliding=!0;b(this).addClass("ui-state-active");var h=a._start(c,f);if(!1===h)return}}var k=a.options.step;h=a.options.values&&a.options.values.length?g=a.values(f):g=a.value();switch(c.keyCode){case b.ui.keyCode.HOME:g=a._valueMin();break;case b.ui.keyCode.END:g=a._valueMax();break;case b.ui.keyCode.PAGE_UP:g=a._trimAlignValue(h+(a._valueMax()-a._valueMin())/5);break;case b.ui.keyCode.PAGE_DOWN:g=a._trimAlignValue(h-(a._valueMax()-a._valueMin())/5);break;case b.ui.keyCode.UP:case b.ui.keyCode.RIGHT:if(h===
a._valueMax())return;g=a._trimAlignValue(h+k);break;case b.ui.keyCode.DOWN:case b.ui.keyCode.LEFT:if(h===a._valueMin())return;g=a._trimAlignValue(h-k)}a._slide(c,f,g);return d}}).keyup(function(c){var d=b(this).data("index.ui-slider-handle");a._keySliding&&(a._keySliding=!1,a._stop(c,d),a._change(c,d),b(this).removeClass("ui-state-active"))});this._refreshValue();this._animateOff=!1},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");
this._mouseDestroy();return this},_mouseCapture:function(a){var c=this.options,d;if(c.disabled)return!1;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();var e={x:a.pageX,y:a.pageY};var f=this._normValueFromMouse(e);var g=this._valueMax()-this._valueMin()+1;var h=this;this.handles.each(function(a){var c=Math.abs(f-h.values(a));g>c&&(g=c,k=b(this),d=a)});if(!0===c.range&&this.values(1)===c.min){d+=1;var k=b(this.handles[d])}if(!1===
this._start(a,d))return!1;this._mouseSliding=!0;h._handleIndex=d;k.addClass("ui-state-active").focus();c=k.offset();this._clickOffset=b(a.target).parents().andSelf().is(".ui-slider-handle")?{left:a.pageX-c.left-k.width()/2,top:a.pageY-c.top-k.height()/2-(parseInt(k.css("borderTopWidth"),10)||0)-(parseInt(k.css("borderBottomWidth"),10)||0)+(parseInt(k.css("marginTop"),10)||0)}:{left:0,top:0};f=this._normValueFromMouse(e);this._slide(a,d,f);return this._animateOff=!0},_mouseStart:function(){return!0},
_mouseDrag:function(a){var b=this._normValueFromMouse({x:a.pageX,y:a.pageY});this._slide(a,this._handleIndex,b);return!1},_mouseStop:function(a){this.handles.removeClass("ui-state-active");this._mouseSliding=!1;this._stop(a,this._handleIndex);this._change(a,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){if("horizontal"===
this.orientation){var b=this.elementSize.width;a=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else b=this.elementSize.height,a=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);b=a/b;1<b&&(b=1);0>b&&(b=0);"vertical"===this.orientation&&(b=1-b);a=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+b*a)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=
this.values(b),c.values=this.values());return this._trigger("start",a,c)},_slide:function(a,b,d){if(this.options.values&&this.options.values.length){var c=this.values(b?0:1);2===this.options.values.length&&!0===this.options.range&&(0===b&&d>c||1===b&&d<c)&&(d=c);d!==this.values(b)&&(c=this.values(),c[b]=d,a=this._trigger("slide",a,{handle:this.handles[b],value:d,values:c}),this.values(b?0:1),!1!==a&&this.values(b,d,!0))}else d!==this.value()&&(a=this._trigger("slide",a,{handle:this.handles[b],value:d}),
!1!==a&&this.value(d))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());this._trigger("change",a,c)}},value:function(a){arguments.length&&(this.options.value=
this._trimAlignValue(a),this._refreshValue(),this._change(null,0));return this._value()},values:function(a,c){var d;1<arguments.length&&(this.options.values[a]=this._trimAlignValue(c),this._refreshValue(),this._change(null,a));if(arguments.length)if(b.isArray(arguments[0])){var e=this.options.values;var f=arguments[0];for(d=0;d<e.length;d+=1)e[d]=this._trimAlignValue(f[d]),this._change(null,d);this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(a):this.value();
else return this._values()},_setOption:function(a,c){var d,e=0;b.isArray(this.options.values)&&(e=this.options.values.length);b.Widget.prototype._setOption.apply(this,arguments);switch(a){case "disabled":c?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.attr("disabled","disabled"),this.element.addClass("ui-disabled")):(this.handles.removeAttr("disabled"),this.element.removeClass("ui-disabled"));break;case "orientation":this._detectOrientation();
this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case "value":this._animateOff=!0;this._refreshValue();this._change(null,0);this._animateOff=!1;break;case "values":this._animateOff=!0;this._refreshValue();for(d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1}},_value:function(){return this._trimAlignValue(this.options.value)},_values:function(a){var b;if(arguments.length){var d=this.options.values[a];return this._trimAlignValue(d)}d=
this.options.values.slice();for(b=0;b<d.length;b+=1)d[b]=this._trimAlignValue(d[b]);return d},_trimAlignValue:function(a){if(a<this._valueMin())return this._valueMin();if(a>this._valueMax())return this._valueMax();var b=0<this.options.step?this.options.step:1,d=a%b;a-=d;2*Math.abs(d)>=b&&(a+=0<d?b:-b);return parseFloat(a.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var a=this.options.range,c=this.options,d=this,e=
this._animateOff?!1:c.animate,f={},g;if(this.options.values&&this.options.values.length)this.handles.each(function(a){n=(d.values(a)-d._valueMin())/(d._valueMax()-d._valueMin())*100;f["horizontal"===d.orientation?"left":"bottom"]=n+"%";b(this).stop(1,1)[e?"animate":"css"](f,c.animate);if(!0===d.options.range)if("horizontal"===d.orientation){if(0===a)d.range.stop(1,1)[e?"animate":"css"]({left:n+"%"},c.animate);if(1===a)d.range[e?"animate":"css"]({width:n-g+"%"},{queue:!1,duration:c.animate})}else{if(0===
a)d.range.stop(1,1)[e?"animate":"css"]({bottom:n+"%"},c.animate);if(1===a)d.range[e?"animate":"css"]({height:n-g+"%"},{queue:!1,duration:c.animate})}g=n});else{var h=this.value();var k=this._valueMin();var l=this._valueMax();var n=l!==k?(h-k)/(l-k)*100:0;f["horizontal"===d.orientation?"left":"bottom"]=n+"%";this.handle.stop(1,1)[e?"animate":"css"](f,c.animate);if("min"===a&&"horizontal"===this.orientation)this.range.stop(1,1)[e?"animate":"css"]({width:n+"%"},c.animate);if("max"===a&&"horizontal"===
this.orientation)this.range[e?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:c.animate});if("min"===a&&"vertical"===this.orientation)this.range.stop(1,1)[e?"animate":"css"]({height:n+"%"},c.animate);if("max"===a&&"vertical"===this.orientation)this.range[e?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:c.animate})}}});b.extend(b.ui.slider,{version:"1.8.2"})})(jQuery);
//# sourceMappingURL=product.min.js.map