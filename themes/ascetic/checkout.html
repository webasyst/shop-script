<!-- following CSS hides top navigation menu; remove <style>…</style> to unhide -->
<style>
    #header, #footer { display: none; }    
    .app-header { display: none; }
</style>

<div class="checkout">

    <h2 class="align-center">{$wa->shop->settings("name")}</h2>

    <!-- checkout navigation -->
    {if isset($checkout_steps) && count($checkout_steps) > 1}
        <ul class="checkout-navigation menu-h">
            <li>
                <a href="{$wa->getUrl('/frontend/cart')}">[`Cart`]</a>
            </li>
            <li>&rarr;</li>
            {foreach $checkout_steps as $step_id => $s}
                <li class="{if isset($_upcoming_flag)} upcoming{/if}{if $step_id == $checkout_current_step} selected{$_upcoming_flag = 1}{/if}">
                    <a href="{if $s@first}{$wa->getUrl('/frontend/checkout')}{else}{$wa->getUrl('/frontend/checkout', ['step' => $step_id])}{/if}">{$s.name}</a>
                </li>
                {if not $s@last}<li>&rarr;</li>{/if}
            {/foreach}
        </ul>
        <br>
    {/if}

    {if isset($checkout_steps)}
    <!-- checkout step content -->
    {foreach $checkout_steps as $step_id => $s}
        {if $checkout_current_step == $step_id}
        {if !$s@index}
            {if $wa->isAuthEnabled()}
            {if !$wa->user()->isAuth()}

            <!-- authorized / not authorized selector -->
            <blockquote>
                <ul class="menu-v">
                    <li><label><input name="user_type" type="radio" {if !$wa->post('wa_auth_login')}checked{/if} value="0"> [`I’m a new customer`]</label></li>
                    <li><label><input name="user_type" type="radio" {if $wa->post('wa_auth_login')}checked{/if} value="1"> [`I already have an account`]</label></li>
                </ul>
            </blockquote>
            <script type="text/javascript">
                $(function () {
                    $("#login-form input").attr('disabled', 'disabled');
                    $("input[name='user_type']").change(function () {
                        if ($("input[name='user_type']:checked").val() == '1') {
                            $("#login-form input").removeAttr('disabled');
                            $(".checkout-step").hide();
                            $("input[type=submit]:last").hide();
                            $("#login-form").show();
                        } else {
                            $("#login-form input").attr('disabled', 'disabled');
                            $("#login-form").hide();
                            $(".checkout-step").show();
                            $("input[type=submit]:last").show();
                        }
                    }).change();
                });
            </script>
            <div id="login-form"{if !$wa->post('wa_auth_login')} style="display:none"{/if}>
                <form method="post" action="">
                    {include file="login.html" without_form=true}
                </form>
            </div>
            <div class="clear-both"></div>
            {else}

            <!-- authorized -->
            <blockquote>
                <img src="{$wa->user()->getPhoto(50)}">
                <p class="black">{sprintf("[`You are currently authorized as <strong>%s</strong>. Please verify or update your contact information using the form below. Your existing contact info will be automatically updated.`]", $wa->user('name'))}</p>
                <em>[`If you want to place an order on behalf of another customer, <a href="?logout">log out</a> from your current profile and proceed to checkout again.`]</em></p>
            </blockquote>
            <div class="clear-both"></div>

            {/if}
            {/if}

        {/if}
        <div class="checkout-step"{if $wa->post('wa_auth_login')} style="display:none"{/if}>
        <form id="checkout-form" method="post" action="">
            <h1>{$s.name}</h1>
            {if in_array($step_id,['contactinfo', 'shipping', 'payment', 'confirmation'])}
                {include file="checkout.`$step_id`.html"}
            {else}
                {$s.content}
            {/if}
            <div class="clear-both"></div>
            {if $s@last}
                {if empty($error)}
                <div class="float-right">
                    <input type="submit" class="large" value="[`Place order`]">
                </div>
                {/if}
            {else}
                <input type="submit" value="[`Next &rarr;`]">
            {/if}
            <div class="clear-both"></div>
        </form>
        </div>
        {/if}
    {/foreach}
    {else}
        <div class="checkout-step">
            {include file="checkout.`$checkout_current_step`.html"}
        </div>
    {/if}

</div>
<script type="text/javascript">
    $(".checkout-navigation li.upcoming a").on('click', function () {
        return false
    });
    $('#checkout-form').on('submit', function () {

        {if $checkout_current_step == 'shipping' || $checkout_current_step == 'payment'}
            var f = $(this);
            if (!f.find('input[name="{$checkout_current_step}_id"]:checked').not(':disabled').length) {
                if (!f.find('em.errormsg').length) {
                    $('<em class="errormsg inline">{if $checkout_current_step == 'payment'}[`Please select payment option`]{else}[`Please select shipping option`]{/if}</em>').insertAfter(f.find('input:submit:last'));
                }
                return false;
            } else {
                f.find('em.errormsg').remove();
            }
        {/if}

        $('<span class="loading"> <i class="icon16 loading"></i></span>').insertAfter($(this).find('input:submit:last').attr('disabled', 'disabled'));
    });
</script>